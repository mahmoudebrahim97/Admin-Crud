;/*FB_PKG_DELIM*/

__d("LSBumpE2EEMetadataThread",["LSCancelTaskByQueueName","LSIssueNewTask"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1];c.n;var d=[],e=[],f;return c.seq([function(e){return c.seq([function(e){return d[0]=new c.Map(),d[0].set("bump_timestamp_ms",a[1]),d[0].set("thread_key",a[0]),d[0].set("bumped_by_local_device_send",a[2]),d[0].set("tam_thread_subtype",c.i64.cast([0,0])),d[0].set("wa_jid",f),d[0].set("message_ephemeral_duration_in_sec",c.i64.cast([0,0])),d[0].set("message_product_type",f),d[0].set("is_message_deletion",!1),d[1]=d[0].get("thread_key"),d[0],c.sp(b("LSCancelTaskByQueueName"),c.i64.to_string(d[1]),c.i64.cast([0,389]))},function(e){return d[2]=new c.Map(),d[2].set("bump_timestamp_ms",a[1]),d[2].set("thread_key",a[0]),d[2].set("bumped_by_local_device_send",a[2]),d[2].set("tam_thread_subtype",c.i64.cast([0,0])),d[2].set("wa_jid",f),d[2].set("message_ephemeral_duration_in_sec",c.i64.cast([0,0])),d[2].set("message_product_type",f),d[2].set("is_message_deletion",!1),d[3]=d[2].get("thread_key"),d[2],d[4]=c.toJSON(d[2]),c.sp(b("LSIssueNewTask"),c.i64.to_string(d[3]),c.i64.cast([0,389]),d[4],f,f,c.i64.cast([0,0]),c.i64.cast([0,0]),f,f,c.i64.cast([0,0]))}])},function(a){return c.resolve(e)}])}c=a;f["default"]=c}),66);
__d("LSCreateE2EEMetadataThread",["LSIssueNewTask"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1];c.n;var d=[],e=[],f;return c.seq([function(e){return d[0]=new c.Map(),d[0].set("wa_jid",a[0]),d[0].set("offline_thread_key",a[1]),d[0].set("thread_type",a[2]),d[0].set("folder_type",a[3]),d[0].set("bump_timestamp_ms",a[4]),d[0].set("tam_thread_subtype",c.i64.cast([0,0])),d[1]=d[0].get("offline_thread_key"),d[0],d[2]=c.toJSON(d[0]),c.sp(b("LSIssueNewTask"),c.i64.to_string(d[1]),c.i64.cast([0,388]),d[2],f,f,c.i64.cast([0,0]),c.i64.cast([0,0]),f,f,c.i64.cast([0,0]))},function(a){return c.resolve(e)}])}c=a;f["default"]=c}),66);
__d("LSUpdateE2EEMetadataParticipants",["LSIssueNewTask"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1];c.n;var d=[],e=[],f;return c.seq([function(e){return d[0]=new c.Map(),d[0].set("thread_key",a[0]),d[1]=d[0].get("thread_key"),d[0],d[2]=c.toJSON(d[0]),c.sp(b("LSIssueNewTask"),c.i64.to_string(d[1]),c.i64.cast([0,394]),d[2],f,f,c.i64.cast([0,0]),c.i64.cast([0,0]),f,f,c.i64.cast([0,0]))},function(a){return c.resolve(e)}])}c=a;f["default"]=c}),66);
__d("LSUpsertAttachmentRange",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1];b.n;var c=[];return b.seq([function(c){return b.seq([function(c){return b.fe(b.db.table(17).fetch([[[a[0],a[1]]]]),function(a){return a["delete"]()})},function(c){return b.db.table(17).add({threadKey:a[0],mediaGroup:a[1],minTimestampMs:a[2],maxTimestampMs:b.i64.cast([2328,1316134911]),hasMoreBefore:a[3],hasMoreAfter:!1,isLoadingBefore:!1,isLoadingAfter:!1})}])},function(a){return b.resolve(c)}])}b=a;f["default"]=b}),66);
__d("MAWCatQuery_facebookRelayOperation",[],(function(a,b,c,d,e,f){e.exports="6303045499794432"}),null);
__d("MAWCatQuery.facebook.graphql",["MAWCatQuery_facebookRelayOperation"],(function(a,b,c,d,e,f){"use strict";a=function(){var a=[{alias:null,args:null,concreteType:"SecureMessageOverWACATGraphResult",kind:"LinkedField",name:"secure_message_over_wa_cat_query",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"encrypted_serialized_cat",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"expiration_time_in_seconds",storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:[],kind:"Fragment",metadata:null,name:"MAWCatQuery",selections:a,type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[],kind:"Operation",name:"MAWCatQuery",selections:a},params:{id:b("MAWCatQuery_facebookRelayOperation"),metadata:{},name:"MAWCatQuery",operationKind:"query",text:null}}}();e.exports=a}),null);
__d("MAWCatQuery.graphql",["cr:11203"],(function(a,b,c,d,e,f){"use strict";e.exports=b("cr:11203")}),null);
__d("MAWCatQuery",["MAWCatQuery.graphql"],(function(a,b,c,d,e,f,g){"use strict";var h;a=h!==void 0?h:h=b("MAWCatQuery.graphql");c=a;g["default"]=c}),98);
__d("MAWDbContact",[],(function(a,b,c,d,e,f){"use strict";a=0;b=1;c=2;d=3;f.NON_CONTACT=a;f.ONE_WAY_CONTACT=b;f.REVERSED_ONE_WAY_CONTACT=c;f.TWO_WAY_CONTACT=d}),66);
__d("MAWCryptoAuthToken",["FBLogger","MAWCatQuery","RelayHooks"],(function(a,b,c,d,e,f,g){"use strict";function h(a){return a==null||a.secure_message_over_wa_cat_query==null||a.secure_message_over_wa_cat_query.encrypted_serialized_cat==null||a.secure_message_over_wa_cat_query.expiration_time_in_seconds==null?{error:"Crypto Auth Token was null or incomplete"}:{success:{encrypted_serialized_cat:a.secure_message_over_wa_cat_query.encrypted_serialized_cat,expiration_time_in_seconds:a.secure_message_over_wa_cat_query.expiration_time_in_seconds}}}function a(a){return d("RelayHooks").fetchQuery(a,c("MAWCatQuery"),{}).toPromise().then(h).then(function(a){if(a.error!==null&&a.error!==void 0)throw c("FBLogger")("mpf_web_foundations").mustfixThrow("[MAWCryptoAuthToken] Error while fetching CAT from GraphQL: %s",a.error);return a.success})}g.fetchFreshCAT=a}),98);
__d("WAFixedSizeMap",[],(function(a,b,c,d,e,f){a=function(){function a(a){a=a.max;this.$1=new Map();this.$2=new Map();this.$3=0;this.$4=100;this.$4=a}var b=a.prototype;b.has=function(a){return this.$1.has(a)};b.get=function(a){return this.$1.get(a)};b.set=function(a,b){this.$1.set(a,b);this.$2.set(this.$3,a);this.$3+=1;b=this.$2.get(this.$3-this.$4-1);b!=null&&(this.$1["delete"](b),this.$2["delete"](this.$3-this.$4-1))};b.clear=function(){this.$1.clear(),this.$2.clear(),this.$3=0};b.size=function(){return this.$1.size};return a}();f.FixedSizeMap=a}),66);
__d("MAWJobActionsV2",["MAWTransactionMode","Promise","WAFixedSizeMap","WAHex","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(a){return new(h||(h=b("Promise")))(function(b,c){a.onsuccess=b,a.onerror=c})}function j(a){return i(a).then(function(a){return a.target.result})}function k(a,c,e){return new(h||(h=b("Promise")))(function(b,f){var g=a(d("MAWTransactionMode").READONLY).index(c);g=g.openCursor(IDBKeyRange.only(e));var h=[];g.onsuccess=function(a){a=a.target.result;if(!a){b(h);return}h.push(a.value);a["continue"]()};g.onerror=function(a){return f(a)}})}var l=new(d("WAFixedSizeMap").FixedSizeMap)({max:100});function a(a,c){var e,f=c.args,g=c.scheduleConfig,i=c.type,l=c.uniqKey;c=c.version;c=c===void 0?1:c;e=JSON.stringify([i,(e=l)!=null?e:d("WAHex").randomHex(32)]);var n={backedOffCount:0,current:f,original:f,scheduleConfig:g,startTime:d("WATimeUtils").unixTime(),step:"$unstarted",stepFirstStartTime:null,stepHardStartCountAfterTimeout:0,stepUnexpectedErrorCount:0,type:i,uniqKey:e,version:c,waitUntil:null},o=function(){var b,c=a().add(n),d=j(c);if(n.uniqKey==null&&typeof ((b=c.transaction)==null?void 0:b.commit)==="function")try{c.transaction.commit()}catch(a){}return d.then(function(a){return{id:a,newlyCreated:!0}})};if(l!=null)return k(a,"uniqKey",e).then(function(c){if(c.length===0)return o();var d=[],e=null;c.forEach(function(b){b.step!=="$finished"?e=b:d.push(m(a,b.jobId))});return(h||(h=b("Promise"))).all(d).then(function(){return e!=null?{id:e.jobId,newlyCreated:!1}:o()})});else return o()}function m(a,b){return j(a()["delete"](b))}function c(a,b){return j(a().get(b))}function e(a,b){return j(a().put(b))}function f(a){return j(a().getAll())}function n(a){return i(a().clear()).then(function(){})}g.recentFinishedJobsCache=l;g.maybeCreateJob=a;g.deletePersistedJob=m;g.readPersistedJob=c;g.updatePersistedJob=e;g.readAllPersistedJobs=f;g.clearJobs=n}),98);
__d("MessengerWaitForEvent",["Promise"],(function(a,b,c,d,e,f){"use strict";var g;function a(a,c,d){var e,f=d;return new(g||(g=b("Promise")))(function(b){f?e=function(){f.apply(this,arguments)&&b.apply(this,arguments)}:e=b,a==null?void 0:a.addEventListener==null?void 0:a.addEventListener(c,e)})["finally"](function(){a==null?void 0:a.removeEventListener==null?void 0:a.removeEventListener(c,e)})}f.waitForEvent=a}),66);
__d("LocalStorageMutex",["MessengerWaitForEvent","Promise","QPLUserFlow","err","pageID","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h,i=null,j=1e3;a=function(){function a(a){var b=this,d=a.mutexKey,e=a.localTakeoverKey,f=a.log,g=a.logError,h=a.getStorage,i=a.setItemGuarded,k=a.mutexTimeoutMs;k=k===void 0?j:k;a=a.mutexTimeoutCallback;this.mutexFilter=function(a){if(a.key!==b.$1)return!1;a=a.newValue||"";if(!a.includes(c("pageID")))return!0;else return!1};this.$1=d;this.$2=e;this.$5=h;this.$6=i;this.$3=f;this.$4=g;this.$7=k;this.$8=a}var e=a.prototype;e.init=function(){c("QPLUserFlow").start(c("qpl")._(1056847375,"584"));this.$3("APPMUTEX - this tab is "+c("pageID"));var a=this.getMutex();if(a!=null&&a===c("pageID")){this.$3("APPMUTEX - WE ALREADY HAVE THE MUTEX LOCK WITHIN INIT");c("QPLUserFlow").endSuccess(c("qpl")._(1056847375,"584"));return(h||(h=b("Promise"))).resolve(!0)}if(a!=null){this.$3("APPMUTEX - initiating localTAKEOVER");return this.localTakeover()}else{this.$3("APPMUTEX - NO1 ELSE IS ALIVE, GET THE MUTEX");a=this.$9(c("pageID"));var d=this.$10(c("pageID"));if(!a.success||!d.success){c("QPLUserFlow").addAnnotations(c("qpl")._(1056847375,"584"),{bool:{setMutexResult:d.success,setTakeoverResult:a.success},string:{setMutexError:d.error,setTakeoverError:a.error}});c("QPLUserFlow").endFailure(c("qpl")._(1056847375,"584"),"fail_to_set_takeover_or_mutex");return(h||(h=b("Promise"))).resolve(!1)}c("QPLUserFlow").endSuccess(c("qpl")._(1056847375,"584"));return(h||(h=b("Promise"))).resolve(!0)}};e.localTakeover=function(){var a,e=this,f=this.$9(c("pageID"));if(!f.success){c("QPLUserFlow").addAnnotations(c("qpl")._(1056847375,"584"),{string:{initTakeoverError:f.error}});c("QPLUserFlow").endFailure(c("qpl")._(1056847375,"584"),"local_takeover_init_takeover_failure");return(h||(h=b("Promise"))).resolve(!1)}var g,i=function(){g!=null&&clearTimeout(g)};f=d("MessengerWaitForEvent").waitForEvent(window,"storage",this.mutexFilter);var k=(a=this==null?void 0:this._mutexTimeoutMs)!=null?a:j;return(h||(h=b("Promise"))).race([f,new h(function(a){g=setTimeout(function(){a()},k)}),this.$8?this.$8():new(h||(h=b("Promise")))(function(a){})]).then(function(a){if(a==null){e.$3("AppMutex - Forcefully took the mutex and takeover lock");var b=e.$9(c("pageID")),d=e.$10(c("pageID"));if(!b.success||!d.success){c("QPLUserFlow").addAnnotations(c("qpl")._(1056847375,"584"),{string:{setMutexError:d.error,setTakeoverError:b.error}});c("QPLUserFlow").endFailure(c("qpl")._(1056847375,"584"),"local_takeover_forcefully_takeover_failure");return!1}c("QPLUserFlow").endSuccess(c("qpl")._(1056847375,"584"));return!0}e.$3("APPMUTEX - GOT MUTEX STORAGE EVENT CHANGE FROM ANOTHER TAB");d=e.$11(a.newValue);if(!d&&e.hasTakeoverPermission()){e.$3("APPMUTEX - setting mutex on localtakeover");b=e.$10(c("pageID"));if(!b.success){c("QPLUserFlow").addAnnotations(c("qpl")._(1056847375,"584"),{string:{setMutexError:b.error}});c("QPLUserFlow").endFailure(c("qpl")._(1056847375,"584"),"local_takeover_set_mutex_failure");return!1}c("QPLUserFlow").endSuccess(c("qpl")._(1056847375,"584"));return!0}else{e.hasTakeoverPermission()&&e.$12();c("QPLUserFlow").endFailure(c("qpl")._(1056847375,"584"),"local_takeover_no_takeover_permission");return!1}}).then(function(a){i();return a})["catch"](function(a){i();e.$4("AppMutex - localTakeover error no permission - "+a);c("QPLUserFlow").endFailure(c("qpl")._(1056847375,"584"),"local_takeover_general_failure");return!1})};e.onMutexDeath=function(){var a=this.getMutex();a!=null&&a==c("pageID")&&(this.$3("APPMUTEX - removing mutex on death"),this.$13(),this.hasTakeoverPermission()&&this.$12())};e.takeoverFilter=function(a){if(a.key!==this.$2)return!1;a=a.newValue||"";if(!a.includes(c("pageID")))return!0;else return!1};e.$14=function(){if(!i){var a=this.$5();if(!a)throw c("err")("Could not get localStorage");i=a}return i};e.getMutex=function(){i=this.$14();return i.getItem(this.$1)};e.$10=function(a){i=this.$14();return this.$6(i,this.$1,a)};e.$13=function(){i=this.$14(),i.removeItem(this.$1)};e.getTakeover=function(){i=this.$14();return i.getItem(this.$2)};e.$9=function(a){i=this.$14();a=this.$6(i,this.$2,a);return a};e.$12=function(){i=this.$14(),i.removeItem(this.$2)};e.$11=function(a){return a!=null?a:""};e.hasTakeoverPermission=function(){var a=this.getTakeover();return a!=null&&a==c("pageID")};return a}();g.THIS_TAB=c("pageID");g.LocalStorageMutex=a}),98);
__d("MAWAppMutex",["LocalStorageMutex","MAWLocalStorage","WALogger"],(function(a,b,c,d,e,f,g){"use strict";var h="armadillo_msgr_mutex",i="armadillo_msgr_local_takeover",j=null;function a(){j==null&&(j=new(d("LocalStorageMutex").LocalStorageMutex)({getStorage:d("MAWLocalStorage").getStorage,localTakeoverKey:i,log:function(a){d("WALogger").LOG([a])},logError:function(a){d("WALogger").ERROR([a])},mutexKey:h,setItemGuarded:d("MAWLocalStorage").setItemGuarded}));return j}g.MAW_MUTEX_KEY=h;g.MAW_LOCALTAKEOVER_KEY=i;g.use=a}),98);
__d("MAWLocalizationEphemeralSettingSetAdminMsg",["MAWLocalizationType"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return a===d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_EPHEMERAL_SETTING_TURNED_ON_SECONDS||a===d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_EPHEMERAL_SETTING_TURNED_ON_MINUTES||a===d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_EPHEMERAL_SETTING_TURNED_ON_HOURS||a===d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_EPHEMERAL_SETTING_TURNED_ON_DAYS||a===d("MAWLocalizationType").LOCALIZATION_TYPE.YOU_EPHEMERAL_SETTING_TURNED_ON_SECONDS||a===d("MAWLocalizationType").LOCALIZATION_TYPE.YOU_EPHEMERAL_SETTING_TURNED_ON_MINUTES||a===d("MAWLocalizationType").LOCALIZATION_TYPE.YOU_EPHEMERAL_SETTING_TURNED_ON_HOURS||a===d("MAWLocalizationType").LOCALIZATION_TYPE.YOU_EPHEMERAL_SETTING_TURNED_ON_DAYS||a===d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_TURNED_ON_SECONDS||a===d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_TURNED_ON_MINUTES||a===d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_TURNED_ON_HOURS||a===d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_TURNED_ON_DAYS||a===d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_EPHEMERAL_SETTING_CHANGE_SECONDS||a===d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_EPHEMERAL_SETTING_CHANGE_MINUTES||a===d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_EPHEMERAL_SETTING_CHANGE_HOURS||a===d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_EPHEMERAL_SETTING_CHANGE_DAYS||a===d("MAWLocalizationType").LOCALIZATION_TYPE.YOU_EPHEMERAL_SETTING_CHANGE_SECONDS||a===d("MAWLocalizationType").LOCALIZATION_TYPE.YOU_EPHEMERAL_SETTING_CHANGE_MINUTES||a===d("MAWLocalizationType").LOCALIZATION_TYPE.YOU_EPHEMERAL_SETTING_CHANGE_HOURS||a===d("MAWLocalizationType").LOCALIZATION_TYPE.YOU_EPHEMERAL_SETTING_CHANGE_DAYS||a===d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_CHANGE_SECONDS||a===d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_CHANGE_MINUTES||a===d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_CHANGE_HOURS||a===d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_CHANGE_DAYS||a===d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_EPHEMERAL_SETTING_TURNED_OFF||a===d("MAWLocalizationType").LOCALIZATION_TYPE.YOU_EPHEMERAL_SETTING_TURNED_OFF||a===d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_TURNED_OFF}g.isEphemeralSettingSetAdminMsg=a}),98);
__d("MAWAdminMsgCTA",["fbt","I64","MAWLocalizationEphemeralSettingSetAdminMsg","MAWLocalizationType","MAWTimeUtils","Promise","ReQL","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j=h._("__JHASH__iw7A0LnsmaW__JHASH__").toString(),k=h._("__JHASH__jODYJ2eW1Pa__JHASH__").toString(),l=h._("__JHASH__xAOSvpC7vLN__JHASH__").toString();function m(a){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(yield d("ReQL").firstAsync(d("ReQL").fromTableDescending(a.table("admin_message_ctas").index("ctaId"))));return a!=null?d("I64").add(a.ctaId,d("I64").one):d("I64").zero});return n.apply(this,arguments)}function o(a,b,c){b={hd:b,tl:{hd:c,tl:0}};return d("ReQL").firstAsync(d("ReQL").fromTableDescending(a.table("admin_message_ctas")).bounds({gte:b,lte:b}))}function p(a){if(a==null)return{showAdChoiceIcon:!1};if(d("MAWLocalizationEphemeralSettingSetAdminMsg").isEphemeralSettingSetAdminMsg(a))return{actionUrl:void 0,adClientToken:void 0,adHelpUrl:void 0,adminMessageNicknameParticipantId:void 0,adPreferenceUrl:void 0,showAdChoiceIcon:!1,targetId:void 0,targetTitle:void 0,title:j};switch(a){case d("MAWLocalizationType").CUTOVER_THREAD_ADMIN_MESSAGE:case d("MAWLocalizationType").CUTOVER_IGD_THREAD_ADMIN_MESSAGE:case d("MAWLocalizationType").E2EE_THREAD_DESCRIPTION:return{actionUrl:void 0,adClientToken:void 0,adHelpUrl:void 0,adminMessageNicknameParticipantId:void 0,adPreferenceUrl:void 0,showAdChoiceIcon:!1,targetId:void 0,targetTitle:void 0,title:k};case d("MAWLocalizationType").CUTOVER_ROLLBACK_ADMIN_MESSAGE:return{actionUrl:void 0,adClientToken:void 0,adHelpUrl:void 0,adminMessageNicknameParticipantId:void 0,adPreferenceUrl:void 0,showAdChoiceIcon:!1,targetId:void 0,targetTitle:void 0,title:l};default:return{actionUrl:void 0,adClientToken:void 0,adHelpUrl:void 0,adminMessageNicknameParticipantId:void 0,adPreferenceUrl:void 0,showAdChoiceIcon:!1,targetId:void 0,targetTitle:void 0,title:void 0}}}function q(a){if(a==null)return;if(d("MAWLocalizationEphemeralSettingSetAdminMsg").isEphemeralSettingSetAdminMsg(a))return"admin_msg_armadillo_ephemeral_change_duration";switch(a){case d("MAWLocalizationType").CUTOVER_THREAD_ADMIN_MESSAGE:case d("MAWLocalizationType").CUTOVER_IGD_THREAD_ADMIN_MESSAGE:return"admin_msg_thread_level_cutover";case d("MAWLocalizationType").E2EE_THREAD_DESCRIPTION:return"admin_msg_e2ee_thread";case d("MAWLocalizationType").CUTOVER_ROLLBACK_ADMIN_MESSAGE:return"admin_msg_cutover_rollback"}}function r(a,b,c,e,f){return a.table("admin_message_ctas").add({actionUrl:f.actionUrl,adClientToken:f.adClientToken,adHelpUrl:f.adHelpUrl,adminMessageNicknameParticipantId:f.adminMessageNicknameParticipantId,adPreferenceUrl:f.adPreferenceUrl,ctaId:b,messageId:e.msgId,showAdChoiceIcon:f.showAdChoiceIcon,targetId:f.targetId,targetTitle:f.targetTitle,threadKey:c,timestampMs:d("MAWTimeUtils").toTimestamp(e.ts),title:f.title})}function s(a,b,c){return t.apply(this,arguments)}function t(){t=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c,d){var e=(yield (i||(i=b("Promise"))).all([o(a,c,d.msgId),m(a)])),f=e[0];e=e[1];if(f!=null)return{ctaId:f.ctaId,ctaType:q(d.adminType),title:f.title};else{f=p(d.adminType);yield r(a,e,c,d,f);return{ctaId:e,ctaType:q(d.adminType),title:f.title}}});return t.apply(this,arguments)}function a(a,c,e){var f=e.adminType;return f!=null&&(d("MAWLocalizationEphemeralSettingSetAdminMsg").isEphemeralSettingSetAdminMsg(f)||f===d("MAWLocalizationType").CUTOVER_THREAD_ADMIN_MESSAGE||f===d("MAWLocalizationType").CUTOVER_IGD_THREAD_ADMIN_MESSAGE||f===d("MAWLocalizationType").E2EE_THREAD_DESCRIPTION||f===d("MAWLocalizationType").CUTOVER_ROLLBACK_ADMIN_MESSAGE)?s(a,c,e):(i||(i=b("Promise"))).resolve()}g.getAdminMsgCtaStep=a}),98);
__d("MAWContactRelationshipType",["I64","LSContactBitOffset","LSIntEnum","MAWDbContact"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=d("LSContactBitOffset").hasWithDefault(d("LSIntEnum").ofNumber(64),a,!0);a=d("I64").ge(a.contactViewerRelationship,d("I64").of_string("2"));if(a&&b)return d("MAWDbContact").ONE_WAY_CONTACT;else if(!a&&!b)return d("MAWDbContact").REVERSED_ONE_WAY_CONTACT;else if(a&&!b)return d("MAWDbContact").TWO_WAY_CONTACT;return d("MAWDbContact").NON_CONTACT}g.getContactRelationshipType=a}),98);
__d("MAWMedia",["LSIntEnum","MAWDbMedia","MessagingAttachmentType"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){if(a===d("MAWDbMedia").IMAGE)return b!=null?d("LSIntEnum").ofNumber(c("MessagingAttachmentType").EPHEMERAL_IMAGE):d("LSIntEnum").ofNumber(c("MessagingAttachmentType").IMAGE);else if(a===d("MAWDbMedia").VIDEO)return b!=null?d("LSIntEnum").ofNumber(c("MessagingAttachmentType").EPHEMERAL_VIDEO):d("LSIntEnum").ofNumber(c("MessagingAttachmentType").VIDEO);else if(a===d("MAWDbMedia").PTT)return d("LSIntEnum").ofNumber(c("MessagingAttachmentType").AUDIO);else if(a===d("MAWDbMedia").GIF)return d("LSIntEnum").ofNumber(c("MessagingAttachmentType").ANIMATED_IMAGE);else if(a===d("MAWDbMedia").STICKER)return d("LSIntEnum").ofNumber(c("MessagingAttachmentType").STICKER);else if(a===d("MAWDbMedia").DOCUMENT_FILE)return d("LSIntEnum").ofNumber(c("MessagingAttachmentType").FILE);return d("LSIntEnum").ofNumber(c("MessagingAttachmentType").NONE)}g.mediaTypeToMessageAttachmentType=a}),98);
__d("LSCoreClientFolderType",[],(function(a,b,c,d,e,f){a=Object.freeze({INBOX:0,PENDING:1,OTHER:2,SPAM:3,ARCHIVED:4,HIDDEN:5,MARKETPLACE:12,RESTRICTED:15});f["default"]=a}),66);
__d("MessagingFolderTag",[],(function(a,b,c,d,e,f){a=Object.freeze({INBOX:"inbox",OTHER:"other",SPAM:"spam",PENDING:"pending",MONTAGE:"montage",HIDDEN:"hidden",LEGACY:"legacy",DISABLED:"disabled",PAGE_BACKGROUND:"page_background",PAGE_DONE:"page_done",BLOCKED:"blocked",COMMUNITY:"community",RESTRICTED:"restricted",BC_PARTNERSHIP:"bc_partnership",E2EE_CUTOVER:"e2ee_cutover",INTEROP:"interop",ARCHIVED:"archived",UNKNOWN:""});f["default"]=a}),66);
__d("MAWFolderUtils",["LSCoreClientFolderType","LSIntEnum","MAWFolderTypes","MessagingFolderTag"],(function(a,b,c,d,e,f,g){"use strict";function a(a){switch(a){case d("MAWFolderTypes").PENDING:return c("MessagingFolderTag").PENDING;case d("MAWFolderTypes").OTHER:return c("MessagingFolderTag").OTHER;case d("MAWFolderTypes").SPAM:return c("MessagingFolderTag").SPAM;case d("MAWFolderTypes").ARCHIVED:return c("MessagingFolderTag").UNKNOWN;default:return c("MessagingFolderTag").INBOX}}function b(a){switch(a){case d("MAWFolderTypes").PENDING:return d("LSIntEnum").ofNumber(-101);case d("MAWFolderTypes").OTHER:return d("LSIntEnum").ofNumber(-102);case d("MAWFolderTypes").SPAM:return d("LSIntEnum").ofNumber(-103);case d("MAWFolderTypes").ARCHIVED:return d("LSIntEnum").ofNumber(-110);default:return d("LSIntEnum").ofNumber(-100)}}function e(a){switch(a){case d("MAWFolderTypes").INBOX:return d("LSIntEnum").ofNumber(c("LSCoreClientFolderType").INBOX);case d("MAWFolderTypes").PENDING:return d("LSIntEnum").ofNumber(c("LSCoreClientFolderType").PENDING);case d("MAWFolderTypes").OTHER:return d("LSIntEnum").ofNumber(c("LSCoreClientFolderType").OTHER);case d("MAWFolderTypes").SPAM:return d("LSIntEnum").ofNumber(c("LSCoreClientFolderType").SPAM);case d("MAWFolderTypes").ARCHIVED:return d("LSIntEnum").ofNumber(c("LSCoreClientFolderType").ARCHIVED)}}function f(a){switch(a){case d("LSIntEnum").ofNumber(-1):return d("LSIntEnum").ofNumber(-101);case d("LSIntEnum").ofNumber(-2):return d("LSIntEnum").ofNumber(-102);case d("LSIntEnum").ofNumber(-3):return d("LSIntEnum").ofNumber(-103);case d("LSIntEnum").ofNumber(-10):return d("LSIntEnum").ofNumber(-110);default:return d("LSIntEnum").ofNumber(-100)}}g.getMessagingFolderTag=a;g.getClientSystemFolder=b;g.systemFolderToLSCoreClientFolder=e;g.systemFolderToClientSystemFolder=f}),98);
__d("getMAWLastMessageCtaType",["MAWLocalizationType"],(function(a,b,c,d,e,f,g){"use strict";function a(a){a=a.snippetType;switch(a){case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_MISSED_AUDIO_CALL:return"xma_rtc_missed_audio";case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_MISSED_AUDIO_CALL:return"xma_rtc_missed_group_audio";case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_MISSED_VIDEO_CALL:return"xma_rtc_missed_video";case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_MISSED_VIDEO_CALL:return"xma_rtc_missed_group_video"}}g["default"]=a}),98);
__d("MAWFrontendMediaUtils",["MAWDbMedia"],(function(a,b,c,d,e,f,g){"use strict";function a(a){if(a==="image/gif")return{mediaType:d("MAWDbMedia").MEDIA_TYPE.GIF,serverMediaType:"gif"};if(a==="image/webp")return{mediaType:d("MAWDbMedia").MEDIA_TYPE.STICKER,serverMediaType:"sticker"};a=a.split("/")[0];switch(a){case"image":return{mediaType:d("MAWDbMedia").MEDIA_TYPE.IMAGE,serverMediaType:"image"};case"video":return{mediaType:d("MAWDbMedia").MEDIA_TYPE.VIDEO,serverMediaType:"video"};case"audio":return{mediaType:d("MAWDbMedia").MEDIA_TYPE.PTT,serverMediaType:"ptt"};case"application":default:return{mediaType:d("MAWDbMedia").MEDIA_TYPE.DOCUMENT_FILE,serverMediaType:"document"}}}g.getMediaTypeAndServerMediaTypeFromBlob=a}),98);
__d("EphemeralMediaViewMode",[],(function(a,b,c,d,e,f){a=Object.freeze({READ_ONCE:0,REPLAYABLE:1,PERMANENT:2});f["default"]=a}),66);
__d("MAWRavenUtils",["EphemeralMediaViewMode","MAWMsg","RavenMessagingState"],(function(a,b,c,d,e,f,g){"use strict";var h=function(a){switch(a){case d("MAWMsg").MAWRavenMsgEphemeralMediaState.PERMANENT:return c("RavenMessagingState").PERMANENT;case d("MAWMsg").MAWRavenMsgEphemeralMediaState.UNSEEN:return c("RavenMessagingState").UNSEEN;case d("MAWMsg").MAWRavenMsgEphemeralMediaState.SEEN:return c("RavenMessagingState").SEEN;case d("MAWMsg").MAWRavenMsgEphemeralMediaState.REPLAYED:return c("RavenMessagingState").REPLAYED;case d("MAWMsg").MAWRavenMsgEphemeralMediaState.EXPIRED:return c("RavenMessagingState").EXPIRED}};b=function(a){switch(a){case d("MAWMsg").MAWRavenMsgEphemeralType.KEEP_IN_CHAT:return c("EphemeralMediaViewMode").PERMANENT;case d("MAWMsg").MAWRavenMsgEphemeralType.ALLOW_REPLAY:return c("EphemeralMediaViewMode").REPLAYABLE;case d("MAWMsg").MAWRavenMsgEphemeralType.VIEW_ONCE:return c("EphemeralMediaViewMode").READ_ONCE}};function a(a,b){switch(b){case d("MAWMsg").MAWRavenMsgEphemeralType.VIEW_ONCE:return a===d("MAWMsg").MAWRavenMsgEphemeralMediaState.UNSEEN?c("RavenMessagingState").SEEN:h(a);case d("MAWMsg").MAWRavenMsgEphemeralType.ALLOW_REPLAY:if(a===d("MAWMsg").MAWRavenMsgEphemeralMediaState.UNSEEN)return c("RavenMessagingState").SEEN;else if(a===d("MAWMsg").MAWRavenMsgEphemeralMediaState.SEEN)return c("RavenMessagingState").REPLAYED;return h(a);case d("MAWMsg").MAWRavenMsgEphemeralType.KEEP_IN_CHAT:return h(a)}}g.getEphemeralMediaState=h;g.getEphemeralMediaViewMode=b;g.getNextRavenMessageEphemeralState=a}),98);
__d("MNXMAPreviewImageDecorationType",[],(function(a,b,c,d,e,f){a=Object.freeze({DEFAULT:0,COLLAGE:1,VIDEO:2,MESSENGER_ICON:3,INSTAGRAM_ICON:4,SHOPPING:5,UPCOMING_EVENT:6,LIVE:7,REEL:8,IGTV:9,YOUTUBE_VIDEO:10,YOUTUBE_SHORTS:11});f["default"]=a}),66);
__d("MAWBridgeNewXMAHandler",["I64","LSIntEnum","MAWBridgeUIEventDataValidation","MAWDbMsg","MAWMiActOnMiThreadReadyForChatId","MNLSXMALayoutType","MNXMAPreviewImageDecorationType","MessagingAttachmentType","Promise","ReQL","WAArmadilloXMA.pb","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(a,b){if(a==null)return;a=a[b-1];if(a==null)return;return a.buttonType===d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_SINGLE_VIDEO_POST_SHARE?"xma_open_native":void 0}function j(a,b){if(a==null)return;a=a[b-1];if(a!=null)return a.title}function k(a){return a===0||a!==3?d("LSIntEnum").ofNumber(c("MNLSXMALayoutType").SINGLE):d("LSIntEnum").ofNumber(c("MNLSXMALayoutType").PORTRAIT)}function l(a){switch(a){case 10:return d("LSIntEnum").ofNumber(c("MNXMAPreviewImageDecorationType").COLLAGE);case 14:return d("LSIntEnum").ofNumber(c("MNXMAPreviewImageDecorationType").REEL);case 5:case 6:case 7:case 8:case 9:case 11:case 15:case 16:case 17:case 18:case 19:return d("LSIntEnum").ofNumber(c("MNXMAPreviewImageDecorationType").DEFAULT);case 4:case 12:case 13:case 20:case 21:case 22:case 23:case 24:return d("LSIntEnum").ofNumber(c("MNXMAPreviewImageDecorationType").INSTAGRAM_ICON);default:return d("LSIntEnum").ofNumber(c("MNXMAPreviewImageDecorationType").DEFAULT)}}function m(a,b,c){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f){var g=String(e.xmaId),m=e.msgId;if(m!=null){var n=(yield d("ReQL").firstAsync(d("ReQL").fromTableDescending(a.table("attachment_ctas"))));n=n!=null?d("I64").add(n.ctaId,d("I64").one):d("I64").one;var o=e.defaultCTA;if(o!=null){var p=o.actionUrl,q=o.nativeUrl,r="xma_web_url";switch(e.targetType){case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_AUDIO_CALL:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_GROUP_AUDIO_CALL:r="xma_rtc_audio";break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_VIDEO_CALL:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_GROUP_VIDEO_CALL:r="xma_rtc_video";break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_MISSED_AUDIO_CALL:r="xma_rtc_missed_audio";break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_MISSED_VIDEO_CALL:r="xma_rtc_missed_video";break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_SINGLE_IMAGE_POST_SHARE:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_MULTIPOST_SHARE:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_CLIPS_SHARE:r="igd_web_post_share";break}var s=e.targetId!=null?d("MAWBridgeUIEventDataValidation").stringToI64Opt(e.targetId):void 0;yield a.table("attachment_ctas").add({actionContentBlob:void 0,actionUrl:p!=null?p:q,attachmentFbid:g,attachmentIndex:d("I64").zero,ctaId:n,enableExtensions:!1,extensionHeightType:void 0,messageId:m,nativeUrl:q!=null?q:p,platformToken:void 0,targetId:s,threadKey:f,title:(q=o.title)!=null?q:"",type_:r,urlWebviewType:void 0})}p=o==null?void 0:n;var t=n,u=[];s=e.ctas;if(s!=null){q=s.map(function(b,c){c=d("I64").add(t,d("I64").of_int32(c+1));u.push(c);var e=b.actionUrl,h=b.nativeUrl;return a.table("attachment_ctas").add({actionContentBlob:void 0,actionUrl:e!=null?e:h,attachmentFbid:g,attachmentIndex:d("I64").zero,ctaId:c,enableExtensions:!1,extensionHeightType:void 0,messageId:m,nativeUrl:h!=null?h:e,platformToken:void 0,targetId:void 0,threadKey:f,title:(c=b.title)!=null?c:"Tap to view status update",type_:"xma_web_url",urlWebviewType:void 0})});yield (h||(h=b("Promise"))).all(q)}r=d("I64").of_int32(d("MAWDbMsg").getInChatMsgIdFromMsgId(m));var v;switch(e.targetType){case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_STORY_SHARE:v={height:d("I64").of_int32(108),width:d("I64").of_int32(72),xmaContentType:"xma_montage_share"};break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_AUDIO_CALL:v={xmaContentType:"xma_rtc_audio"};break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_VIDEO_CALL:v={xmaContentType:"xma_rtc_video"};break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_MISSED_AUDIO_CALL:v={xmaContentType:"xma_rtc_missed_audio"};break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_MISSED_VIDEO_CALL:v={xmaContentType:"xma_rtc_missed_video"};break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_GROUP_AUDIO_CALL:v={xmaContentType:"xma_rtc_missed_group_audio"};break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_GROUP_VIDEO_CALL:v={xmaContentType:"xma_rtc_missed_group_video"};break;default:v={height:e.previewHeight!=null?d("I64").of_int32(e.previewHeight):void 0,width:e.previewWidth!=null?d("I64").of_int32(e.previewWidth):void 0,xmaContentType:"xma_web_url"};break}return a.table("attachments").add({accessibilitySummaryText:void 0,actionUrl:void 0,attachmentCta1Id:u.length>0?u[0]:void 0,attachmentCta2Id:u.length>1?u[1]:void 0,attachmentCta3Id:u.length>2?u[2]:void 0,attachmentFbid:g,attachmentIndex:d("I64").zero,attachmentLoggingType:void 0,attachmentType:d("LSIntEnum").ofNumber(c("MessagingAttachmentType").XMA),attributionAppIcon:void 0,attributionAppIconFallback:void 0,attributionAppIconUrlExpirationTimestampMs:void 0,attributionAppId:void 0,attributionAppName:void 0,authorityLevel:d("I64").zero,avatarCount:void 0,avatarViewAccessibilityLabel:void 0,avatarViewSize:void 0,avatarViewTitleList:void 0,avatarViewUrlExpirationTimestampList:void 0,avatarViewUrlFallbackList:void 0,avatarViewUrlList:void 0,captionBodyText:void 0,cta1Title:j(e.ctas,1),cta1Type:i(e.ctas,1),cta2Title:j(e.ctas,2),cta2Type:i(e.ctas,2),cta3Title:j(e.ctas,3),cta3Type:i(e.ctas,3),dashManifest:void 0,decryptionKey:void 0,defaultCtaId:p,defaultCtaTitle:(o=e.defaultCTA)==null?void 0:o.title,defaultCtaType:v.xmaContentType,descriptionText:void 0,ephemeralMediaState:void 0,faviconUrl:void 0,faviconUrlExpirationTimestampMs:void 0,faviconUrlFallback:void 0,filename:void 0,filesize:e.filesize!=null?d("I64").of_int32(e.filesize):void 0,gatingTitle:e.overlayTitle,gatingType:e.overlayIconGlyph!=null?String(e.overlayIconGlyph):void 0,hasMedia:!1,hasXma:!0,headerImageUrl:void 0,headerImageUrlExpirationTimestampMs:void 0,headerImageUrlFallback:void 0,headerImageUrlMimeType:void 0,headerTitle:e.headerTitle,imageUrl:void 0,imageUrlExpirationTimestampMs:void 0,imageUrlFallback:void 0,imageUrlMimeType:void 0,isBorderless:void 0,isPreviewImage:void 0,isSharable:!0,listItemAccessibilityText1:void 0,listItemAccessibilityText2:void 0,listItemAccessibilityText3:void 0,listItemContactUrlExpirationTimestampList1:void 0,listItemContactUrlExpirationTimestampList2:void 0,listItemContactUrlExpirationTimestampList3:void 0,listItemContactUrlFallbackList1:void 0,listItemContactUrlFallbackList2:void 0,listItemContactUrlFallbackList3:void 0,listItemContactUrlList1:void 0,listItemContactUrlList2:void 0,listItemContactUrlList3:void 0,listItemId1:void 0,listItemId2:void 0,listItemId3:void 0,listItemProfilePictureUrl1:void 0,listItemProfilePictureUrl2:void 0,listItemProfilePictureUrl3:void 0,listItemProfilePictureUrlExpirationTimestamp1:void 0,listItemProfilePictureUrlExpirationTimestamp2:void 0,listItemProfilePictureUrlExpirationTimestamp3:void 0,listItemProfilePictureUrlFallback1:void 0,listItemProfilePictureUrlFallback2:void 0,listItemProfilePictureUrlFallback3:void 0,listItemProgressBarFilledPercentage1:void 0,listItemProgressBarFilledPercentage2:void 0,listItemProgressBarFilledPercentage3:void 0,listItemsDescriptionSubtitleText:void 0,listItemsDescriptionText:void 0,listItemsId:void 0,listItemsSecondaryDescriptionText:void 0,listItemTitleText1:void 0,listItemTitleText2:void 0,listItemTitleText3:void 0,localPlayableUrl:void 0,maxSubtitleNumOfLines:e.maxSubtitleNumOfLines!=null?d("I64").of_int32(e.maxSubtitleNumOfLines):void 0,maxTitleNumOfLines:e.maxTitleNumOfLines!=null?d("I64").of_int32(e.maxTitleNumOfLines):void 0,messageId:m,miniPreview:void 0,offlineAttachmentId:(n=e.offlineAttachmentId)!=null?n:g,originalFileHash:void 0,originalPageSenderId:void 0,playableDurationMs:void 0,playableUrl:void 0,playableUrlExpirationTimestampMs:void 0,playableUrlFallback:void 0,playableUrlMimeType:void 0,preheaderText:void 0,previewHeight:v.height,previewHeightLarge:e.previewHeightLarge!=null?d("I64").of_int32(e.previewHeightLarge):void 0,previewImageDecorationType:l(e.targetType),previewUrl:void 0,previewUrlExpirationTimestampMs:void 0,previewUrlFallback:void 0,previewUrlLarge:void 0,previewUrlMimeType:void 0,previewWidth:v.width,previewWidthLarge:e.previewWidthLarge!=null?d("I64").of_int32(e.previewWidthLarge):void 0,samplingFrequencyHz:void 0,shouldAutoplayVideo:void 0,shouldHighlightHeaderTitleInTitle:void 0,shouldRespectServerPreviewSize:void 0,sourceText:void 0,subtitleIconUrl:void 0,subtitleText:e.subtitleText,targetId:void 0,threadKey:f,timestampMs:r,titleText:e.titleText,viewerSeenTimestampMs:void 0,waveformData:void 0,xmaLayoutType:e.xmaLayoutType!=null?k(e.xmaLayoutType):void 0,xmasTemplateType:e.xmaLayoutType!=null?k(e.xmaLayoutType):void 0})}});return n.apply(this,arguments)}function o(a,b){return d("MAWMiActOnMiThreadReadyForChatId").onMiThreadReadyForChatId(a,b.threadId,"MAWBridgeNewXMAHandler",function(a,c){return m(a,b,c)})}function a(a,b){return o(a,b)}g.call=a}),98);
__d("MAWBridgeDeleteGroupInviteHandler",["MAWMiActOnMiThreadReadyForChatId","Promise","ReQL","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,c){return d("MAWMiActOnMiThreadReadyForChatId").onMiThreadReadyForChatId(a,c.threadId,"MAWBridgeDeleteGroupInviteHandler",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c){c=(yield d("ReQL").toArrayAsync(d("ReQL").fromTableAscending(a.table("group_invites")).getKeyRange(c)));return(h||(h=b("Promise"))).all(c.map(function(b){return a.table("group_invites")["delete"]({hd:b.threadKey,tl:{hd:b.inviterId,tl:{hd:b.inviteeId,tl:0}}})})).then(function(){})});return function(b,c){return a.apply(this,arguments)}}())}g.call=a}),98);
__d("MAWBridgeDeleteMessageRangesV2Handler",["I64","MAWMiActOnMiThreadReadyForChatId"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return d("MAWMiActOnMiThreadReadyForChatId").onMiThreadReadyForChatId(a,b.threadId,"MAWBridgeDeleteMessageRangesV2Handler",function(a,c){return a.table("messages_ranges_v2__generated")["delete"]({hd:c,tl:{hd:d("I64").of_float(b.minTimestampMs),tl:{hd:b.minMsgId,tl:0}}})})}g.call=a}),98);
__d("MAWBridgeDeleteMessagesHandler",["MAWMiActOnMiThreadReadyForChatId","MAWTimeUtils","ReQL","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function a(a,c){return d("MAWMiActOnMiThreadReadyForChatId").onMiThreadReadyForChatId(a,c.threadId,"MAWBridgeDeleteMessagesHandler",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){for(var e of c.messages)yield a.table("messages")["delete"](d("ReQL").key(b,d("MAWTimeUtils").toTimestamp(e.ts),e.msgId))});return function(b,c){return a.apply(this,arguments)}}())}g.call=a}),98);
__d("MAWBridgeDeleteReactionHandler",["I64","MAWMiActOnMiThreadReadyForChatId"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return d("MAWMiActOnMiThreadReadyForChatId").onMiThreadReadyForChatId(a,b.threadId,"MAWBridgeDeleteReactionHandler",function(a,c){return a.table("reactions")["delete"]({hd:c,tl:{hd:b.messageId,tl:{hd:d("I64").of_string(b.actorId),tl:0}}})})}g.call=a}),98);
__d("MAWBridgeGroupInfoUpdatedHandler",["MAWMiActOnMiThreadReadyForChatId","ReQL","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function a(a,c){return d("MAWMiActOnMiThreadReadyForChatId").onMiThreadReadyForChatId(a,c.threadId,"MAWBridgeGroupInfoUpdatedHandler",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var e;e=(e=c.threadName)!=null?e:void 0;a=a.table("threads");b=(yield d("ReQL").firstAsync(d("ReQL").fromTableAscending(a).getKeyRange(b)));if(b==null)return;return a.put(babelHelpers["extends"]({},b,{threadName:e}))});return function(b,c){return a.apply(this,arguments)}}())}g.call=a}),98);
__d("MAWBridgeGroupInviteLoadedHandler",["fbt","I64","LSMessagingThreadTypeUtil","MAWMiActOnMiThreadReadyForChatId","ReQL","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g,h){"use strict";function a(a,c){return d("MAWMiActOnMiThreadReadyForChatId").onMiThreadReadyForChatId(a,c.threadId,"MAWBridgeGroupInviteLoadedHandler",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var e=a.table("threads"),f=(yield d("ReQL").firstAsync(d("ReQL").fromTableAscending(e).getKeyRange(b)));if(f==null)return;var g=d("LSMessagingThreadTypeUtil").isGroup(f.threadType);if(!g)return;var i=(yield d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.table("group_invites")).getKeyRange(b)));if(i==null)return;g=(yield d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.table("contacts")).filter(function(a){return!d("I64").equal(d("I64").of_string(c.actorId),i.inviterId)&&d("I64").equal(a.id,i.inviterId)})));if(g==null)return;b=h._("__JHASH__UJFQkCMRFkv__JHASH__",[h._param("Inviter Name",g.name)]).toString();a=f.folderName==="inbox"?h._("__JHASH__4F6x7gUU1-S__JHASH__").toString():f.additionalThreadContext;return e.put(babelHelpers["extends"]({},f,{additionalThreadContext:a,snippet:b}))});return function(b,c){return a.apply(this,arguments)}}())}g.call=a}),98);
__d("MAWBridgeGroupInviteUpdateHandler",["I64","MAWMiActOnMiThreadReadyForChatId","MAWUpdateLSThreadCapabilities","Promise"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,c){return d("MAWMiActOnMiThreadReadyForChatId").onMiThreadReadyForChatId(a,c.threadId,"MAWBridgeGroupInviteUpdateHandler",function(a,e){var f=d("I64").of_string(c.inviterId);return(h||(h=b("Promise"))).all([d("MAWUpdateLSThreadCapabilities").setGroupInviteTxn(a,e,f)]).then(function(){})})}g.call=a}),98);
__d("MAWBridgeMediaExpiredHandler",["MAWMiActOnMiThreadReadyForChatId"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return d("MAWMiActOnMiThreadReadyForChatId").onMiThreadReadyForChatId(a,b.threadId,"MAWBridgeMediaExpiredHandler.bs",function(a,c){return a.table("attachments")["delete"]({hd:c,tl:{hd:b.msgId,tl:{hd:String(b.mediaId),tl:0}}})})}g.call=a}),98);
__d("MAWBridgeMsgRangeLoadedHandler",["I64","LSFactory","LSInsertNewMessageRange","MAWMiActOnMiThreadReadyForChatId","MAWTimeUtils","Promise","WALogger","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["No messages found for thread "," with message id ",""]);i=function(){return a};return a}function a(a,e){if(e.rangeExtensionType==null){d("WALogger").ERROR(i(),e.threadId,e.offsetMsgId);return(h||(h=b("Promise"))).resolve()}return d("MAWMiActOnMiThreadReadyForChatId").onMiThreadReadyForChatId(a,e.threadId,"MAWBridgeMsgRangeLoadedHandler",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var f,g,h,i,j,k;f=((f=e.rangeExtensionType)==null?void 0:f.minMsgTs)!=null?d("I64").of_float(e.rangeExtensionType.minMsgTs):d("MAWTimeUtils").MIN_TIMESTAMP_MS;g=((g=e.rangeExtensionType)==null?void 0:g.maxMsgTs)!=null?d("I64").of_float(e.rangeExtensionType.maxMsgTs):d("MAWTimeUtils").MAX_TIMESTAMP_MS;h=(h=(h=e.rangeExtensionType)==null?void 0:h.minMsgId)!=null?h:"";i=(i=(i=e.rangeExtensionType)==null?void 0:i.maxMsgId)!=null?i:"";j=(j=(j=e.rangeExtensionType)==null?void 0:j.hasMoreBefore)!=null?j:!1;k=(k=(k=e.rangeExtensionType)==null?void 0:k.hasMoreAfter)!=null?k:!1;var l=e.offsetMsgId;yield c("LSInsertNewMessageRange")(b,f,g,h,i,f,g,j,k,l,c("LSFactory")(a))});return function(b,c){return a.apply(this,arguments)}}())}g.call=a}),98);
__d("MAWBridgeMsgUpdatedHandler",["I64","LSIntEnum","MAWAckLevel","MAWAdminMsgCTA","MAWMiActOnMiThreadReadyForChatId","MAWMsgReplySnippet","MAWUpdateMsg","MWChatInteraction.bs","MWLSLogSend.bs","QPLUserFlow","ReQL","asyncToGeneratorRuntime","qpl"],(function(a,b,c,d,e,f,g){"use strict";function h(a,b){var e=d("MWChatInteraction.bs").get(d("MWChatInteraction.bs").s2sKey(a));a=d("MWLSLogSend.bs").getS2sKeyFromOfflineMessageId(a);if(e!=null){var f=d("MAWAckLevel").levelToMessagingSendStatusV2(b.ack);d("I64").equal(f,d("LSIntEnum").ofNumber(2))?d("MWChatInteraction.bs").addMarkerPoint(e,"received_successful_server_ack"):d("I64").equal(f,d("LSIntEnum").ofNumber(4))&&d("MWChatInteraction.bs").addMarkerPoint(e,"received_failure_server_ack")}if(a!=null){f=d("MAWAckLevel").levelToMessagingSendStatusV2(b.ack);d("I64").equal(f,d("LSIntEnum").ofNumber(2))?c("QPLUserFlow").endSuccess(c("qpl")._(25313175,"1551"),{instanceKey:a}):d("I64").equal(f,d("LSIntEnum").ofNumber(4))&&c("QPLUserFlow").endFailure(c("qpl")._(25313175,"1551"),"error_from_server",{instanceKey:a})}}function a(a,c,e){return d("MAWMiActOnMiThreadReadyForChatId").onMiThreadReadyForChatId(c,e.chatId,"MAWBridgeMsgUpdatedHandler",function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b,c){var f=(yield d("ReQL").firstAsync(d("ReQL").fromTableAscending(b.table("messages")).getKeyRange(c).filter(function(a){return a.messageId===e.msgId})));if(f==null)return;var g=(yield d("ReQL").firstAsync(d("ReQL").fromTableAscending(b.table("attachments")).getKeyRange(c,e.msgId)));g=[f.offlineThreadingId,g==null?void 0:g.offlineAttachmentId];g.forEach(function(a){a!=null&&h(a,e)});g=(yield d("MAWAdminMsgCTA").getAdminMsgCtaStep(b,c,e));c=(yield d("MAWMsgReplySnippet").getReplySnippet(a,b,e,c));return d("MAWUpdateMsg").call(a,b,e,f,g,c)});return function(a,b){return c.apply(this,arguments)}}())}g.call=a}),98);
__d("MAWBridgeMsgsLoadedHandler",["I64","LSClearMessagePlaceholderRange","LSFactory","LSInsertNewMessageRange","MAWMiActOnMiThreadReadyForChatId","MAWTimeUtils","gkx"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return d("MAWMiActOnMiThreadReadyForChatId").onMiThreadReadyForChatId(a,b.threadId,"MAWBridgeMsgsLoadedHandler",function(a,e){return c("LSClearMessagePlaceholderRange")(e,"",d("MAWTimeUtils").MAX_TIMESTAMP_MS,c("LSFactory")(a)).then(function(){if(c("gkx")("6884")){var f,g,h,i,j,k,l,m;f=(f=(f=b.rangeExtensionType)==null?void 0:f.hasMoreBefore)!=null?f:!1;g=(g=(g=b.rangeExtensionType)==null?void 0:g.hasMoreAfter)!=null?g:!1;h=f&&((h=b.rangeExtensionType)==null?void 0:h.minMsgTs)!=null?d("I64").of_float(b.rangeExtensionType.minMsgTs):d("MAWTimeUtils").MIN_TIMESTAMP_MS;i=g&&((i=b.rangeExtensionType)==null?void 0:i.maxMsgTs)!=null?d("I64").of_float(b.rangeExtensionType.maxMsgTs):d("MAWTimeUtils").MAX_TIMESTAMP_MS;j=(j=(j=b.rangeExtensionType)==null?void 0:j.minMsgId)!=null?j:"";k=(k=(k=b.rangeExtensionType)==null?void 0:k.maxMsgId)!=null?k:"";l=((l=b.rangeExtensionType)==null?void 0:l.rangeKind)==="before"?h:d("MAWTimeUtils").MIN_TIMESTAMP_MS;m=((m=b.rangeExtensionType)==null?void 0:m.rangeKind)==="after"?i:d("MAWTimeUtils").MAX_TIMESTAMP_MS;return c("LSInsertNewMessageRange")(e,h,i,j,k,l,m,f,g,void 0,c("LSFactory")(a))}else{i=((h=b.rangeExtensionType)==null?void 0:h.minMsgTs)!=null?d("I64").of_float(b.rangeExtensionType.minMsgTs):d("MAWTimeUtils").MIN_TIMESTAMP_MS;k=((j=b.rangeExtensionType)==null?void 0:j.maxMsgTs)!=null?d("I64").of_float(b.rangeExtensionType.maxMsgTs):d("MAWTimeUtils").MAX_TIMESTAMP_MS;f=(m=(l=b.rangeExtensionType)==null?void 0:l.minMsgId)!=null?m:"";j=(h=(g=b.rangeExtensionType)==null?void 0:g.maxMsgId)!=null?h:"";m=((l=b.rangeExtensionType)==null?void 0:l.rangeKind)==="extensionBefore"?i:d("MAWTimeUtils").MIN_TIMESTAMP_MS;h=((g=b.rangeExtensionType)==null?void 0:g.rangeKind)==="extensionAfter"?k:d("MAWTimeUtils").MAX_TIMESTAMP_MS;l=(g=(l=b.rangeExtensionType)==null?void 0:l.hasMoreBefore)!=null?g:!1;g=(g=(g=b.rangeExtensionType)==null?void 0:g.hasMoreAfter)!=null?g:!1;return c("LSInsertNewMessageRange")(e,i,k,f,j,m,h,l,g,void 0,c("LSFactory")(a))}})})}g.call=a}),98);
__d("MAWEphemeralMessageExpirationStorage",["LSDatabaseSingleton","MAWBridgeDeleteMessagesHandler","Promise","asyncToGeneratorRuntime","clearTimeout","promiseDone","setTimeout"],(function(a,b,c,d,e,f,g){"use strict";var h,i=new Map();function j(a,b,c){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c,e){yield (h||(h=b("Promise"))).all(c.map(function(b){var c=b.ts,e=b.chatId,f=b.msgId;f={msgId:f,threadId:e,ts:c};e=b.chatId;c=[f];b={messages:c,threadId:e};return d("MAWBridgeDeleteMessagesHandler").call(a,b)})),i["delete"](e)});return k.apply(this,arguments)}function l(a,d,e){return c("setTimeout")(b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var e=(yield c("LSDatabaseSingleton"));c("promiseDone")(e.runInTransaction(function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){yield j(b,a,d)});return function(a){return c.apply(this,arguments)}}(),"readwrite"))}),e)}function a(a,b,d,e){a=i.get(d);var f;if(a==null)f=[b];else{c("clearTimeout")(a.timeoutId);var g=a.msgs.map(function(a){return a.msgId}).indexOf(b.msgId)===-1;g&&a.msgs.push(b);f=a.msgs}g=l(f,d,e);i.set(d,{expirationTs:d,msgs:f,timeoutId:g})}function e(a){var b=a.msgId;a=i.get(a.countdownTs);if(a==null)return;b=a.msgs.map(function(a){return a.msgId}).indexOf(b);if(b>-1){a.msgs.splice(b,1);return}}g.setMessageForExpiration=a;g.clearMessageFromExpiration=e}),98);
__d("MAWBridgeMsgsStartCountdownHandler",["I64","MAWEphemeralMessageExpirationStorage","MAWMiActOnMiThreadReadyForChatId","MAWTimeUtils","Promise","ReQL"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,c){return c.msgs.reduce(function(c,e){return c.then(function(){d("MAWEphemeralMessageExpirationStorage").setMessageForExpiration(a,e,e.countdownTs,e.millisecondsUntilCountdownTs);d("I64").of_int32(e.millisecondsUntilCountdownTs);return d("MAWMiActOnMiThreadReadyForChatId").onMiThreadReadyForChatId(a,e.chatId,"MAWBridgeMsgsStartCountdownHandler",function(a,c){return d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.table("messages")).getKeyRange(c,d("MAWTimeUtils").toTimestamp(e.ts),e.msgId)).then(function(c){if(c==null)return(h||(h=b("Promise"))).resolve();c=babelHelpers["extends"]({},c,{ephemeralExpirationTs:d("I64").of_float(e.countdownTs)});return a.table("messages").put(c)})})})},(h||(h=b("Promise"))).resolve())}g.call=a}),98);
__d("MAWBridgeNewMediaHandler",["I64","MAWMedia","MAWMiActOnMiThreadReadyForChatId","Promise","ReQL","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(a,b,c,e,f,g){return{attachmentFbid:e,attachmentIndex:(e=a==null?void 0:a.attachmentIndex)!=null?e:d("I64").zero,attachmentType:(e=a==null?void 0:a.attachmentType)!=null?e:d("MAWMedia").mediaTypeToMessageAttachmentType(b.mediaType,b.ephemeralMediaViewMode),authorityLevel:(e=a==null?void 0:a.authorityLevel)!=null?e:d("I64").zero,ephemeralMediaState:b.ephemeralMediaState!=null?d("I64").of_int32(b.ephemeralMediaState):a==null?void 0:a.ephemeralMediaState,ephemeralMediaViewMode:b.ephemeralMediaViewMode!=null?d("I64").of_int32(b.ephemeralMediaViewMode):a==null?void 0:a.ephemeralMediaViewMode,filename:(e=(e=b.filenames!=null?b.filenames[c]:null)!=null?e:b.defaultFilename)!=null?e:a==null?void 0:a.filename,filesize:b.filesize==null?a==null?void 0:a.filesize:d("I64").of_int32(b.filesize),hasMedia:b.hasMedia,hasXma:!1,isSharable:!1,messageId:c,offlineAttachmentId:f,playableDurationMs:b.duration==null?a==null?void 0:a.playableDurationMs:d("I64").of_int32(b.duration),previewHeight:b.previewHeight==null?a==null?void 0:a.previewHeight:d("I64").of_int32(b.previewHeight),previewHeightLarge:b.previewHeightLarge==null?a==null?void 0:a.previewHeightLarge:d("I64").of_int32(b.previewHeightLarge),previewWidth:b.previewWidth==null?a==null?void 0:a.previewWidth:d("I64").of_int32(b.previewWidth),previewWidthLarge:b.previewWidthLarge==null?a==null?void 0:a.previewWidthLarge:d("I64").of_int32(b.previewWidthLarge),threadKey:g,timestampMs:d("I64").of_int32(b.ts)}}function j(a,c){var e=c.mediaId,f=c.msgIds,g=c.offlineAttachmentId,j=c.threadId;return d("MAWMiActOnMiThreadReadyForChatId").onMiThreadReadyForChatId(a,j,"MAWBridgeNewMediaHandler",function(a,j){var k,l=e.toString(),m=(k=g)!=null?k:l;return(h||(h=b("Promise"))).all(f.map(function(){var e=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){var e=a.table("attachments"),f=(yield d("ReQL").firstAsync(d("ReQL").fromTableAscending(e).getKeyRange(j,b)));b=i(f,c,b,l,m,j);return f!=null?e.put(babelHelpers["extends"]({},f,b)):e.add(b)});return function(a){return e.apply(this,arguments)}}())).then(function(){})})}function a(a,b){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){yield j(a,b)});return k.apply(this,arguments)}g.call=a}),98);
__d("MAWBridgeNewMediaRangeHandler",["I64","LSFactory","LSIntEnum","LSThreadMediaGalleryGroup","LSUpsertAttachmentRange","MAWMiActOnMiThreadReadyForChatId"],(function(a,b,c,d,e,f,g){"use strict";function h(a,b){return d("MAWMiActOnMiThreadReadyForChatId").onMiThreadReadyForChatId(a,b.threadId,"MAWBridgeNewMediaRangeHandler",function(a,e){var f=d("I64").of_int32(b.minMsgRowId),g=b.hasMoreBefore;return c("LSUpsertAttachmentRange")(e,d("LSIntEnum").ofNumber(c("LSThreadMediaGalleryGroup").PHOTOS_AND_VIDEOS),f,g,c("LSFactory")(a))})}function a(a,b){return h(a,b).then(function(){})}g.call=a}),98);
__d("MAWBridgeNewMsgHandler",["I64","LSAuthorityLevel","LSIntEnum","LSMessageUnsendabilityStatus","LSQuickReplyType","MAWAckLevel","MAWAdminMsgCTA","MAWBridgeBuildMsg","MAWBridgeMsg","MAWMiActOnMiThreadReadyForChatId","MAWMsg","MAWMsgReply","MAWMsgReplySnippet","MAWMsgReplyStatus","MAWTimeUtils","MAWUpdateMsg","Promise","ReQL","asyncToGeneratorRuntime","gkx"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(a,b,c,d,e,f){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e,f,g,h){var i;i=d("MAWTimeUtils").toTimestamp(f.type_===d("MAWMsg").unsent?(i=f.originalTs)!=null?i:f.ts:f.ts);a=(yield d("MAWBridgeBuildMsg").buildMessage(a,b,f,i));return b.table("messages").add(babelHelpers["extends"]({},a,{adminMsgCtaId:g==null?void 0:g.ctaId,adminMsgCtaTitle:g==null?void 0:g.title,adminMsgCtaType:g==null?void 0:g.ctaType,authorityLevel:d("LSIntEnum").ofNumber(c("LSAuthorityLevel").AUTHORITATIVE),cannotUnsendReason:f.type_===d("MAWMsg").unsent||!f.isAuthorMe?d("LSIntEnum").ofNumber(c("LSMessageUnsendabilityStatus").DENY_FOR_NON_SENDER):void 0,displayedContentTypes:d("MAWMsg").getDisplayedContentTypes(f.type_,f.isForwarded,f.isExpiredXmaMsg),editCount:d("I64").of_int32(0),ephemeralDurationInSec:d("MAWBridgeBuildMsg").getEphemeralDurationInSec(f),ephemeralExpirationTs:void 0,forwardScore:d("I64").of_float(f.forwardingScore),hasQuickReplies:!1,hotEmojiSize:d("MAWBridgeMsg").getSpecialTextSize(f),isAdminMessage:f.isAdminMessage,isCollapsed:!1,isForwarded:f.isForwarded,isUnsent:f.type_===d("MAWMsg").unsent,localDataId:void 0,messageId:f.msgId,msUntilExpirationTs:void 0,offlineThreadingId:f.externalId!=null?f.externalId:f.msgId,primarySortKey:d("I64").of_float(f.sortOrderMs),quickReplyType:d("LSIntEnum").ofNumber(c("LSQuickReplyType").NONE),replyAttachmentExtra:void 0,replyAttachmentId:d("MAWMsgReply").getReplyAttachmentId(f),replyAttachmentType:d("MAWMsgReply").getReplyAttachmentType(f),replyCtaId:void 0,replyCtaTitle:void 0,replyMediaExpirationTimestampMs:d("MAWMsgReply").getReplyMediaExpirationTimestampMs(f),replyMediaPreviewHeight:d("MAWMsgReply").getReplyMediaHeight(f),replyMediaPreviewWidth:d("MAWMsgReply").getReplyMediaWidth(f),replyMediaUrl:void 0,replyMediaUrlFallback:void 0,replyMediaUrlMimeType:d("MAWMsgReply").getReplyMediaMimeType(f),replySnippet:h,replySourceId:d("MAWMsgReply").getReplySourceId(f),replySourceTimestampMs:d("MAWMsgReply").getReplySourceTimestampMs(f),replySourceType:d("MAWMsgReply").getReplySourceType(f),replySourceTypeV2:d("MAWMsgReply").getReplySourceTypeV2(f),replyStatus:d("MAWMsgReplyStatus").getLSReplyMessageStatus(f),replyToUserId:d("MAWMsgReply").getReplyUserId(f),replyType:void 0,secondarySortKey:void 0,senderId:d("I64").of_string(f.sender),sendStatus:d("MAWAckLevel").levelToMessagingSendStatus(f.ack),sendStatusV2:d("MAWAckLevel").levelToMessagingSendStatusV2(f.ack),stickerId:void 0,subscriptErrorMessage:void 0,takedownState:void 0,textHasLinks:!1,threadKey:e,timestampMs:i,unsentTimestampMs:d("MAWTimeUtils").toTimestamp(f.ts),viewedPluginContext:void 0,viewedPluginKey:void 0,viewFlags:d("LSIntEnum").ofNumber(0)}))});return j.apply(this,arguments)}function k(a,e,f){return d("MAWMiActOnMiThreadReadyForChatId").onMiThreadReadyForChatId(e,f.chatId,"BridgeNewMsgHandler",function(){var e=b("asyncToGeneratorRuntime").asyncToGenerator(function*(e,g){var j=(yield d("MAWAdminMsgCTA").getAdminMsgCtaStep(e,g,f)),k=(yield d("MAWMsgReplySnippet").getReplySnippet(a,e,f,g)),l=f.offlineMsg;if(l==null)return i(a,e,g,f,j,k);l=(yield d("ReQL").firstAsync(d("ReQL").fromTableAscending(e.table("messages")).getKeyRange(g,d("I64").of_float(l.ts),l.msgId)));if(l==null){var m=!1;if(c("gkx")("8015")&&f.externalId!=null){var n=f.externalId;l=(yield d("ReQL").firstAsync(d("ReQL").fromTableAscending(e.table("messages").index("optimistic")).getKeyRange(n)));if(l!=null&&d("I64").to_int32(l.authorityLevel)===c("LSAuthorityLevel").OPTIMISTIC){m=!0;return d("MAWUpdateMsg").call(a,e,f,l,j,k)}}if(!m)return i(a,e,g,f,j,k)}else return d("MAWUpdateMsg").call(a,e,f,l,j,k);return(h||(h=b("Promise"))).resolve()});return function(a,b){return e.apply(this,arguments)}}())}function a(a,b,c){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c,d){yield (h||(h=b("Promise"))).all(d.map(function(b){return k(a,c,b)}))});return l.apply(this,arguments)}g.call=k;g.bulkCall=a}),98);
__d("MAWThreadDefaults",["fbt","I64","LSBitOffset","LSIntEnum","MAWGating","gkx","qex"],(function(a,b,c,d,e,f,g,h){"use strict";function a(a){if(d("MAWGating").isRepliesEnabled())return d("LSBitOffset").set(d("LSIntEnum").ofNumber(42),a);else return a}function b(a){if(c("gkx")("7045"))return d("LSBitOffset").set(d("LSIntEnum").ofNumber(4),a);else return a}function e(a){return c("qex")._("227")?d("LSBitOffset").set(d("LSIntEnum").ofNumber(7),a):a}function f(a){return c("qex")._("229")?d("LSBitOffset").set(d("LSIntEnum").ofNumber(6),a):a}function i(a){return c("qex")._("231")?d("LSBitOffset").set(d("LSIntEnum").ofNumber(9),a):a}var j=d("LSBitOffset").set(d("LSIntEnum").ofNumber(25),d("LSBitOffset").set(d("LSIntEnum").ofNumber(24),d("LSBitOffset").set(d("LSIntEnum").ofNumber(18),d("LSBitOffset").set(d("LSIntEnum").ofNumber(56),d("LSBitOffset").set(d("LSIntEnum").ofNumber(17),d("LSBitOffset").set(d("LSIntEnum").ofNumber(14),d("LSBitOffset").set(d("LSIntEnum").ofNumber(23),d("LSBitOffset").set(d("LSIntEnum").ofNumber(8),d("LSBitOffset").set(d("LSIntEnum").ofNumber(15),d("LSBitOffset").set(d("LSIntEnum").ofNumber(2),d("LSBitOffset").empty))))))))));a=a(b(e(f(i(d("LSBitOffset").set(d("LSIntEnum").ofNumber(10),d("LSBitOffset").set(d("LSIntEnum").ofNumber(19),d("LSBitOffset").set(d("LSIntEnum").ofNumber(35),d("LSBitOffset").set(d("LSIntEnum").ofNumber(43),j)))))))));b=d("LSBitOffset").set(d("LSIntEnum").ofNumber(17),d("LSBitOffset").set(d("LSIntEnum").ofNumber(60),d("LSBitOffset").set(d("LSIntEnum").ofNumber(16),d("LSBitOffset").set(d("LSIntEnum").ofNumber(26),d("LSBitOffset").set(d("LSIntEnum").ofNumber(28),d("LSBitOffset").clear(d("LSIntEnum").ofNumber(27),a))))));e=d("LSBitOffset").set(d("I64").sub(d("LSIntEnum").ofNumber(103),d("I64").of_string("64")),d("LSBitOffset").set(d("I64").sub(d("LSIntEnum").ofNumber(85),d("I64").of_string("64")),d("LSBitOffset").set(d("I64").sub(d("LSIntEnum").ofNumber(109),d("I64").of_string("64")),d("LSBitOffset").set(d("I64").sub(d("LSIntEnum").ofNumber(74),d("I64").of_string("64")),d("LSBitOffset").set(d("I64").sub(d("LSIntEnum").ofNumber(65),d("I64").of_string("64")),d("LSBitOffset").set(d("I64").sub(d("LSIntEnum").ofNumber(64),d("I64").of_string("64")),d("LSBitOffset").empty))))));f=h._("__JHASH__9ZFn8zMzjpf__JHASH__").toString();g.defaultThreadCapabilities=a;g.defaultGroupThreadCapabilities=b;g.defaultThreadCapabilities_2=e;g.nullstateDescriptionText1=f;g.defaultThreadCapabilities_3=d("LSBitOffset").empty;g.defaultThreadCapabilities_4=d("LSBitOffset").empty}),98);
__d("MAWBridgeOccamadilloVerifyThreadExistsHandler",["FBLogger","I64","LSAuthorityLevel","LSCoreClientFolderType","LSCreateE2EEMetadataThread","LSCreateOfflineThreadingID","LSFactory","LSIntEnum","LSThreadBitOffset","MAWFolderUtils","MAWJidUtils","MAWMiActGetThreadLifecycleState","MAWMiActOnActThreadReadyQueue","MAWMiActOnMiThreadReadyQueue","MAWMiActThreadLifecycleState","MAWThreadDefaults","MAWTimeUtils","Promise","WALoggerDeferred","WATimeUtils","asyncToGeneratorRuntime","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[Occamadillo] 3. Thread loading is fully complete for threadKey: ",", JID: ",", and state: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[Occamadillo] 2. Handle new authoritative thread for threadKey: ",", JID: ",", and state: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[Occamadillo] 1. Let MI server know about WA thread for JID: "," and state: ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["[Occamadillo] 5. Authoritative thread not found for chatId: ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["[Occamadillo] Thread is missing in Occamadillo verify thread exists"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["[Occamadillo] Creating e2ee metadata optimistic thread.\n  threadKey: ","\n  bumpTimestampMs: ",""]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["[Occamadillo] Detected 0 for last activity timestamp from MI for thread: ",", using local state timestamp: ",""]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["[Occamadillo] no folder type was supplied to Occamadillo verify thread exists handler"]);p=function(){return a};return a}function q(a){return d("I64").of_string(d("MAWJidUtils").threadIdForChatJid(a))}function r(a){a=d("MAWFolderUtils").systemFolderToLSCoreClientFolder(a);a==null&&(c("promiseDone")(d("WALoggerDeferred").WARN(p())),a=d("I64").of_int32(c("LSCoreClientFolderType").INBOX));return a}function s(a,e){return e==null?c("LSCreateOfflineThreadingID")(d("I64").of_float(Date.now()),a).then(function(a){return a[0]}):(h||(h=b("Promise"))).resolve(d("I64").of_string(e))}function t(a){a=d("MAWTimeUtils").millisTimeToTimestamp(a);return d("I64").equal(a,d("I64").of_int32(0))?d("MAWTimeUtils").millisTimeToTimestamp(d("WATimeUtils").millisTime()):a}function u(a,b){return v.apply(this,arguments)}function v(){v=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var e=c("LSFactory")(a),f=t(b.lastActivityTs),g=(yield s(e,b.clientThreadKey)),h=d("I64").of_int32(b.chatId),i=r(b.folder),j=q(b.jid);b=b.isGroup?d("LSIntEnum").ofNumber(16):d("LSIntEnum").ofNumber(15);yield a.table("mi_act_mapping_table").put({clientThreadPk:h,jid:j,serverThreadKey:g});c("promiseDone")(d("WALoggerDeferred").LOG(n(),d("I64").to_string(g),d("I64").to_string(f)));return c("LSCreateE2EEMetadataThread")(j,g,b,i,f,e)});return v.apply(this,arguments)}function w(a,b,e){a=a;d("I64").equal(a,d("I64").of_int32(0))&&(c("promiseDone")(d("WALoggerDeferred").WARN(o(),d("I64").to_string(e),d("I64").to_string(b))),a=b);return a}function x(a,b){var c=[],e=105;a=d("LSThreadBitOffset").has(e,a);a&&c.push(e);return d("LSThreadBitOffset").set(c,b?d("MAWThreadDefaults").defaultGroupThreadCapabilities:d("MAWThreadDefaults").defaultThreadCapabilities,d("MAWThreadDefaults").defaultThreadCapabilities_2,d("MAWThreadDefaults").defaultThreadCapabilities_3,d("MAWThreadDefaults").defaultThreadCapabilities_4)}function y(a,b,c){return z.apply(this,arguments)}function z(){z=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f){var g=(yield a.table("threads").get({hd:e,tl:0}));if(g==null){c("promiseDone")(d("WALoggerDeferred").ERROR(m()));return(h||(h=b("Promise"))).resolve()}var i=f.clientThreadKey!=null?d("I64").of_string(f.clientThreadKey):g.clientThreadKey,j=w(g.lastActivityTimestampMs,d("MAWTimeUtils").millisTimeToTimestamp(f.lastActivityTs),e),k=d("MAWTimeUtils").millisTimeToTimestamp(f.lastReadTs);f=x(g,f.isGroup);return a.table("threads").upsert({hd:e,tl:0},babelHelpers["extends"]({},g,{capabilities:f[0],capabilities2:f[1],capabilities3:f[2],capabilities4:f[3],clientThreadKey:i,lastActivityTimestampMs:j,lastReadWatermarkTimestampMs:k}))});return z.apply(this,arguments)}function A(a,b,c){return B.apply(this,arguments)}function B(){B=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c,e){yield a.table("mi_act_mapping_table").put({clientThreadPk:d("I64").of_int32(e.chatId),jid:q(e.jid),serverThreadKey:c}),yield (h||(h=b("Promise"))).all([y(a,c,e),C(a,c,e)])});return B.apply(this,arguments)}function C(a,b,c){return D.apply(this,arguments)}function D(){D=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){if(c.clientThreadKey!=null){c=d("I64").of_string(c.clientThreadKey);d("I64").equal(b,c)||(yield a.table("threads")["delete"]({hd:c,tl:0}))}});return D.apply(this,arguments)}function E(a,b,c){return F.apply(this,arguments)}function F(){F=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f){var g=(yield a.table("threads").get({hd:e,tl:0}));g!=null&&d("I64").to_int32(g.authorityLevel)===c("LSAuthorityLevel").AUTHORITATIVE&&(yield (h||(h=b("Promise"))).all([y(a,e,f),C(a,e,f)]));g==null&&c("promiseDone")(d("WALoggerDeferred").LOG(l(),f.chatId))});return F.apply(this,arguments)}function G(a,b){return H.apply(this,arguments)}function H(){H=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var e=d("I64").of_string(d("MAWJidUtils").threadIdForChatJid(b.jid));e=(yield d("MAWMiActGetThreadLifecycleState").getThreadLifecycleStateByJid(a,e,"MAWBridgeOccamadilloVerifyThreadExistsHandler"));switch(e.type){case d("MAWMiActThreadLifecycleState").MiActThreadStatesEnum.JID_MISSING_MAPPING_ROW:case d("MAWMiActThreadLifecycleState").MiActThreadStatesEnum.JID_MISSING_MI_THREAD:case d("MAWMiActThreadLifecycleState").MiActThreadStatesEnum.OPTIMISTIC_THREAD_WITH_ACT:case d("MAWMiActThreadLifecycleState").MiActThreadStatesEnum.ACT_THREAD_ONLY:case d("MAWMiActThreadLifecycleState").MiActThreadStatesEnum.ACT_THREAD_ONLY_BY_JID:case d("MAWMiActThreadLifecycleState").MiActThreadStatesEnum.ACT_THREAD_ONLY_BY_CHAT_ID:case d("MAWMiActThreadLifecycleState").MiActThreadStatesEnum.CLIENT_PARTIAL_MI_THREAD:case d("MAWMiActThreadLifecycleState").MiActThreadStatesEnum.SERVER_PARTIAL_MI_THREAD:c("promiseDone")(d("WALoggerDeferred").LOG(k(),b.jid,e.type));return u(a,b);case d("MAWMiActThreadLifecycleState").MiActThreadStatesEnum.AUTHORITATIVE_THREAD_ONLY:case d("MAWMiActThreadLifecycleState").MiActThreadStatesEnum.AUTHORITATIVE_THREAD_MISSING_MAPPING_ROW:var f=d("I64").to_string(e.serverThreadKey);c("promiseDone")(d("WALoggerDeferred").LOG(j(),f,b.jid,e.type));return A(a,e.serverThreadKey,b);case d("MAWMiActThreadLifecycleState").MiActThreadStatesEnum.MI_AND_ACT_THREAD_COMPLETE:f=d("I64").to_string(e.serverThreadKey);c("promiseDone")(d("WALoggerDeferred").LOG(i(),f,b.jid,e.type));return E(a,e.serverThreadKey,b);case d("MAWMiActThreadLifecycleState").MiActThreadStatesEnum.THREAD_KEY_ONLY:case d("MAWMiActThreadLifecycleState").MiActThreadStatesEnum.OPTIMISTIC_THREAD_NO_ACT:throw c("FBLogger")("messenger_e2ee_web").mustfixThrow("[Occamadillo] Unimplemented VerifyThreadExists state: %s for JID: %s",e.type,b.jid);default:e.type;throw c("FBLogger")("messenger_e2ee_web").mustfixThrow("[Occamadillo] Unhandled VerifyThreadExists state: %s for JID: %s",e.type,b.jid)}});return H.apply(this,arguments)}function a(a,b){return I.apply(this,arguments)}function I(){I=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){yield G(a,b);if(b.clientThreadKey!=null){var e=d("I64").of_string(b==null?void 0:b.clientThreadKey);c("promiseDone")(d("MAWMiActOnActThreadReadyQueue").processQueueOnActThreadReady(e,b.chatId,b.jid))}if(b.authoritativeThreadKey!=null){e=d("I64").of_string(b.authoritativeThreadKey);c("promiseDone")(d("MAWMiActOnActThreadReadyQueue").processQueueOnActThreadReady(e,b.chatId,b.jid))}e=(e=b.authoritativeThreadKey)!=null?e:b.clientThreadKey;if(e!=null)return d("MAWMiActOnMiThreadReadyQueue").processQueueOnMiThreadReady(a,d("I64").of_string(e),b.chatId,b.jid);return});return I.apply(this,arguments)}g.call=a}),98);
__d("MAWBridgeOneToOneMessageRequestLoadedHandler",["fbt","I64","LSAuthorityLevel","LSIntEnum","LSMessagingThreadTypeUtil","LSThreadBitOffset","MAWContactRelationshipType","MAWDbContact","MAWMessageRequestUtil.bs","MAWMiActOnMiThreadReadyForChatId","Promise","ReQL"],(function(a,b,c,d,e,f,g,h){"use strict";var i;function a(a,e){return d("MAWMiActOnMiThreadReadyForChatId").onMiThreadReadyForChatId(a,e.threadId,"MAWBridgeOneToOneMessageRequestLoadedHandler",function(a,f){return d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.table("threads")).getKeyRange(f)).then(function(c){if(c==null)return(i||(i=b("Promise"))).resolve([void 0,void 0,void 0,!1]);var f=d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.table("contacts")).getKeyRange(d("I64").of_string(e.fbid)));return(i||(i=b("Promise"))).all([i.resolve(c),f,i.resolve(e.relationship),i.resolve(d("LSMessagingThreadTypeUtil").isOneToOne(c.threadType))])}).then(function(e){var f=e[0];if(f==null)return(i||(i=b("Promise"))).resolve();var g=e[1];if(g==null)return(i||(i=b("Promise"))).resolve();var j=e[2];if(j==null)return(i||(i=b("Promise"))).resolve();if(!e[3])return(i||(i=b("Promise"))).resolve();e=d("I64").equal(g.authorityLevel,d("LSIntEnum").ofNumber(c("LSAuthorityLevel").AUTHORITATIVE))?d("MAWContactRelationshipType").getContactRelationshipType(g):j;if(f.folderName==="pending"||f.folderName==="other"||f.folderName==="spam"||f.folderName==="inbox"&&e===d("MAWDbContact").REVERSED_ONE_WAY_CONTACT&&!d("I64").equal(f.lastActivityTimestampMs,d("I64").zero)){g=d("LSThreadBitOffset").clear(d("MAWMessageRequestUtil.bs").disabledThreadCapabilitiesForIncomingRequest,f.capabilities,f.capabilities2,f.capabilities3,f.capabilities4);j=f.folderName==="inbox"?h._("__JHASH__4F6x7gUU1-S__JHASH__").toString():void 0;e=[d("LSThreadBitOffset").set(d("MAWMessageRequestUtil.bs").enabledThreadCapabilitiesForIncomingRequest,g[0],g[1],g[2],g[3]),j]}else e=[[f.capabilities,f.capabilities2,f.capabilities3,f.capabilities4],void 0];g=e[0];j=babelHelpers["extends"]({},f,{additionalThreadContext:e[1],capabilities:g[0],capabilities2:g[1],capabilities3:g[2],capabilities4:g[3]});return a.table("threads").put(j).then(function(){})})})}g.call=a}),98);
__d("MAWBridgeParticipantRemovedHandler",["I64","MAWMiActOnMiThreadReadyForChatId"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return d("MAWMiActOnMiThreadReadyForChatId").onMiThreadReadyForChatId(a,b.threadId,"MAWBridgeParticipantRemovedHandler",function(a,c){return a.table("participants")["delete"]({hd:c,tl:{hd:d("I64").of_string(b.userId),tl:0}})})}g.call=a}),98);
__d("MAWBridgeParticipantUpdatedHandler",["fbt","I64","LSAuthorityLevel","LSContactBlockedByViewerStatus","LSContactGender","LSContactIdType","LSContactType","LSContactViewerRelationship","LSContactWorkForeignEntityType","LSFactory","LSGroupParticipantJoinState","LSIntEnum","LSVerifyContactRowExists","MAWCurrentUser","MAWMiActOnMiThreadReadyForChatId","MAWTimeUtils","MAWUpdateLSThreadCapabilities","Promise","ReQLTable"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j=d("MAWCurrentUser").getID(),k=d("I64").of_string(j);function a(a,e){if(e.fbid.startsWith("shadow_"))return(i||(i=b("Promise"))).resolve();else return d("MAWMiActOnMiThreadReadyForChatId").onMiThreadReadyForChatId(a,e.threadId,"MAWBridgeParticipantUpdatedHandler",function(a,f){var g=d("I64").of_string(e.fbid),l=d("MAWTimeUtils").toTimestamp(e.readWatermarkTs),m=d("MAWTimeUtils").toTimestamp(e.deliveredWatermarkTs),n=d("MAWTimeUtils").toTimestamp(e.lastReadActionTs),o=e.isSuperAdmin?h._("__JHASH__I9SRoIOJzWH__JHASH__").toString():void 0,p={contents:!1},q={contents:!1};return d("ReQLTable").update(a.table("participants"),{hd:f,tl:{hd:g,tl:0}},function(a){if(a!=null){q.contents=!0;return{authorityLevel:a.authorityLevel,contactId:g,deliveredWatermarkTimestampMs:m,groupParticipantJoinState:e.isInvited?d("LSIntEnum").ofNumber(c("LSGroupParticipantJoinState").INVITED):d("LSIntEnum").ofNumber(c("LSGroupParticipantJoinState").MEMBER),isAdmin:e.isAdmin,isModerator:!1,isSuperAdmin:a.isSuperAdmin,nickname:a.nickname,normalizedSearchTerms:a.normalizedSearchTerms,participantCapabilities:a.participantCapabilities,readActionTimestampMs:n,readWatermarkTimestampMs:l,subscribeSource:o,threadKey:f}}else{q.contents=!0;p.contents=!0;return{authorityLevel:d("I64").zero,contactId:g,deliveredWatermarkTimestampMs:m,groupParticipantJoinState:e.isInvited?d("LSIntEnum").ofNumber(c("LSGroupParticipantJoinState").INVITED):d("LSIntEnum").ofNumber(c("LSGroupParticipantJoinState").MEMBER),isAdmin:e.isAdmin,isModerator:!1,isSuperAdmin:e.isSuperAdmin,nickname:void 0,normalizedSearchTerms:void 0,participantCapabilities:void 0,readActionTimestampMs:d("I64").zero,readWatermarkTimestampMs:l,subscribeSource:o,threadKey:f}}}).then(function(){if(q.contents)return d("MAWUpdateLSThreadCapabilities").disableBlockerCapabilitiesTxn(a,f).then(function(){var c=d("I64").equal(k,g),h=e.isAdmin;if(c)if(h)return d("MAWUpdateLSThreadCapabilities").enableAddMembersTxn(a,f);else return d("MAWUpdateLSThreadCapabilities").disableAddMembersTxn(a,f);else return(i||(i=b("Promise"))).resolve()});else return(i||(i=b("Promise"))).resolve()}).then(function(){if(p.contents)return c("LSVerifyContactRowExists")(g,d("LSIntEnum").ofNumber(c("LSContactIdType").FBID),void 0,void 0,d("LSIntEnum").ofNumber(c("LSContactType").USER),void 0,void 0,void 0,void 0,!1,!1,d("LSIntEnum").ofNumber(c("LSContactBlockedByViewerStatus").UNBLOCKED),void 0,j===e.fbid,d("LSIntEnum").ofNumber(c("LSAuthorityLevel").OPTIMISTIC),void 0,void 0,d("LSIntEnum").ofNumber(c("LSContactWorkForeignEntityType").UNKNOWN),d("LSIntEnum").ofNumber(c("LSContactGender").UNKNOWN),d("LSIntEnum").ofNumber(c("LSContactViewerRelationship").UNKNOWN),void 0,c("LSFactory")(a));else return(i||(i=b("Promise"))).resolve()})})}g.call=a}),98);
__d("MAWBridgeParticipantsUpdatedHandler",["fbt","I64","LSAuthorityLevel","LSContactBlockedByViewerStatus","LSContactGender","LSContactIdType","LSContactType","LSContactViewerRelationship","LSContactWorkForeignEntityType","LSFactory","LSGroupParticipantJoinState","LSIntEnum","LSVerifyContactRowExists","MAWCurrentUser","MAWMiActOnMiThreadReadyForChatId","MAWTimeUtils","MAWUpdateLSThreadCapabilities","Promise","ReQL","ReQLTable","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j=d("MAWCurrentUser").getID(),k=d("I64").of_string(j);function a(a,b){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e){e=e.participants.filter(function(a){return!a.fbid.startsWith("shadow_")});yield (i||(i=b("Promise"))).all(e.map(function(e){return d("MAWMiActOnMiThreadReadyForChatId").onMiThreadReadyForChatId(a,e.threadId,"MAWBridgeParticipantsUpdatedHandler",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var f=d("I64").of_string(e.fbid),g=d("MAWTimeUtils").toTimestamp(e.readWatermarkTs),i=d("MAWTimeUtils").toTimestamp(e.deliveredWatermarkTs),l=d("MAWTimeUtils").toTimestamp(e.lastReadActionTs),m=e.isSuperAdmin?h._("__JHASH__-gVxfbL98KU__JHASH__").toString():void 0,n=!1,o=!1;yield d("ReQLTable").update(a.table("participants"),d("ReQL").key(b,f),function(a){if(a!=null){o=!0;return{authorityLevel:a.authorityLevel,contactId:f,deliveredWatermarkTimestampMs:d("I64").equal(i,d("I64").zero)?a.deliveredWatermarkTimestampMs:i,groupParticipantJoinState:e.isInvited?d("LSIntEnum").ofNumber(c("LSGroupParticipantJoinState").INVITED):d("LSIntEnum").ofNumber(c("LSGroupParticipantJoinState").MEMBER),isAdmin:e.isAdmin,isModerator:!1,isSuperAdmin:a.isSuperAdmin,nickname:a.nickname,normalizedSearchTerms:a.normalizedSearchTerms,participantCapabilities:a.participantCapabilities,readActionTimestampMs:d("I64").equal(l,d("I64").zero)?a.readActionTimestampMs:l,readWatermarkTimestampMs:d("I64").equal(g,d("I64").zero)?a.readWatermarkTimestampMs:g,subscribeSource:m,threadKey:b}}else{o=!0;n=!0;return{authorityLevel:d("I64").zero,contactId:f,deliveredWatermarkTimestampMs:i,groupParticipantJoinState:e.isInvited?d("LSIntEnum").ofNumber(c("LSGroupParticipantJoinState").INVITED):d("LSIntEnum").ofNumber(c("LSGroupParticipantJoinState").MEMBER),isAdmin:e.isAdmin,isModerator:!1,isSuperAdmin:e.isSuperAdmin,nickname:void 0,normalizedSearchTerms:void 0,participantCapabilities:void 0,readActionTimestampMs:d("I64").zero,readWatermarkTimestampMs:g,subscribeSource:m,threadKey:b}}});o&&(yield d("MAWUpdateLSThreadCapabilities").disableBlockerCapabilitiesTxn(a,b),d("I64").equal(k,f)&&(e.isAdmin?yield d("MAWUpdateLSThreadCapabilities").enableAddMembersTxn(a,b):yield d("MAWUpdateLSThreadCapabilities").disableAddMembersTxn(a,b)));n&&(yield c("LSVerifyContactRowExists")(f,d("LSIntEnum").ofNumber(c("LSContactIdType").FBID),void 0,void 0,d("LSIntEnum").ofNumber(c("LSContactType").USER),void 0,void 0,void 0,void 0,!1,!1,d("LSIntEnum").ofNumber(c("LSContactBlockedByViewerStatus").UNBLOCKED),void 0,j===e.fbid,d("LSIntEnum").ofNumber(c("LSAuthorityLevel").OPTIMISTIC),void 0,void 0,d("LSIntEnum").ofNumber(c("LSContactWorkForeignEntityType").UNKNOWN),d("LSIntEnum").ofNumber(c("LSContactGender").UNKNOWN),d("LSIntEnum").ofNumber(c("LSContactViewerRelationship").UNKNOWN),void 0,c("LSFactory")(a)))});return function(b,c){return a.apply(this,arguments)}}())}))});return l.apply(this,arguments)}g.call=a}),98);
__d("MAWBridgeRavenActionMsgForUIHandler",["I64","MAWMiActOnMiThreadReadyForChatId","MAWMsg","MAWRavenUtils","Promise","ReQL","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,c){return d("MAWMiActOnMiThreadReadyForChatId").onMiThreadReadyForChatId(a,c.threadId,"MAWBridgeRavenActionMsgForUIHandler",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e){a=a.table("attachments");e=(yield d("ReQL").firstAsync(d("ReQL").fromTableAscending(a).getKeyRange(e,c.ravenMsgId)));if(e==null)return(h||(h=b("Promise"))).resolve();if(e.ephemeralMediaState==null)return(h||(h=b("Promise"))).resolve();var f=d("I64").to_int32(e.ephemeralMediaState);if(e.ephemeralMediaViewMode==null)return(h||(h=b("Promise"))).resolve();var g=d("I64").to_int32(e.ephemeralMediaViewMode);f=d("MAWMsg").MAWRavenMsgEphemeralMediaState.cast(f);g=d("MAWMsg").MAWRavenMsgEphemeralType.cast(g);if(f==null||g==null)return(h||(h=b("Promise"))).resolve();f=d("MAWRavenUtils").getNextRavenMessageEphemeralState(f,g);if(f==null)return(h||(h=b("Promise"))).resolve();e.ephemeralMediaState;g=babelHelpers.objectWithoutPropertiesLoose(e,["ephemeralMediaState"]);e=babelHelpers["extends"]({ephemeralMediaState:d("I64").of_int32(f)},g);f={hd:g.threadKey,tl:{hd:g.messageId,tl:{hd:g.attachmentFbid,tl:0}}};return a.upsert(f,e)});return function(b,c){return a.apply(this,arguments)}}())}g.call=a}),98);
__d("MAWBridgeReactionUpsertHandler",["I64","LSAuthorityLevel","LSIntEnum","MAWMiActOnMiThreadReadyForChatId","MAWTimeUtils"],(function(a,b,c,d,e,f,g){"use strict";function h(a,b){return d("MAWMiActOnMiThreadReadyForChatId").onMiThreadReadyForChatId(a,b.threadId,"MAWBridgeReactionUpsertHandler",function(a,e){return a.table("reactions").upsert({hd:e,tl:{hd:b.messageId,tl:{hd:d("I64").of_string(b.actorId),tl:0}}},{actorId:d("I64").of_string(b.actorId),authorityLevel:d("LSIntEnum").ofNumber(c("LSAuthorityLevel").AUTHORITATIVE),messageId:b.messageId,reaction:b.reaction,threadKey:e,timestampMs:d("MAWTimeUtils").toTimestamp(b.ts)})})}function a(a,b,e,f,g,h){return a.table("reactions").upsert({hd:e,tl:{hd:f,tl:{hd:d("I64").of_string(b),tl:0}}},{actorId:d("I64").of_string(b),authorityLevel:d("LSIntEnum").ofNumber(c("LSAuthorityLevel").AUTHORITATIVE),messageId:f,reaction:h,threadKey:e,timestampMs:d("MAWTimeUtils").toTimestamp(g)})}function b(a,b){return h(a,b).then(function(){})}g.attachmentMutationsOptimisticHandler=a;g.call=b}),98);
__d("MAWBridgeReceivedChatStateHandler",["I64","MAWMiActOnMiThreadReadyForChatId","Promise","ServerTime","WAChatState"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,c){return d("MAWMiActOnMiThreadReadyForChatId").onMiThreadReadyForChatId(a,c.threadId,"MAWBridgeReceivedChatStateHandler",function(a,e){var f=d("I64").of_string(c.senderId),g=d("I64").of_float(3e3+d("ServerTime").getMillis());if(c.state===d("WAChatState").TYPING)return a.table("typing_indicator").upsert({hd:e,tl:{hd:f,tl:0}},{expirationTimestampMs:g,senderId:f,threadKey:e}).then(function(){});else if(c.state===d("WAChatState").IDLE)return a.table("typing_indicator")["delete"]({hd:e,tl:{hd:f,tl:0}}).then(function(){});else return(h||(h=b("Promise"))).resolve()})}g.call=a}),98);
__d("MAWBridgeReceivedReceiptHandler",["I64","MAWMiActOnMiThreadReadyForChatId","MAWTimeUtils","Promise","ReQL"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,c){return d("MAWMiActOnMiThreadReadyForChatId").onMiThreadReadyForChatId(a,c.threadId,"MAWBridgeReceivedReceiptHandler",function(a,e){var f=d("I64").of_string(c.fbid),g=d("MAWTimeUtils").toTimestamp(c.lastReadWatermarkTs),i=d("MAWTimeUtils").toTimestamp(c.deliveredWatermarkTs),j=d("MAWTimeUtils").toTimestamp(c.lastReadActionTs);return d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.table("participants")).getKeyRange(e,f)).then(function(c){if(c!=null)return a.table("participants").put({authorityLevel:c.authorityLevel,contactId:c.contactId,deliveredWatermarkTimestampMs:d("I64").equal(i,d("I64").zero)?c.deliveredWatermarkTimestampMs:i,groupParticipantJoinState:c.groupParticipantJoinState,isAdmin:c.isAdmin,isModerator:c.isModerator,isSuperAdmin:c.isSuperAdmin,nickname:c.nickname,normalizedSearchTerms:c.normalizedSearchTerms,participantCapabilities:c.participantCapabilities,readActionTimestampMs:d("I64").equal(j,d("I64").zero)?c.readActionTimestampMs:j,readWatermarkTimestampMs:d("I64").equal(g,d("I64").zero)?c.readWatermarkTimestampMs:g,subscribeSource:c.subscribeSource,threadKey:c.threadKey,threadRoles:d("I64").zero});else return(h||(h=b("Promise"))).resolve()}).then(function(){})})}g.call=a}),98);
__d("MAWBridgeSyncContacts",["CurrentUser","I64","LSAuthorityLevel","LSContactBlockedByViewerStatus","LSContactGender","LSContactIdType","LSContactType","LSContactViewerRelationship","LSContactWorkForeignEntityType","LSFactory","LSIntEnum","LSVerifyContactRowExists","Promise"],(function(a,b,c,d,e,f,g){"use strict";var h,i=c("CurrentUser").getID();function a(a,e){return e.reduce(function(b,e){var f=d("I64").of_string(e);return b.then(function(){return c("LSVerifyContactRowExists")(f,d("LSIntEnum").ofNumber(c("LSContactIdType").FBID),void 0,void 0,d("LSIntEnum").ofNumber(c("LSContactType").USER),void 0,void 0,void 0,void 0,!1,!1,d("LSIntEnum").ofNumber(c("LSContactBlockedByViewerStatus").UNBLOCKED),void 0,i===e,d("LSIntEnum").ofNumber(c("LSAuthorityLevel").OPTIMISTIC),void 0,void 0,d("LSIntEnum").ofNumber(c("LSContactWorkForeignEntityType").UNKNOWN),d("LSIntEnum").ofNumber(c("LSContactGender").UNKNOWN),d("LSIntEnum").ofNumber(c("LSContactViewerRelationship").UNKNOWN),void 0,c("LSFactory")(a))}).then(function(){})},(h||(h=b("Promise"))).resolve())}g.call=a}),98);
__d("MAWBridgeBuildThreadSnippet",["MAWAdminMsg","MAWBridgeBuildMsgMentions","MAWDbChatId","MAWLocalizationType","MAWMiActOnMiThreadReadyForChatId","MAWVault","ReQL","asyncToGeneratorRuntime","first"],(function(a,b,c,d,e,f,g){"use strict";function h(a){return a!=null?d("MAWVault").unvault(a):void 0}function i(a,b,c){if(a==null)return b;b=[].concat(b);switch(c){case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SEND_TEXT:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_TEXT:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SEND_TEXT_IN_GROUP:b[0]=a;break}return b}function a(a,b,c,d){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e,f){var g=e.snippetContactIDs,j=e.snippetMentionJIDs,l=e.snippetParams,m=e.snippetType,n=e.threadId;if(l==null||m==null||g==null)return f;e=(yield d("MAWBridgeBuildMsgMentions").buildThreadSnippetWithMentions(a,b,n,h(c("first")(l)),j,g,m,function(b){var c=b[0];b=b[1];c=d("MAWAdminMsg").buildLocalizedString(i(c,l,m),b,m);return k(a,n,c)}));f=e[0];b=e[1];return d("MAWAdminMsg").buildLocalizedString(i(f,l,m),b,m)});return j.apply(this,arguments)}function k(a,c,e){return a.runInTransaction(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){yield d("MAWMiActOnMiThreadReadyForChatId").onMiThreadReadyForChatId(a,d("MAWDbChatId").unsafeCoerceToChatId(c),"MAWBridgeBuildThreadSnippet",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){a=a.table("threads");b=(yield d("ReQL").firstAsync(d("ReQL").fromTableAscending(a).getKeyRange(b)));b&&(yield a.put(babelHelpers["extends"]({},b,{snippet:e})))});return function(b,c){return a.apply(this,arguments)}}())});return function(b){return a.apply(this,arguments)}}(),"readwrite")}g.buildBridgeThreadSnippet=a}),98);
__d("MAWBridgeThreadBumpedHandler",["I64","MAWBridgeBuildThreadSnippet","MAWBumpThread","MAWMiActOnMiThreadReadyForChatId","MAWTimeUtils","ReQL","asyncToGeneratorRuntime","getMAWLastMessageCtaType"],(function(a,b,c,d,e,f,g){"use strict";function a(a,e,f){return d("MAWMiActOnMiThreadReadyForChatId").onMiThreadReadyForChatId(e,f.threadId,"MAWBridgeThreadBumpedHandler",function(){var e=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b,e){var g=(yield d("ReQL").firstAsync(d("ReQL").fromTableAscending(b.table("threads")).getKeyRange(e)));if(g==null)return;g=(yield d("MAWBridgeBuildThreadSnippet").buildBridgeThreadSnippet(a,b,f,g.snippet));var h=f.snippetSenderContactId!=null?d("I64").of_string(f.snippetSenderContactId):void 0,i=c("getMAWLastMessageCtaType")(f);return d("MAWBumpThread").threadMutation(b,e,d("MAWTimeUtils").millisTimeToTimestamp(f.lastActivityTs),d("MAWTimeUtils").millisTimeToTimestamp(f.lastReadTs),g,h,i)});return function(a,b){return e.apply(this,arguments)}}())}g.call=a}),98);
__d("MAWBridgeThreadBumpedServerHandler",["I64","LSBumpE2EEMetadataThread","LSFactory","MAWMiActOnMiThreadReadyForChatId","MAWTimeUtils","WALoggerDeferred","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[Occamadillo] Bumping thread on server. threadKey: ",", bumpTimestampMs: ",", isLocalDeviceSend: ",""]);h=function(){return a};return a}function a(a,b){return d("MAWMiActOnMiThreadReadyForChatId").onMiThreadReadyForChatId(a,b.threadId,"MAWBridgeThreadBumpedServerHandle",function(a,e){var f=b.lastActivityTs;f=d("MAWTimeUtils").millisTimeToTimestamp(f);c("promiseDone")(d("WALoggerDeferred").LOG(h(),d("I64").to_string(e),d("I64").to_string(f),b.isCurrentDeviceSendingMsg));return c("LSBumpE2EEMetadataThread")(e,f,b.isCurrentDeviceSendingMsg,c("LSFactory")(a))})}g.call=a}),98);
__d("MAWBridgeThreadHiddenHandler",["LSFactory","LSIntEnum","LSOptimisticRemoveThread","LSThreadRemoveType","MAWDbChatId","MAWMiActOnMiThreadReadyForChatId"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return d("MAWMiActOnMiThreadReadyForChatId").onMiThreadReadyForChatId(a,d("MAWDbChatId").unsafeCoerceToChatId(b),"MAWBridgeThreadHiddenHandler",function(a,b){a=c("LSFactory")(a);return c("LSOptimisticRemoveThread")(b,d("LSIntEnum").ofNumber(c("LSThreadRemoveType").DELETE_THREAD),a)})}g.call=a}),98);
__d("MAWBridgeThreadTimestampsHandler",["CurrentUser","I64","MAWMiActOnMiThreadReadyForChatId","MAWTimeUtils","Promise","ReQL"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(a,c){return d("MAWMiActOnMiThreadReadyForChatId").onMiThreadReadyForChatId(a,c.threadId,"MAWBridgeThreadTimestampsHandler",function(a,e){return d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.table("threads")).getKeyRange(e)).then(function(e){if(e==null)return(h||(h=b("Promise"))).resolve();e=babelHelpers["extends"]({},e,{lastReadWatermarkTimestampMs:d("MAWTimeUtils").millisTimeToTimestamp(c.lastReadWatermarkTs)});return a.table("threads").put(e)})})}function a(a,e){return i(a,e).then(function(){return d("MAWMiActOnMiThreadReadyForChatId").onMiThreadReadyForChatId(a,e.threadId,"MAWBridgeThreadTimestampsHandler",function(a,f){var g=d("I64").of_string(c("CurrentUser").getID());return d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.table("participants")).getKeyRange(f,g)).then(function(c){if(c!=null)return a.table("participants").put({authorityLevel:c.authorityLevel,contactId:c.contactId,deliveredWatermarkTimestampMs:c.deliveredWatermarkTimestampMs,groupParticipantJoinState:c.groupParticipantJoinState,isAdmin:c.isAdmin,isModerator:c.isModerator,isSuperAdmin:c.isSuperAdmin,nickname:c.nickname,normalizedSearchTerms:c.normalizedSearchTerms,participantCapabilities:c.participantCapabilities,readActionTimestampMs:d("MAWTimeUtils").millisTimeToTimestamp(e.lastActivityTimestampMs),readWatermarkTimestampMs:d("MAWTimeUtils").millisTimeToTimestamp(e.lastReadWatermarkTs),subscribeSource:c.subscribeSource,threadKey:c.threadKey});else return(h||(h=b("Promise"))).resolve()})})})}g.call=a}),98);
__d("MAWBridgeThreadUpdatedHandler",["FBLogger","I64","LSBitOffset","MAWBridgeBuildThreadSnippet","MAWBridgeUIEventDataValidation","MAWFolderUtils","MAWMiActOnMiThreadReadyForChatId","ReQL","asyncToGeneratorRuntime","getMAWLastMessageCtaType"],(function(a,b,c,d,e,f,g){"use strict";function h(a,b){return b!=null&&b==="viewer_not_subscribed"?d("LSBitOffset").clear(d("I64").sub(d("I64").of_int32(28),d("I64").of_string("64")),a):a}function i(a,b){var c=b.folder!=null?d("MAWFolderUtils").getMessagingFolderTag(b.folder):a.folderName;return(b=b.cannotReplyReason)!=null?b:c==="inbox"?void 0:a.cannotReplyReason}function a(a,e,f){var g=f.muteExpireTimeMs,j=f.snippetSenderContactId,k=f.threadId;return d("MAWMiActOnMiThreadReadyForChatId").onMiThreadReadyForChatId(e,k,"MAWBridgeThreadUpdatedHandler",function(){var e=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b,e){e=(yield d("ReQL").firstAsync(d("ReQL").fromTableAscending(b.table("threads")).getKeyRange(e)));if(e==null)return;f.fromCheckIfParticipant!=null&&f.fromCheckIfParticipant&&c("FBLogger")("labyrinth_web","checkIfParticipant").warn("[Occamdillo] User not a participant from checkIfParticipant, thread folder: %s",e.folderName);var k=(yield d("MAWBridgeBuildThreadSnippet").buildBridgeThreadSnippet(a,b,f,e.snippet)),l=i(e,f),m=c("getMAWLastMessageCtaType")(f);return b.table("threads").put(babelHelpers["extends"]({},e,{cannotReplyReason:l,capabilities2:h(e.capabilities2,l),folderName:e.folderName,lastMessageCtaType:m,muteExpireTimeMs:g==null?e.muteExpireTimeMs:d("I64").of_float(g),parentThreadKey:e.parentThreadKey,snippet:k,snippetSenderContactId:j==null?e.snippetSenderContactId:d("MAWBridgeUIEventDataValidation").stringToI64Opt(j)}))});return function(a,b){return e.apply(this,arguments)}}())}g.call=a}),98);
__d("MAWBridgeThreadsLoadedHandler",["I64","MAWFolderUtils","MAWThreadId","MAWTimeUtils","Promise","ReQL"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,c){var e=d("MAWFolderUtils").getClientSystemFolder(c.folderId);return d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.table("threads_ranges_v2__generated")).getKeyRange(e)).then(function(f){if(f!=null)return a.table("threads_ranges_v2__generated")["delete"]({hd:f.parentThreadKey,tl:{hd:f.minThreadKey,tl:{hd:f.minLastActivityTimestampMs,tl:0}}}).then(function(){return c.rangeKind==="threadRangeExtensionForLoadBefore"?d("MAWThreadId").toThreadKeyMaybe_DEPRECATED(a,c.minThreadId).then(function(b){if(b!=null)return a.table("threads_ranges_v2__generated").put({hasMoreAfter:f.hasMoreAfter,hasMoreBefore:c.hasMore,isLoadingAfter:f.isLoadingAfter,isLoadingBefore:!1,maxLastActivityTimestampMs:f.maxLastActivityTimestampMs,maxThreadKey:f.maxThreadKey,minLastActivityTimestampMs:d("MAWTimeUtils").millisTimeToTimestamp(c.minLastActivityTs),minThreadKey:b,parentThreadKey:f.parentThreadKey})}):a.table("threads_ranges_v2__generated").put({hasMoreAfter:f.hasMoreAfter,hasMoreBefore:f.hasMoreBefore,isLoadingAfter:f.isLoadingAfter,isLoadingBefore:!1,maxLastActivityTimestampMs:f.maxLastActivityTimestampMs,maxThreadKey:f.maxThreadKey,minLastActivityTimestampMs:f.minLastActivityTimestampMs,minThreadKey:f.minThreadKey,parentThreadKey:f.parentThreadKey})});switch(c.rangeKind){case"initialNoThread":return a.table("threads_ranges_v2__generated").put({hasMoreAfter:!1,hasMoreBefore:!1,isLoadingAfter:!1,isLoadingBefore:!1,maxLastActivityTimestampMs:d("MAWTimeUtils").MAX_TIMESTAMP_MS,maxThreadKey:d("I64").zero,minLastActivityTimestampMs:d("MAWTimeUtils").MAX_TIMESTAMP_MS,minThreadKey:d("I64").zero,parentThreadKey:e});case"initialThreadRange":return(h||(h=b("Promise"))).all([d("MAWThreadId").toThreadKeyMaybe_DEPRECATED(a,c.minThreadId),d("MAWThreadId").toThreadKeyMaybe_DEPRECATED(a,c.maxThreadId)]).then(function(b){var f=b[0];b=b[1];if(f!=null&&b!=null)return a.table("threads_ranges_v2__generated").add({hasMoreAfter:!1,hasMoreBefore:c.hasMore,isLoadingAfter:!1,isLoadingBefore:!1,maxLastActivityTimestampMs:d("MAWTimeUtils").millisTimeToTimestamp(c.maxLastActivityTs),maxThreadKey:b,minLastActivityTimestampMs:d("MAWTimeUtils").millisTimeToTimestamp(c.minLastActivityTs),minThreadKey:f,parentThreadKey:e})});case"threadRangeExtensionForLoadBefore":return(h||(h=b("Promise"))).resolve()}})}g.call=a}),98);
__d("MAWBridgeUIEventQueueQPLLogger",["QPLUserFlow","qpl"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){c("QPLUserFlow").start(c("qpl")._(1056849266,"1765"),{annotations:{string_array:{events:b}},instanceKey:a})}function b(a){c("QPLUserFlow").endSuccess(c("qpl")._(1056849266,"1765"),{instanceKey:a})}function d(a,b){c("QPLUserFlow").endFailure(c("qpl")._(1056849266,"1765"),"MAWBridgeUIEventHandlerFailure",{annotations:{string:{failedEventTag:b}},instanceKey:a})}g.start=a;g.endSuccess=b;g.endFailure=d}),98);
__d("MAWBridgeUnArchivedSelfDeviceChangeAlertsHandler",["Promise"],(function(a,b,c,d,e,f){"use strict";var g;function a(a,c){return(g||(g=b("Promise"))).resolve()}f.call=a}),66);
__d("MAWBridgeUpdateE2EEMetadataParticipantsHandler",["LSFactory","LSUpdateE2EEMetadataParticipants","MAWMiActOnMiThreadReadyForChatId"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return d("MAWMiActOnMiThreadReadyForChatId").onMiThreadReadyForChatId(a,b.threadId,"MAWBridgeThreadsLoadedHandler",function(a,b){return c("LSUpdateE2EEMetadataParticipants")(b,c("LSFactory")(a))})}g.call=a}),98);
__d("MAWBridgeUpdateMessageRangeHandler",["I64","LSClearMessagePlaceholderRange","LSFactory","LSInsertNewMessageRange","MAWMiActOnMiThreadReadyForChatId","MAWTimeUtils","ReQL","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function a(a,e){return d("MAWMiActOnMiThreadReadyForChatId").onMiThreadReadyForChatId(a,e.threadId,"MAWBridgeUpdateMessageRangeHandler",function(){var f=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b,f){var g;yield c("LSClearMessagePlaceholderRange")(f,"",d("MAWTimeUtils").MAX_TIMESTAMP_MS,c("LSFactory")(b));var h=(yield d("ReQL").firstAsync(d("ReQL").fromTableDescending(a.table("messages_ranges_v2__generated")).getKeyRange(f)));h!=null&&(yield a.table("messages_ranges_v2__generated")["delete"](d("ReQL").key(h.threadKey,h.minTimestampMs,h.minMessageId)));var i=e.hasMoreAfter,j=e.hasMoreBefore,k=e.maxMsgId,l=e.minMsgId,m=j&&e.minMsgTs!=null?d("I64").of_float(e.minMsgTs):(h==null?void 0:h.minTimestampMs)||d("MAWTimeUtils").MIN_TIMESTAMP_MS,n=(h==null?void 0:h.minTimestampMs)!=null&&d("I64").lt(h==null?void 0:h.minTimestampMs,m),o=i&&e.maxMsgTs!=null?d("I64").of_float(e.maxMsgTs):d("MAWTimeUtils").MAX_TIMESTAMP_MS,p=d("MAWTimeUtils").MIN_TIMESTAMP_MS;g=(g=o)!=null?g:d("MAWTimeUtils").MAX_TIMESTAMP_MS;return c("LSInsertNewMessageRange")(f,n?(h==null?void 0:h.minTimestampMs)||d("MAWTimeUtils").MIN_TIMESTAMP_MS:m,o,n?(f=h==null?void 0:h.minMessageId)!=null?f:"":(m=l)!=null?m:"",(o=k)!=null?o:"",p,g,n?(h==null?void 0:h.hasMoreBefore)||!0:j,i,void 0,c("LSFactory")(b))});return function(a,b){return f.apply(this,arguments)}}())}g.call=a}),98);
__d("MAWBridgeUpdateMinMessageHandler",["I64","MAWMiActOnMiThreadReadyForChatId","ReQL","ReQLTable","unrecoverableViolation"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){var e=d("I64").of_float(b.minTimestampMs),f=b.minMessageId;return d("MAWMiActOnMiThreadReadyForChatId").onMiThreadReadyForChatId(a,b.threadId,"MAWBridgeUpdateMinMessageHandler",function(a,g){return d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.table("messages_ranges_v2__generated")).getKeyRange(g)).then(function(h){if(h==null)return;var i=b.hasMoreBefore,j=i!=null?i:h.hasMoreBefore;return d("ReQLTable").update(a.table("messages_ranges_v2__generated"),{hd:g,tl:{hd:h.minTimestampMs,tl:{hd:h.minMessageId,tl:0}}},function(a){if(a!=null)return{hasMoreAfter:a.hasMoreAfter,hasMoreBefore:j,isLoadingAfter:a.isLoadingAfter,isLoadingBefore:a.isLoadingBefore,maxMessageId:a.maxMessageId,maxTimestampMs:a.maxTimestampMs,minMessageId:f,minTimestampMs:e,threadKey:a.threadKey};throw c("unrecoverableViolation")("Thread is missing in updating the min message in message range","messenger_e2ee_web")})})})}g.call=a}),98);
__d("MAWBridgeXMAShareExpiredHandler",["MAWMiActOnMiThreadReadyForChatId","Promise"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,c){var e=String(c.xmaId);return d("MAWMiActOnMiThreadReadyForChatId").onMiThreadReadyForChatId(a,c.chatId,"MAWBridgeXMAShareExpiredHandler",function(a,d){return a.table("attachments").get({hd:d,tl:{hd:c.msgId,tl:{hd:e,tl:0}}}).then(function(f){if(f==null)return(h||(h=b("Promise"))).resolve();f=[f.defaultCtaId,f.attachmentCta1Id,f.attachmentCta2Id,f.attachmentCta3Id].filter(Boolean);f=f.map(function(b){return a.table("attachment_ctas")["delete"]({hd:b,tl:0})});return(h||(h=b("Promise"))).all(f).then(function(){return a.table("attachments")["delete"]({hd:d,tl:{hd:c.msgId,tl:{hd:e,tl:0}}})})})})}g.call=a}),98);
__d("MAWBridgeXMAShareTombstonedHandler",["FBLogger","MAWMiActOnMiThreadReadyForChatId","Promise","ReQL"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,e){var f=String(e.xmaId);return d("MAWMiActOnMiThreadReadyForChatId").onMiThreadReadyForChatId(a,e.threadId,"MAWBridgeXMAShareTombstonedHandler",function(a,g){return a.table("attachments").get({hd:g,tl:{hd:e.msgId,tl:{hd:f,tl:0}}}).then(function(i){if(i==null)return(h||(h=b("Promise"))).resolve();i=[i.defaultCtaId,i.attachmentCta1Id,i.attachmentCta2Id,i.attachmentCta3Id].filter(Boolean);i=i.map(function(b){return a.table("attachment_ctas")["delete"]({hd:b,tl:0})});return(h||(h=b("Promise"))).all(i).then(function(){return d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.table("attachments")).getKeyRange(g,e.msgId,f)).then(function(d){if(d!=null){d=babelHelpers["extends"]({},d,{attachmentCta1Id:void 0,attachmentCta2Id:void 0,attachmentCta3Id:void 0,cta1Title:void 0,cta1Type:void 0,cta2Title:void 0,cta2Type:void 0,cta3Title:void 0,cta3Type:void 0,defaultCtaId:void 0,defaultCtaTitle:void 0,maxSubtitleNumOfLines:void 0,maxTitleNumOfLines:void 0,previewHeight:void 0,previewHeightLarge:void 0,previewWidth:void 0,previewWidthLarge:void 0,subtitleText:void 0,titleText:void 0});return a.table("attachments").put(d)}c("FBLogger")("messenger_e2ee_web").blameToPreviousFrame().mustfix("Trying to tombstone a secure xma attachment but no existing attachment");return(h||(h=b("Promise"))).resolve()})})})})}g.call=a}),98);
__d("MAWBridgeUIEventHandler",["FBLogger","JSResourceForInteraction","MAWAbPropsClient","MAWBridgeDeleteGroupInviteHandler","MAWBridgeDeleteMessageRangesV2Handler","MAWBridgeDeleteMessagesHandler","MAWBridgeDeleteReactionHandler","MAWBridgeDropAllSecureThreadsHandler","MAWBridgeGroupInfoUpdatedHandler","MAWBridgeGroupInviteLoadedHandler","MAWBridgeGroupInviteUpdateHandler","MAWBridgeMediaExpiredHandler","MAWBridgeMsgRangeLoadedHandler","MAWBridgeMsgUpdatedHandler","MAWBridgeMsgsLoadedHandler","MAWBridgeMsgsStartCountdownHandler","MAWBridgeNewMediaHandler","MAWBridgeNewMediaRangeHandler","MAWBridgeNewMsgHandler","MAWBridgeNewXMAHandler","MAWBridgeOccamadilloVerifyThreadExistsHandler","MAWBridgeOneToOneMessageRequestLoadedHandler","MAWBridgeParticipantRemovedHandler","MAWBridgeParticipantUpdatedHandler","MAWBridgeParticipantsUpdatedHandler","MAWBridgeRavenActionMsgForUIHandler","MAWBridgeReactionUpsertHandler","MAWBridgeReceivedChatStateHandler","MAWBridgeReceivedReceiptHandler","MAWBridgeSyncContacts","MAWBridgeThreadBumpedHandler","MAWBridgeThreadBumpedServerHandler","MAWBridgeThreadHiddenHandler","MAWBridgeThreadTimestampsHandler","MAWBridgeThreadUpdatedHandler","MAWBridgeThreadsLoadedHandler","MAWBridgeUIEventQPLLogger","MAWBridgeUIEventQueueQPLLogger","MAWBridgeUnArchivedSelfDeviceChangeAlertsHandler","MAWBridgeUpdateClientRestoreStatus","MAWBridgeUpdateE2EEMetadataParticipantsHandler","MAWBridgeUpdateMessageRangeHandler","MAWBridgeUpdateMinMessageHandler","MAWBridgeXMAShareExpiredHandler","MAWBridgeXMAShareTombstonedHandler","MAWEphemeralMessageExpirationStorage","MAWGating","Promise","WATagsLogger","WATimeUtils","asyncToGeneratorRuntime","getErrorSafe","gkx","promiseDone","recoverableViolation","requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Handle UI Events: ",""]);i=function(){return a};return a}var j=c("requireDeferred")("MAWBridgeIssuePointQueryHandler").__setRef("MAWBridgeUIEventHandler"),k=c("requireDeferred")("MAWBridgeStartTraceHandler").__setRef("MAWBridgeUIEventHandler"),l=c("requireDeferred")("MAWBridgeStartTraceWithTraceIdHandler").__setRef("MAWBridgeUIEventHandler"),m=c("requireDeferred")("MAWBridgeTraceRecordCheckpointHandler").__setRef("MAWBridgeUIEventHandler"),n=c("requireDeferred")("MAWBridgeUpdateDyiStatus").__setRef("MAWBridgeUIEventHandler"),o=c("requireDeferred")("MAWBridgeUpdateTraceHandler").__setRef("MAWBridgeUIEventHandler"),p=c("requireDeferred")("MAWBridgeUploadMessageByBatchHandler").__setRef("MAWBridgeUIEventHandler"),q=c("requireDeferred")("MAWBridgeUploadMessageHandler").__setRef("MAWBridgeUIEventHandler"),r=c("requireDeferred")("MAWBridgeUploadThreadHandler").__setRef("MAWBridgeUIEventHandler"),s=c("gkx")("9017")===!0;function t(a,e,f){switch(f.tag){case"NewMsg":return d("MAWBridgeNewMsgHandler").call(a,e,f.value);case"MsgsStartCountdown":return d("MAWBridgeMsgsStartCountdownHandler").call(e,f.value);case"MsgClearCountdown":return(h||(h=b("Promise"))).resolve(d("MAWEphemeralMessageExpirationStorage").clearMessageFromExpiration(f.value));case"DropAllSecureThreads":return d("MAWBridgeDropAllSecureThreadsHandler").call(e);case"VerifyThreadExists":var g=f.value;return d("MAWBridgeOccamadilloVerifyThreadExistsHandler").call(e,g);case"MsgUpdated":return d("MAWBridgeMsgUpdatedHandler").call(a,e,f.value);case"NewMedia":return d("MAWBridgeNewMediaHandler").call(e,f.value);case"NewMediaRange":return d("MAWBridgeNewMediaRangeHandler").call(e,f.value);case"MediaExpired":return d("MAWBridgeMediaExpiredHandler").call(e,f.value);case"XMAShareExpired":return d("MAWBridgeXMAShareExpiredHandler").call(e,f.value);case"NewXMA":return d("MAWBridgeNewXMAHandler").call(e,f.value);case"XMAShareTombstoned":return d("MAWBridgeXMAShareTombstonedHandler").call(e,f.value);case"ParticipantUpdated":return d("MAWBridgeParticipantUpdatedHandler").call(e,f.value);case"ParticipantRemoved":return d("MAWBridgeParticipantRemovedHandler").call(e,f.value);case"UpdateE2EEMetadataParticipants":return d("MAWBridgeUpdateE2EEMetadataParticipantsHandler").call(e,f.value);case"ReceivedReceipt":return d("MAWBridgeReceivedReceiptHandler").call(e,f.value);case"ThreadUpdated":return d("MAWBridgeThreadUpdatedHandler").call(a,e,f.value);case"GroupInfoUpdated":return d("MAWBridgeGroupInfoUpdatedHandler").call(e,f.value);case"ThreadBumped":return d("MAWBridgeThreadBumpedHandler").call(a,e,f.value);case"ThreadsLoaded":return d("MAWBridgeThreadsLoadedHandler").call(e,f.value);case"ThreadTimestampsUpdated":return d("MAWBridgeThreadTimestampsHandler").call(e,f.value);case"MsgsLoaded":return d("MAWBridgeMsgsLoadedHandler").call(e,f.value);case"MsgRangeLoaded":return d("MAWBridgeMsgRangeLoadedHandler").call(e,f.value);case"StartTrace":return k.load().then(function(a){return a.call(e,f.value)});case"UpdateTrace":return o.load().then(function(a){return a.call(e,f.value)});case"ThreadHidden":return d("MAWBridgeThreadHiddenHandler").call(e,f.value);case"SyncContacts":return d("MAWBridgeSyncContacts").call(e,f.value);case"ReceivedChatState":return d("MAWBridgeReceivedChatStateHandler").call(e,f.value);case"ClockSkewUpdated":return(h||(h=b("Promise"))).resolve(d("WATimeUtils").setClockSkew(f.value));case"ABPropsUpdated":return(h||(h=b("Promise"))).resolve(d("MAWAbPropsClient").rewrite(f.value));case"UpsertReaction":return d("MAWBridgeReactionUpsertHandler").call(e,f.value);case"DeleteReaction":return d("MAWBridgeDeleteReactionHandler").call(e,f.value);case"UploadMessage":return q.load().then(function(a){return a.call(e,f.value)});case"UploadMessageByBatch":return p.load().then(function(a){return a.call(e,f.value)});case"UploadThread":return r.load().then(function(a){return a.call(e,f.value)});case"UploadAttachment":return c("JSResourceForInteraction")("MAWBridgeUploadAttachmentHandler").__setRef("MAWBridgeUIEventHandler").load().then(function(a){return a.call(e,f.value)});case"ResignAttachmentCDNUrl":return c("JSResourceForInteraction")("MAWBridgeResignAttachmentCDNUrlHandler").__setRef("MAWBridgeUIEventHandler").load().then(function(a){return a.call(e,f.value)});case"DeleteMessages":return d("MAWBridgeDeleteMessagesHandler").call(e,f.value);case"RestoreMessageBatch":return c("JSResourceForInteraction")("MAWBridgeRestoreMessageBatchHandler").__setRef("MAWBridgeUIEventHandler").load().then(function(a){return a.call(e,f.value)});case"OneToOneMessageRequestLoaded":return d("MAWBridgeOneToOneMessageRequestLoadedHandler").call(e,f.value);case"GroupInviteUpdate":return d("MAWBridgeGroupInviteUpdateHandler").call(e,f.value);case"UpdateDyiStatus":return n.load().then(function(a){return a.call(e,f.value)});case"DeleteGroupInvite":return d("MAWBridgeDeleteGroupInviteHandler").call(e,f.value);case"TraceRecordCheckpoint":return m.load().then(function(a){return a.call(e,f.value)});case"DeleteMessageRangesV2":return d("MAWBridgeDeleteMessageRangesV2Handler").call(e,f.value);case"UpdateMinMessage":return d("MAWBridgeUpdateMinMessageHandler").call(e,f.value);case"IssuePointQuery":return j.load().then(function(a){return a.call(e,f.value)});case"ThreadBumpedServer":return d("MAWBridgeThreadBumpedServerHandler").call(e,f.value);case"ParticipantsUpdated":return d("MAWBridgeParticipantsUpdatedHandler").call(e,f.value);case"StartTraceWithTraceId":return l.load().then(function(a){return a.call(e,f.value)});case"UpdateClientRestoreStatus":return d("MAWBridgeUpdateClientRestoreStatus").call(e,f.value);case"NewMsgs":return d("MAWBridgeNewMsgHandler").bulkCall(a,e,f.value.msgs);case"UnArchivedSelfDeviceChangeAlerts":return d("MAWBridgeUnArchivedSelfDeviceChangeAlertsHandler").call(e,f.value);case"EphemeralSettingsUpdatedForUI":return c("JSResourceForInteraction")("MAWBridgeEphemeralSettingsUpdatedForUIHandler").__setRef("MAWBridgeUIEventHandler").load().then(function(a){return a.call(e,f.value)});case"RavenActionUpdate":return d("MAWBridgeRavenActionMsgForUIHandler").call(e,f.value);case"GroupInviteLoaded":return d("MAWBridgeGroupInviteLoadedHandler").call(e,f.value);case"UpdateMessageRange":return d("MAWBridgeUpdateMessageRangeHandler").call(e,f.value);default:return(h||(h=b("Promise"))).resolve()}}function a(a,b){if(s)return;var e=d("MAWGating").isArmadillo();if(!e){c("recoverableViolation")("User is neither part of armadillo QE and dual send QE but somehow loaded this handler","messenger_web_product");return}e={};e=b.reduce(function(a,b){a[b.tag]=((b=a[b.tag])!=null?b:0)+1;return a},e);d("WATagsLogger").TAGS(["MAWBridgeUIEvent"]).LOG(i(),e);c("promiseDone")(u(a,b))}function u(a,b){return v.apply(this,arguments)}function v(){v=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e){var f=(yield a);a=d("MAWBridgeUIEventQPLLogger").getInstanceKey();var g=e.map(function(a){return a.tag}),h="";d("MAWBridgeUIEventQueueQPLLogger").start(a,g);var i;try{i=(yield f.runInTransaction(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){for(var b=0;b<e.length;b++){var g=e[b],i=d("MAWBridgeUIEventQPLLogger").getInstanceKey();d("MAWBridgeUIEventQPLLogger").start(i,g,{suppress:s});try{yield t(f,a,g),d("MAWBridgeUIEventQPLLogger").endSuccess(i)}catch(a){var j=c("getErrorSafe")(a);h=g.tag;d("MAWBridgeUIEventQPLLogger").endFailure(i,g.tag);c("FBLogger")("messenger_e2ee_web").catching(j).mustfix("[MAWBridgeUIEventHandler] Failed to handle UI event: %s",g.tag);return!1}}return!0});return function(b){return a.apply(this,arguments)}}(),"readwrite"))}catch(a){c("FBLogger")("messenger_e2ee_web").catching(a).info("DbError handling UI events"),i=!1}!i?(d("MAWBridgeUIEventQueueQPLLogger").endFailure(a,h),c("FBLogger")("messenger_e2ee_web").mustfix("MAWBridgeUIEventHandler] Did not commit UI events to DB: %s",g.toString())):d("MAWBridgeUIEventQueueQPLLogger").endSuccess(a)});return v.apply(this,arguments)}function e(a,b,c){return w.apply(this,arguments)}function w(){w=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e){var f=d("MAWBridgeUIEventQPLLogger").getInstanceKey();try{d("MAWBridgeUIEventQPLLogger").start(f,e,{suppress:s}),yield t(a,b,e),d("MAWBridgeUIEventQPLLogger").endSuccess(f)}catch(b){a=c("getErrorSafe")(b);d("MAWBridgeUIEventQPLLogger").endFailure(f,e.tag);c("FBLogger")("messenger_e2ee_web").catching(a).mustfix("[handleShimEvent] Failed to handle UI event: %s",e.tag);c("FBLogger")("messenger_e2ee_web").mustfix("handleShimEvent] Did not commit UI events to DB: %s",e.tag);throw b}});return w.apply(this,arguments)}g.handleEvents=a;g.handleShimEvent=e}),98);
__d("MAWBridgeSetupLoggingUtils",[],(function(a,b,c,d,e,f){"use strict";function a(a){var b=[["appdata",a.appdata],["instruction",a.instruction],["messages",a.message],["notifications",a.notification],["receipt",a.receipt],["retryReceipt",a.retryReceipt]].filter(function(a){a[0];a=a[1];return a>0}).map(function(a){var b=a[0];a=a[1];return b.concat(": "+a)});return[""+a.count].concat(b).join(", ")}function b(a,b){var c=[["appdata",a.appdata,b.appdata],["instruction",a.instruction,b.instruction],["messages",a.message,b.message],["notifications",a.notification,b.notification],["receipt",a.receipt,b.receipt],["retryReceipt",a.retryReceipt,b.retryReceipt]].filter(function(a){a[0];a[1];a=a[2];return a>0}).map(function(a){var b=a[0],c=a[1];a=a[2];return b.concat(": "+c+" / "+a)});return[a.count+" / "+b.count].concat(c).join(", ")}f.stanzasCountStr=a;f.stanzasProgressCountStr=b}),66);
__d("MAWOccamadilloOnMutexChange",["I64","LSDefaultSyncGroups","LSIntEnum","LSSyncGroupsUtils","MAWGating","Promise","WALogger","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[Occamadillo] Resetting sync cursor and network request"]);i=function(){return a};return a}function j(a){var c=d("LSDefaultSyncGroups").e2eeMetadataSyncGroup;if(!d("MAWGating").isOccamadilloResumeSyncEnabled()&&c!=null)return a.table("sync_groups").put(babelHelpers["extends"]({},d("LSSyncGroupsUtils").defaultSyncGroup,{groupId:d("LSIntEnum").ofNumber(c.groupId)}));else return(h||(h=b("Promise"))).resolve()}function k(a){if(!d("MAWGating").isOccamadilloResumeSyncEnabled())return a.table("network_requests").put({epochId:void 0,failureCount:d("I64").zero,lastDelayedRequestTimestampMs:void 0,lastSentTimestampMs:d("I64").zero,lastSyncRequestTimestampMs:d("I64").zero,networkTaskIdentifier:void 0,syncDatabaseId:d("LSIntEnum").ofNumber(95),taskQueueName:""});else return(h||(h=b("Promise"))).resolve()}function a(a){d("WALogger").LOG(i()),c("promiseDone")(a.runInTransaction(function(a){return(h||(h=b("Promise"))).all([j(a),k(a)])},"readwrite"))}g.onOccamadilloMutexChange=a}),98);
__d("MAWCommonBackendSetup",["MAWAppMutex","MAWEncyptionIndexedDbV2","MAWInit","MAWIssueNewUserVisibleErrors","MAWLocalStorage","MAWVaultMaterialsStorage","MWSetupDBEncryption","Promise","asyncToGeneratorRuntime","cr:3484","promiseDone","requireDeferred","shouldUseMAWSharedWorker"],(function(a,b,c,d,e,f,g){"use strict";var h,i=c("requireDeferred")("MAWMainThreadLogger").__setRef("MAWCommonBackendSetup");function a(a,b,c,d,e){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f,g,j){e.start();e.logPoint("setup_armadillo_backend");i.onReadyImmediately(function(a){a=a.setupMainWaLogger;return a()});var k=d("shouldUseMAWSharedWorker").shouldUseMAWSharedWorker();yield e.measurePerformance("detection_support",function(){var a=window.indexedDB!=null;if(!a)throw new(d("MAWInit").MAWInitError)("indexeddb_not_supported_by_browser");if(k)return(h||(h=b("Promise"))).resolve();a=d("MAWLocalStorage").isLocalStorageAvailable();if(!a)throw new(d("MAWInit").MAWInitError)("localstorage_not_supported");return(h||(h=b("Promise"))).resolve()});var l=e.measurePerformance("setup_vault_materials",function(){return d("MAWVaultMaterialsStorage").setupVaultMaterials()}),m=(yield e.measurePerformance("acquire_mutex",function(){try{d("shouldUseMAWSharedWorker").logExposureForMAWSharedWorker();var a=d("MAWAppMutex").use().init();if(k){c("promiseDone")(a);return(h||(h=b("Promise"))).resolve(!0)}return a}catch(a){if(k)return(h||(h=b("Promise"))).resolve(!0);throw a}})),n=(yield e.measurePerformance("ear_db_setup",b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield d("MWSetupDBEncryption").init());d("MAWEncyptionIndexedDbV2").maybeSetEncryptionDbOnVersionChange(function(){d("MAWIssueNewUserVisibleErrors").issueError(d("MAWIssueNewUserVisibleErrors").MAWLegacyUserErrorMsgBody,d("MAWIssueNewUserVisibleErrors").MAWLegacyUserErrorMsgTitle,d("MAWIssueNewUserVisibleErrors").MAWUserVisibleErrorPresentationType.BANNER)});return a})));if(!n.success){e.logPoint("keychain_setup_failure");throw new(d("MAWInit").MAWInitError)("keychain_setup_failure")}b("cr:3484")!=null&&c("promiseDone")(b("cr:3484").setupArmadilloPushNotifications());if(!m){e.logPoint("maw_appmutex_no_permission");throw new(d("MAWInit").MAWInitError)("maw_appmutex_no_permission")}var o=(yield l);yield e.measurePerformance("setup_worker",function(){return a(o,f,g,j,"backendSetup")})});return j.apply(this,arguments)}g.setupArmadilloBackend=a}),98);
__d("MAWReinit",["ExecutionEnvironment","MAWCurrentUser","MAWEBSwitch","QPLUserFlow","QuickPerformanceLogger","UserTimingUtils","asyncToGeneratorRuntime","gkx","performanceNow","qpl","shouldUseMAWSharedWorker"],(function(a,b,c,d,e,f,g){"use strict";var h=c("qpl")._(25310984,"169");function a(a){var e=a!=null?{instanceKey:a}:void 0,f=!1,g=!1;function i(){if(g)return;g=!0;c("QPLUserFlow").start(h,babelHelpers["extends"]({cancelOnUnload:!0,onFlowTimeout:function(){f=!0},timeoutInMs:c("ExecutionEnvironment").canUseDOM?6e4:0},e));q()}function j(a){if(!g||f)return;q();c("QPLUserFlow").addPoint(h,a,e)}function k(a,b){var d;if(!g||f)return;c("QPLUserFlow").addAnnotations(h,{bool:(d={},d[a]=b,d)})}function l(a,b){var d;if(!g||f)return;c("QPLUserFlow").addAnnotations(h,{string:(d={},d[a]=b,d)})}function m(a,b){var d;if(!g||f)return;c("QPLUserFlow").addAnnotations(h,{"int":(d={},d[a]=b,d)})}function n(a){q(),f=!0,c("QPLUserFlow").addAnnotations(h,{string:{failReason:a}},e),c("QPLUserFlow").endFailure(h,"maw_init_fail",e),p=!1}function o(a){q(),f=!0,p=!1,c("QPLUserFlow").addAnnotations(h,{string:{dropReason:a}},e),c("QuickPerformanceLogger").markerDrop(h)}var p=!1;function q(){if(p)return;p=!0;c("QPLUserFlow").addAnnotations(h,{bool:{armadillo_init_sync_api_improvements:c("gkx")("1115"),isArmadilloPublicLaunchUser:c("gkx")("688"),isEBEnabled:c("MAWEBSwitch").isEnabled(),isIndexedDbEarEnabled:!0,isTlcPublicUser:d("MAWCurrentUser").isTlcPublicUser(),useSharedWorker:d("shouldUseMAWSharedWorker").shouldUseMAWSharedWorker()}})}function r(a){q(),f=!0,c("QPLUserFlow").addAnnotations(h,{string:{cancelReason:a}},e),c("QPLUserFlow").endCancel(h,e),p=!1}function s(){q(),f=!0,c("QPLUserFlow").endSuccess(h,e),p=!1}function t(a,b){return u.apply(this,arguments)}function u(){u=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var e=c("performanceNow")(),f=a+"_start",g=a+"_end";j(f);f=(yield b());j(g);c("gkx")("8518")&&d("UserTimingUtils").measureModern(a,{end:c("performanceNow")(),start:e});return f});return u.apply(this,arguments)}return{addBoolAnnotation:k,addIntAnnotation:m,addStringAnnotation:l,cancel:r,drop:o,endSuccess:s,fail:n,logPoint:j,measurePerformance:t,start:i}}g.getMAWReinit=a}),98);
__d("MAWReinitWorker",["MAWCommonBackendSetup","MAWOccamadilloOnMutexChange","MAWReinit","asyncToGeneratorRuntime","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.allTablesPersisted,e=a.db,f=a.dispatch,g=a.dispatchClearEphemeralSettings,h=a.environment,i=a.getOrSetupWorker,j=a.instanceKey,k=a.logout,l=a.reregisterDevice,m=a.setupBridge;a=d("MAWReinit").getMAWReinit(j);j=function(){f({tag:"InitOfflineQueueSyncComplete",value:void 0})};yield d("MAWCommonBackendSetup").setupArmadilloBackend(i,a,function(a){c("promiseDone")(m({dispatch:f,environment:h,logout:k,reregisterDevice:l,worker:a}).then(function(){b||d("MAWOccamadilloOnMutexChange").onOccamadilloMutexChange(e)}))},j,j);a.endSuccess();g()});return h.apply(this,arguments)}g["default"]=a}),98);
__d("MAWCommonSetupBridge",["BrowserLockManager","CurrentUser","ErrorTransport","I64","LSDatabaseSingleton","LSIntEnum","LSMessagingThreadAttributionType","MAWBridge","MAWChatJid","MAWCrossWorkerPortal","MAWCurrentUser","MAWDbMedia","MAWEBSwitch","MAWFrontendMediaUtils","MAWGating","MAWJobActionsV2","MAWTTRCSafe","MAWThreadCutover","MAWVault","MAWXMAUtils","MWLogSend.bs","MultipleTabsLogger","ODS","Promise","QPLEvent","QPLUserFlow","URLMatcher","WACrossWorkerPortal","WADevToolMessageChannel","WADevToolsBridge","WAJids","cr:2036","err","gkx","justknobx","pageID","promiseDone","requireDeferred","shouldUseMAWSharedWorker"],(function(a,b,c,d,e,f,g){"use strict";var h,i=c("requireDeferred")("MAWMainThreadLogger").__setRef("MAWCommonSetupBridge"),j=new Set([25312111,25311870]),k=new Map(),l=new Map(),m=new Map([[d("MAWDbMedia").MEDIA_TYPE.IMAGE,8],[d("MAWDbMedia").MEDIA_TYPE.VIDEO,10],[d("MAWDbMedia").MEDIA_TYPE.GIF,6],[d("MAWDbMedia").MEDIA_TYPE.STICKER,4],[d("MAWDbMedia").MEDIA_TYPE.PTT,11],[d("MAWDbMedia").MEDIA_TYPE.DOCUMENT_FILE,9]]),n=new Set([25312150,25313100,25304093,1056840931,25299294]);function o(a,b){return a+"_"+b}function p(a,b,c,d,e,f,g){if(a==="revokeMsg")return 26;if(e!=null)return e;if(c)return 3;if(d&&f===!1)return 13;if(g===!0)return 13;a=b!=null?m.get(b):null;return(e=a)!=null?e:0}function q(a,b,e){return c("LSDatabaseSingleton").then(function(f){return d("MAWThreadCutover").isCutoverSecureThreadFromChatJid(f,a).then(function(a){c("QPLUserFlow").addAnnotations(b,{bool:{isCutover:a}},{instanceKey:e})})})}var r={fbErrorProxy:function(a){d("ErrorTransport").log(a)},log:function(a){var b=a.logLevel,c=a.logString,d=a.tags;switch(b){case"log":i.onReadyImmediately(function(a){a=a.info;return a(c,d)});return;case"warn":i.onReadyImmediately(function(a){a=a.warn;return a(c,d)});return;case"logRestricted":i.onReadyImmediately(function(a){a=a.logRestricted;return a(c,d)});return;case"debug":break;case"error":break;default:break}},logError:function(a){var b=a.entriesToReport,c=a.framesToPop,d=a.logString,e=a.message,f=a.stack,g=a.tags;i.onReadyImmediately(function(a){a=a.logError;return a(d,g,e,f,c,b)})},odsBumpEntityKey:function(a){var b=a.amount,e=a.entity;a=a.key;d("ODS").bumpEntityKey(3185,e,a+"."+(c("CurrentUser").getAppID()||"unknown"),b)},onJobFinished:function(a){a.type==="createGroup"&&a.originalArgs.key!=null&&d("MAWJobActionsV2").recentFinishedJobsCache.set(a.originalArgs.key,a.result);switch(a.type){case"sendMsg":case"sendMediaMsg":case"sendReactionMsg":case"sendXMAShareMsg":case"forwardMsg":var b=a.originalArgs.chatJid,e=a.type==="sendXMAShareMsg"?a.originalArgs.xmaMsgExternalId:a.originalArgs.externalId;k.set(o(b,e),babelHelpers["extends"]({},a.originalArgs,{type:"sendMsg"}));break;case"revokeMsgs":b=a.result;b.forEach(function(a){var b=a.deleting;a=a.original;k.set(o(b.chat,b.externalId),{chatJid:a.chat,externalId:a.externalId,type:"revokeMsg"})});break;case"sendAppData":e=a.originalArgs;var f=a.result;(b=e.args.contents.actions)==null?void 0:b.forEach(function(a){a=a.messageAction;if(a==null||a.type!=="delete_for_me"||f.type!=="not_sent")return;l.set(f.appDataExternalId,{chatJid:a.protocolMsgId.chat,externalId:a.protocolMsgId.externalId,type:"deleteMsgForMe"})});break}if(a.type==="sendWrittenMsg"){e=a.originalArgs.protocolMsgId;b=e.chat;e=e.externalId;b=o(b,e);var g=k.get(b);k["delete"](b);if(a.result.type==="success"&&g!=null){var h,i=g.type!=="revokeMsg"?e:g.externalId,j=g.args,m=g.chatJid;b=g.file;e=g.type;g=(j==null?void 0:j.reactToAuthor)!=null;var n=null;g&&(n=(j==null?void 0:j.reaction)!=null?20:27);g=(j==null?void 0:j.specialTextSize)!=null;b=b!=null?d("MAWFrontendMediaUtils").getMediaTypeAndServerMediaTypeFromBlob(b.type).mediaType:null;var q=(j==null?void 0:j.xmaMessageType)!=null,r=(j==null?void 0:j.quote)!=null||d("MAWXMAUtils").isXMAStoryReply(j==null?void 0:j.xmaMessageType);h=c("URLMatcher").match(d("MAWVault").unvault((h=j==null?void 0:j.content)!=null?h:""));h=h!=null&&h.length>0;var s=p(e,b,g,q,n,r,h),t=d("WAJids").switchOnMsgrChatJidType(m,{group:function(){return d("LSIntEnum").ofNumber(16)},user:function(){return d("LSIntEnum").ofNumber(15)}});c("promiseDone")(c("LSDatabaseSingleton").then(function(a){var b=(j==null?void 0:j.source)!=null?j.source:d("LSIntEnum").ofNumber(c("LSMessagingThreadAttributionType").UNKNOWN);c("promiseDone")(d("MAWChatJid").toThreadKey(a,m).then(function(e){if(c("justknobx")._("154")&&d("shouldUseMAWSharedWorker").shouldUseMAWSharedWorker()&&(c("BrowserLockManager")!=null&&!d("MultipleTabsLogger").hasUniqueLock()))return;d("MWLogSend.bs").log(a,e,t,i,[],d("I64").of_string(d("MAWCurrentUser").getID()),b,s,r,1,1,d("I64").to_string(e),j==null?void 0:(e=j.ephemeralSetting)==null?void 0:e.ephemeralExpirationInSec,void 0,j==null?void 0:j.initiatingSource)}))}))}}if(a.type==="sendWrittenAppData"){e=a.originalArgs.appDataExternalId;b=l.get(e);l["delete"](e);if(b!=null&&b.type==="deleteMsgForMe"&&a.result.type==="success"){var u=b.chatJid,v=b.externalId,w=d("WAJids").switchOnMsgrChatJidType(u,{group:function(){return d("LSIntEnum").ofNumber(16)},user:function(){return d("LSIntEnum").ofNumber(15)}});c("promiseDone")(c("LSDatabaseSingleton").then(function(a){c("promiseDone")(d("MAWChatJid").toThreadKey(a,u).then(function(b){d("MWLogSend.bs").log(a,b,w,v,[],d("I64").of_string(d("MAWCurrentUser").getID()),d("LSIntEnum").ofNumber(c("LSMessagingThreadAttributionType").UNKNOWN),25,!1,3,1,d("I64").to_string(b),void 0)}))}))}}},qplEvent:function(a){var e=a.action,f=a.annotations,g=a.debugInfo,i=a.error,k=a.event,l=a.instanceKey,m=a.timestamp;if(!c("CurrentUser").isEmployee()&&j.has(d("QPLEvent").getMarkerId(k)))return;var o=l||0;l=f==null?void 0:(a=f.string)==null?void 0:a.jid;a=l!=null?d("WAJids").validateChatJid(l):void 0;l=n.has(d("QPLEvent").getMarkerId(k))&&a!=null?q(a,k,o):(h||(h=b("Promise"))).resolve();switch(e.type){case"start":c("QPLUserFlow").start(k,{annotations:babelHelpers["extends"]({},f||{},{bool:babelHelpers["extends"]({},(f==null?void 0:f.bool)||{},{handleDeviceNotificationInWa:c("gkx")("4464"),isArmadilloPublicLaunchUser:c("gkx")("688"),isBulkifyHIMEnabled:d("MAWGating").isBulkifyHIMEnabled(),isDev:0,isDeviceRegistrationDomainUniquenessEnabled:c("gkx")("7858"),isEBEnabled:c("MAWEBSwitch").isEnabled(),isExperimentWithDeviceNotificationInWa:c("gkx")("891"),isGifSearchEnbled:c("gkx")("7045"),isM1M2OverrideUser:c("gkx")("3444"),isSpillOverCAUser:c("gkx")("5014"),isSpillOverVNUser:c("gkx")("5264"),isTlcPublicUser:d("MAWCurrentUser").isTlcPublicUser(),useOneQueue:c("gkx")("9447"),useSharedWorker:d("shouldUseMAWSharedWorker").shouldUseMAWSharedWorker(),useSignalWarmup:c("gkx")("3702")})}),instanceKey:o,timestamp:m});break;case"success":c("QPLUserFlow").addAnnotations(k,{bool:{isRelaxedDurability:!0}},{instanceKey:o});l["finally"](function(){c("QPLUserFlow").endSuccess(k,{annotations:f,instanceKey:o,timestamp:m})});break;case"point":f&&c("QPLUserFlow").addAnnotations(k,f,{instanceKey:o});d("QPLEvent").getMarkerId(k)===1056839232?d("MAWTTRCSafe").markEvent(e.name,m):c("QPLUserFlow").addPoint(k,e.name,{instanceKey:o,timestamp:m});break;case"annotations":c("QPLUserFlow").addAnnotations(k,(a=f)!=null?a:{},{instanceKey:o});break;case"failure":c("QPLUserFlow").addAnnotations(k,{bool:{isRelaxedDurability:!0}},{instanceKey:o});l["finally"](function(){c("QPLUserFlow").endFailure(k,e.name,{annotations:f,instanceKey:o,timestamp:m})});break;case"error":c("QPLUserFlow").markError(k,e.name,{debugInfo:g,error:i,instanceKey:o});break;default:throw c("err")("Bridge sends unreachable qplEvent action type")}}},s=function(a,b){a.push(b);return a};a=function(a){var e=a.customizeEventHandlers;a=a.worker;var f=d("MAWBridge").getBridge();f.setHandlers("event",babelHelpers["extends"]({},r,e));e=d("MAWCrossWorkerPortal").getOrCreateCrossWorkerPortal(f,["backend"],s);e.setPort(a);if(c("gkx")("5147")){var g=d("WADevToolsBridge").getDevToolBridge();a=new MessageChannel();var i=d("WACrossWorkerPortal").attachPortal(g,["backend"],s,c("pageID")),j=d("WACrossWorkerPortal").attachPortal(g,["devtool"],s,c("pageID"));i.setPort(d("WADevToolMessageChannel").getMostRecentChannel().port1);j.setPort(a.port1);b("cr:2036")==null?void 0:b("cr:2036").connectAddonPort(a.port2);e.addListener(function(a,b){return g.fireAndForget("devtool","bridgeMessage",{direction:b==="outgoing"?"toWorker":"toMain",msg:a,ts:Date.now()},!0)})}return(h||(h=b("Promise"))).resolve(f)};g.initBridge=a}),98);
__d("MAWSetupBridgeOfflineConsumer",["InteractionTracingMetrics","MAWBridgeInitOfflineQueueSyncCompleteHandler","MAWBridgeSetupLoggingUtils","MAWProtocolQueueConst","MAWTTRC","MWChatInteraction.bs","WATagsLogger","asyncToGeneratorRuntime","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Stats failed: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Stats end: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Stats: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Stats start: ",""]);k=function(){return a};return a}var l=d("WATagsLogger").TAGS(["ServerRPC","OfflineConsumer"]);function m(a){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){yield a;return d("MAWBridgeInitOfflineQueueSyncCompleteHandler").call()});return n.apply(this,arguments)}function o(a){d("MAWTTRC").addIntAnnotation("offlineQueueSize",a);var b=d("MWChatInteraction.bs").get(d("MWChatInteraction.bs").MW_AUTO_CHAT_TAB_OPEN);b!=null&&c("InteractionTracingMetrics").addAnnotationInt(b,"offlineQueueSize",a)}function p(a,b){d("MAWTTRC").addIntAnnotation("offlineQueueExpectedAppData",a.appdata),d("MAWTTRC").addIntAnnotation("offlineQueueExpectedCount",a.count),d("MAWTTRC").addIntAnnotation("offlineQueueExpectedInstruction",a.instruction),d("MAWTTRC").addIntAnnotation("offlineQueueExpectedMessage",a.message),d("MAWTTRC").addIntAnnotation("offlineQueueExpectedNotification",a.notification),d("MAWTTRC").addIntAnnotation("offlineQueueExpectedReceipt",a.receipt),d("MAWTTRC").addIntAnnotation("offlineQueueExpectedRetryReceipt",a.retryReceipt),d("MAWTTRC").addIntAnnotation("offlineQueueAppDataDelta",a.appdata-b.appdata),d("MAWTTRC").addIntAnnotation("offlineQueueCountDelta",a.count-b.count),d("MAWTTRC").addIntAnnotation("offlineQueueInstructionDelta",a.instruction-b.instruction),d("MAWTTRC").addIntAnnotation("offlineQueueMessageDelta",a.message-b.message),d("MAWTTRC").addIntAnnotation("offlineQueueNotificationDelta",a.notification-b.notification),d("MAWTTRC").addIntAnnotation("offlineQueueReceiptDelta",a.receipt-b.receipt),d("MAWTTRC").addIntAnnotation("offlineQueueRetryReceiptDelta",a.retryReceipt-b.retryReceipt)}function a(a,b){return function(e){var f=e.chatJidStatus,g=e.expected,n=e.processed,q=e.status,r=e.timestamp,s=e.totalExpectedCount;e=e.totalProcessedCount;var t=q===d("MAWProtocolQueueConst").OfflineConsumerStatus.Initializing?d("MAWBridgeSetupLoggingUtils").stanzasCountStr(g):d("MAWBridgeSetupLoggingUtils").stanzasProgressCountStr(n,g);switch(q){case d("MAWProtocolQueueConst").OfflineConsumerStatus.Initializing:l.LOG(k(),s);o(s);b({tag:"InitOfflineQueueSyncStart",value:s});d("MAWTTRC").markEvent("worker_process_offline_queue_start",r);return;case d("MAWProtocolQueueConst").OfflineConsumerStatus.Processing:l.LOG(j(),t);b({tag:"InitOfflineQueueConsumerSyncProgress",value:{chatJidStatus:f,processed:e}});return;case d("MAWProtocolQueueConst").OfflineConsumerStatus.Complete:l.LOG(i(),t);b({tag:"InitOfflineQueueSyncComplete",value:f});c("promiseDone")(m(a));d("MAWTTRC").markEvent("worker_process_offline_queue_end",r);p(g,n);return;case d("MAWProtocolQueueConst").OfflineConsumerStatus.Failed:l.LOG(h(),t);d("MAWTTRC").markEvent("worker_process_offline_queue_failed",r);d("MAWTTRC").markEvent("worker_process_offline_queue_end",r);b({tag:"InitOfflineQueueSyncComplete",value:void 0});c("promiseDone")(m(a));p(g,n);return}}}g["default"]=a}),98);
__d("WAOfflineUtils",["$InternalEnum"],(function(a,b,c,d,e,f){"use strict";a=b("$InternalEnum").Mirrored(["INIT","OFFLINE_RESUME","ONLINE"]);c=b("$InternalEnum")({Initializing:"initializing",Failed:"failed",Processing:"processing",Complete:"complete"});f.ServerRPCMode=a;f.WAClientInfraOfflineProgress=c}),66);
__d("MAWSetupBridgeOfflineSnapshot",["InteractionTracingMetrics","MAWTTRC","MWChatInteraction.bs","WAOfflineUtils","WATagsLogger","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["WA infra offline sync failed"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Stats end: "," / ",", messages: "," / ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Progress: "," / ",", messages: "," / ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Stats start: ",", messages: ",""]);k=function(){return a};return a}var l=d("WATagsLogger").TAGS(["ServerRPC","Offline"]);function m(a){d("MAWTTRC").addIntAnnotation("offlineQueueSize",a);var b=d("MWChatInteraction.bs").get(d("MWChatInteraction.bs").MW_AUTO_CHAT_TAB_OPEN);b!=null&&c("InteractionTracingMetrics").addAnnotationInt(b,"offlineQueueSize",a)}a=function(a){return function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){var c=b.downloaded,e=b.expected,f=b.status;b=b.timestamp;switch(f){case d("WAOfflineUtils").WAClientInfraOfflineProgress.Initializing:l.LOG(k(),e.count,e.message);m(e.count);a({tag:"InitOfflineQueueSyncStart",value:e.count});d("MAWTTRC").markEvent("worker_download_offline_queue_start",b);return;case d("WAOfflineUtils").WAClientInfraOfflineProgress.Processing:l.LOG(j(),c.count,e.count,c.message,e.message);a({tag:"InitOfflineQueueSyncProgress",value:c.count});return;case d("WAOfflineUtils").WAClientInfraOfflineProgress.Complete:l.LOG(i(),c.count,e.count,c.message,e.message);d("MAWTTRC").addIntAnnotation("offlineQueueDownloadedCount",c.count);a({tag:"InitOfflineQueueSyncProgress",value:e.count});d("MAWTTRC").markEvent("worker_download_offline_queue_end",b);return;case d("WAOfflineUtils").WAClientInfraOfflineProgress.Failed:l.LOG(h());d("MAWTTRC").markEvent("worker_download_offline_queue_fail",b);d("MAWTTRC").markEvent("worker_download_offline_queue_end",b);return}});return function(a){return c.apply(this,arguments)}}()};e=a;g["default"]=e}),98);
__d("MAWSetupBridge",["LSDatabaseSingleton","LSInitSyncCompleteSubscription","MAWBridgeUIEventHandler","MAWCommonSetupBridge","MAWCryptoAuthToken","MAWGetEphemeralSettings","MAWSetupBridgeOfflineConsumer","MAWSetupBridgeOfflineSnapshot","Run","Visibility","cr:1265","requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h=c("requireDeferred")("ArmadilloCutoverClientFalcoEvent").__setRef("MAWSetupBridge"),i=c("LSDatabaseSingleton").then(d("LSInitSyncCompleteSubscription").use).then(function(){return c("LSDatabaseSingleton")}),j=function(a){h.loadImmediately(function(b){b=b.log;return b(function(){return{armadillo_thread_id:a.armadilloThreadId,domain:a.domain,event:a.event,event_details:a.eventDetails,open_thread_id:a.openThreadId,success:a.success,trace_id:a.traceId}})})};function a(a){var e=a.dispatch,f=a.environment,g=a.logout,h=a.reregisterDevice,k=a.worker;function l(){k.postMessage({type:"force-flush-data"})}d("Run").onUnload(l);d("Run").onBeforeUnload(l,!1);c("Visibility").addListener(c("Visibility").HIDDEN,function(){k.postMessage({type:"force-flush-logs-only"})});return d("MAWCommonSetupBridge").initBridge({customizeEventHandlers:{getLSDBEphemeralSetting:function(a){return d("MAWGetEphemeralSettings").getEphemeralSetting(a.chatJid)},logCutoverEvent:j,logout:g,offlineConsumerProgress:function(){return c("MAWSetupBridgeOfflineConsumer")(i,e).apply(void 0,arguments)},offlineSnapshot:c("MAWSetupBridgeOfflineSnapshot")(e),reregisterDevice:h,rotateCryptoAuthToken:function(){return d("MAWCryptoAuthToken").fetchFreshCAT(f)},uiUpdate:function(a){a=a.events;e&&a.forEach(function(a){return e(a)});b("cr:1265")==null?void 0:b("cr:1265").recordBridgeUIEvent(a);d("MAWBridgeUIEventHandler").handleEvents(i,a)}},worker:k})}g.setupBridge=a}),98);
__d("useMWEncryptedBackupsProcessBackupIdsDeferred",["gkx","react","requireDeferred","useReStore"],(function(a,b,c,d,e,f,g){"use strict";var h=d("react").useEffect,i=c("requireDeferred")("MWEncryptedBackupsProcessBackupIds.bs").__setRef("useMWEncryptedBackupsProcessBackupIdsDeferred");function a(a){var b=c("useReStore")();h(function(){if(c("gkx")("5448")){var d,e=!1;i.onReadyImmediately(function(c){e||(d=c.subscribeToEncryptedBackupsRow(b,a))});return function(){e=!0,d==null?void 0:d()}}else{var f=function(){};i.onReady(function(c){f=c.subscribeToEncryptedBackupsRow(b,a)});return f}},[b,a])}g["default"]=a}),98);
__d("MAWCommonSetup",["CometRelay","InteractionTracingMetrics","MAWBridge","MAWBridgeFireAndForget","MAWCommonBackendSetup","MAWEncryptedBackupsStateManager","MAWInit","MAWIssueNewUserVisibleErrors","MAWJobDefinitions","MAWSetupBridge","MAWStateContext.react","MAWTTRC","MAWTTRCSafe","MAWUIJob","MAWWaitForBackendSetup","MWChatInteraction.bs","Promise","WAJobOrchestratorTypes","asyncToGeneratorRuntime","getErrorSafe","gkx","promiseDone","react","requireDeferred","useMWEncryptedBackupsProcessBackupIdsDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h;e=d("react");var i=e.useContext,j=e.useEffect,k=c("requireDeferred")("FBLogger").__setRef("MAWCommonSetup"),l=!1,m=function(a){d("MAWEncryptedBackupsStateManager").setEncryptedBackupsState(a),d("MAWBridgeFireAndForget").fireAndForget("backend","setEncryptedBackupsState",{newState:a})};function a(a){var b=d("CometRelay").useRelayEnvironment(),e=i(d("MAWStateContext.react").MAWStateContext),f=e.dispatch;j(function(){c("promiseDone")(q(b,a,f))},[b,a,f]);c("useMWEncryptedBackupsProcessBackupIdsDeferred")(m)}var n,o=new(h||(h=b("Promise")))(function(a){n=function(c){a(c),c.onmessage=function(a){return p.onmessage==null?void 0:p.onmessage(a)},n=function(a){a.onmessage=function(a){return p.onmessage==null?void 0:p.onmessage(a)},o=(h||(h=b("Promise"))).resolve(a)}}}),p={onmessage:null,postMessage:function(a){c("promiseDone")(b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var b=(yield o);b.postMessage(a)})())}};function q(a,b,c){return r.apply(this,arguments)}function r(){r=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e){if(l)return;l=!0;d("MAWTTRC").startMAWTTRCFlow();try{d("MAWIssueNewUserVisibleErrors").deleteAllErrors();var f=b.logout,g=b.reregisterDevice;yield d("MAWCommonBackendSetup").setupArmadilloBackend(b.getOrSetupWorker,d("MAWInit").MAWInit,function(b){var h={close:function(){},onmessage:null,postMessage:function(a){return b.postMessage(a)}},i={close:function(){return b.close()},onmessage:null,postMessage:function(a){return b.postMessage(a)}};n==null?void 0:n(h);b.onmessage=function(a){h.onmessage==null?void 0:h.onmessage(a),i.onmessage==null?void 0:i.onmessage(a)};c("promiseDone")(d("MAWSetupBridge").setupBridge({dispatch:e,environment:a,logout:f,reregisterDevice:g,worker:i}))},function(){e({tag:"InitOfflineQueueSyncComplete",value:void 0}),d("MAWTTRC").endSuccess(!0)},function(){e({tag:"InitOfflineQueueSyncComplete",value:void 0})});d("MAWUIJob").UIJobStarters.fireAndForget(d("MAWJobDefinitions").jobSerializers.handleFutureproofMsg({priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.LOW}));d("MAWInit").MAWInit.endSuccess();c("gkx")("465")||c("promiseDone")(d("MAWBridge").getBridge().sendAndReceive("backend","getSecureThreadTotalCount"),function(a){d("MAWTTRCSafe").addIntAnnotation("totalSecureThreadCount",a);var b=d("MWChatInteraction.bs").get(d("MWChatInteraction.bs").MW_AUTO_CHAT_TAB_OPEN);b!=null&&c("InteractionTracingMetrics").addAnnotationInt(b,"totalSecureThreadCount",a)});d("MAWWaitForBackendSetup").resolveBackendSetup()}catch(a){var h=a,i="failure_during_armadillo_backend_setup";if(h instanceof d("MAWInit").MAWInitError){h=c("getErrorSafe")((b=h.error)!=null?b:a);i=(b=h.message)!=null?b:"Error: MAWInitError without message."}else{h=c("getErrorSafe")(a);i=((b=(b=h)==null?void 0:b.name)!=null?b:"Error:")+": "+((b=(b=h)==null?void 0:b.message)!=null?b:"Unknown")}b=i==="maw_appmutex_no_permission"&&document.visibilityState!=="visible";b?d("MAWInit").MAWInit.cancel(i,h):(d("MAWWaitForBackendSetup").rejectBackendSetup(a),d("MAWInit").MAWInit.fail(i,h));d("MAWIssueNewUserVisibleErrors").issueError(d("MAWIssueNewUserVisibleErrors").MAWGeneralErrorMsgBody,d("MAWIssueNewUserVisibleErrors").MAWGeneralErrorMsgTitle,d("MAWIssueNewUserVisibleErrors").MAWUserVisibleErrorPresentationType.BANNER,i);void k.load().then(function(a){return a("messenger_e2ee_web").catching(h).mustfix("MAW backend setup failed -- %s",i)});throw h}});return r.apply(this,arguments)}g.useArmadillo=a;g.workerProxy=p}),98);
__d("MAWSetupMutex",["FBLogger","LocalStorageMutex","MAWAppMutex","MAWBridge","MAWClientConsistencyRefresh","MAWInit","MAWIssueNewUserVisibleErrors","MAWLocalStorage","MAWReinitWorker","MAWStateContext.react","MAWTTRC","MAWWaitForBackendSetup","QPLUserFlow","Run","WALoggerDeferred","asyncToGeneratorRuntime","qpl","react","useReStore"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["AppMutex - Shouldn't reinitialize, shared worker is active on a different tab"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["AppMutex - Shouldn't reinitialize, worker already exists"]);i=function(){return a};return a}a=d("react");var j=a.useCallback,k=a.useEffect,l=a.useMemo,m=c("FBLogger")("messenger_e2ee_web"),n=!1,o=0;function p(a,b,c){return q.apply(this,arguments)}function q(){q=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e){if(document.visibilityState!=="visible")return!1;a=a();var f=window.indexedDB!=null,g=d("MAWLocalStorage").isLocalStorageAvailable();if(a){void d("WALoggerDeferred").DEV(i());return!1}if(!f||!g)return!1;if(yield b()){void d("WALoggerDeferred").DEV(h());c("MAWClientConsistencyRefresh")("worker_mismatch");e();return!1}return!0});return q.apply(this,arguments)}e=function(a,e,f){var g=e.doesWorkerExist,h=e.getOrSetupWorker,i=e.isSharedWorkerActive,q=e.logout,r=e.reregisterDevice,s=e.setupBridge,t=e.terminateWorker,u=e.terminateWorkerPermanently,v=l(function(){return d("MAWAppMutex").use()},[]),w=c("useReStore")(),x=d("MAWStateContext.react").useDispatchClearEphemeralSettings(),y=w.persistenceTypes.includes("indexeddb"),z=j(function(a){var b=v.takeoverFilter(a);if(!b||a.newValue===d("LocalStorageMutex").THIS_TAB||a.newValue==="")return;y||d("MAWBridge").getBridge().fireAndForget("event","uiUpdate",{events:[{tag:"DropAllSecureThreads",value:void 0}]});t("MAWSetupMutexV2:handleStoreChange");d("MAWWaitForBackendSetup").resetBackendSetup();d("MAWTTRC").cancel("workerMutexLost");d("MAWInit").MAWInit.cancel("workerMutexLost");v.onMutexDeath()},[v,y,t]),A=j(function(){t("MAWSetupMutexV2:handleUnload"),v.onMutexDeath()},[v,t]),B=j(b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var b=(yield p(g,i,u));if(!b||n)return;n=!0;o++;try{yield c("MAWReinitWorker")({allTablesPersisted:y,db:w,dispatch:f,dispatchClearEphemeralSettings:x,environment:a,getOrSetupWorker:h,instanceKey:o,logout:q,reregisterDevice:r,setupBridge:s}),d("MAWWaitForBackendSetup").resolveBackendSetup(),d("MAWIssueNewUserVisibleErrors").deleteUserVisibleErrorByJSErrorMessage("maw_appmutex_no_permission")}catch(a){m.mustfix("AppMutex - failed to reinitialize worker: "+a.message.concat(" (",a.error,")")),m.catching(a),c("QPLUserFlow").endFailure(c("qpl")._(25310984,"169"),"failed_to_reinitialize_worker",{annotations:{string:{error:a.message.concat(": ",a.error)}},error:a,instanceKey:o})}finally{n=!1}}),[y,w,f,x,g,a,h,i,q,r,s,u]);k(function(){window.addEventListener("storage",z);var a=d("Run").onBeforeUnload(A,!1),b=d("Run").onUnload(A);window.addEventListener("visibilitychange",B);return function(){window.removeEventListener("storage",z),a.remove(),b.remove(),window.removeEventListener("visibilitychange",B)}},[z,A,B])};g.useMutex=e}),98);
__d("MAWSetupMutex.react",["MAWSetupMutex","react"],(function(a,b,c,d,e,f,g){"use strict";d("react");function a(a){var b=a.dispatch,c=a.environment;a=a.platformSetupUtils;d("MAWSetupMutex").useMutex(c,a,b);return null}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),98);
__d("MWChatFetchThreadMessageCounts",["asyncToGeneratorRuntime"],(function(a,b,c,d,e,f){"use strict";function a(a){return g.apply(this,arguments)}function g(){g=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){return{}});return g.apply(this,arguments)}function c(a,b){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){return 0});return h.apply(this,arguments)}f.fetchArmadilloThreadMessageCounts=a;f.fetchArmadilloThreadMessageCount=c}),66);
__d("MWChatDataLossCheckerUtil",["FBLogger","I64","LSDatabaseSingleton","MAWBridgeSendAndReceive","MAWMiActOnActThreadReady","MWChatFetchThreadMessageCounts","Promise","QuickPerformanceLogger","WebStorage","asyncToGeneratorRuntime","gkx","globalCryptoSubtle","promiseDone","qpl","useDataLossStatisticsStorageListener"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(a){a=Array.from(new Uint8Array(a));return a.map(function(a){return a.toString(16).padStart(2,"0")}).join("")}function j(a){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){try{if(c("gkx")("238"))return a;var b=new TextEncoder();b=b.encode(a).buffer;a=(yield c("globalCryptoSubtle").digest("SHA-256",b));return i(a)}catch(a){return a}});return k.apply(this,arguments)}function l(a){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.currentIDBCnt,d=a.currentMsgCnt,e=a.logThreadId,f=a.prevMsgCnt,g=a.qplEvent;a=a.threadId;if(e!=null&&e){e=(yield j(a));b!=null?(c("QuickPerformanceLogger").markerStartFromNavStart(g),c("QuickPerformanceLogger").markerAnnotate(g,{"int":{current_idb_count:b,current_msg_count:d,prev_msg_count:f},string:{encrypted_threadId:e}}),c("QuickPerformanceLogger").markerEnd(g,2)):(c("QuickPerformanceLogger").markerStartFromNavStart(g),c("QuickPerformanceLogger").markerAnnotate(g,{"int":{current_msg_count:d,prev_msg_count:f},string:{encrypted_threadId:e}}),c("QuickPerformanceLogger").markerEnd(g,2))}else b!=null?(c("QuickPerformanceLogger").markerStartFromNavStart(g),c("QuickPerformanceLogger").markerAnnotate(g,{"int":{current_idb_count:b,current_msg_count:d,prev_msg_count:f}}),c("QuickPerformanceLogger").markerEnd(g,2)):(c("QuickPerformanceLogger").markerStartFromNavStart(g),c("QuickPerformanceLogger").markerAnnotate(g,{"int":{current_msg_count:d,prev_msg_count:f}}),c("QuickPerformanceLogger").markerEnd(g,2))});return m.apply(this,arguments)}function n(a){var b=a.currentMsgCnt,e=a.logThreadId,f=a.prevMsgCnt,g=a.qplEvent,h=a.threadId;return!c("gkx")("7965")?l({currentMsgCnt:b,logThreadId:e,prevMsgCnt:f,qplEvent:g,threadId:h}):c("LSDatabaseSingleton").then(function(a){return d("MAWMiActOnActThreadReady").onActThreadReady(a,d("I64").of_string(h),"MWChatDataLossCheckerUtil",function(a,i,j){return d("MAWBridgeSendAndReceive").sendAndReceive("backend","fetchArmadilloThreadMessageCount",{threadId:i}).then(function(a){return l({currentIDBCnt:a,currentMsgCnt:b,logThreadId:e,prevMsgCnt:f,qplEvent:g,threadId:h})})["catch"](function(a){c("FBLogger")("labyrinth").catching(a).warn("Failed to fetch IndexDB message count");return l({currentMsgCnt:b,logThreadId:e,prevMsgCnt:f,qplEvent:g,threadId:h})})})})}function a(a,b){return o.apply(this,arguments)}function o(){o=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){try{a=(yield d("MWChatFetchThreadMessageCounts").fetchArmadilloThreadMessageCount(a,b));var e=c("WebStorage").getAllowlistedKeyFromLocalStorage(d("useDataLossStatisticsStorageListener").DATA_LOSS_STATISTICS_STORAGE_KEY);if(e==null)return{isThreadMissingMessages:!1};e=JSON.parse(e);b=(e=e[d("I64").to_string(b)])!=null?e:null;if(b==null)return{isThreadMissingMessages:!1};return b>0&&a===0?{currCount:a,isThreadMissingMessages:!0,prevCount:b}:{isThreadMissingMessages:!1}}catch(a){c("FBLogger")("labyrinth").catching(a).warn("Failed to check for data loss");return{isThreadMissingMessages:!1}}});return o.apply(this,arguments)}function e(a){a=d("MWChatFetchThreadMessageCounts").fetchArmadilloThreadMessageCounts(a);a.then(function(a){var e=c("WebStorage").getAllowlistedKeyFromLocalStorage(d("useDataLossStatisticsStorageListener").DATA_LOSS_STATISTICS_STORAGE_KEY);if(e==null)return(h||(h=b("Promise"))).resolve(null);e=JSON.parse(e);return(h||(h=b("Promise"))).resolve({current:a,previous:e})}).then(function(a){if(a==null)return(h||(h=b("Promise"))).resolve();var c=a.current;a=a.previous;return p(a,c)})["catch"](function(a){return c("FBLogger")("labyrinth").catching(a).warn("Failed to check for data loss")});return a.then(function(){})}function p(a,b){return q.apply(this,arguments)}function q(){q=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,d){var e=[];for(var f in a)Object.prototype.hasOwnProperty.call(d,f)&&e.push(f);f=[];for(var g=0;g<e.length;g++){var i=e[g],j={currentMsgCnt:d[i],prevMsgCnt:a[i],threadId:i};a[i]>0&&d[i]===0?(f.push(n(babelHelpers["extends"]({},j,{qplEvent:c("qpl")._(717553665,"1183")}))),f.push(n(babelHelpers["extends"]({},j,{logThreadId:!0,qplEvent:c("qpl")._(717562243,"1358")})))):(f.push(n(babelHelpers["extends"]({},j,{qplEvent:c("qpl")._(717553666,"1184")}))),f.push(n(babelHelpers["extends"]({},j,{logThreadId:!0,qplEvent:c("qpl")._(717556541,"1361")}))))}yield (h||(h=b("Promise"))).all(f)});return q.apply(this,arguments)}function f(a){var b=function(b){c("promiseDone")(j(b).then(function(d){c("QuickPerformanceLogger").markerStartFromNavStart(c("qpl")._(717567419,"1383")),c("QuickPerformanceLogger").markerAnnotate(c("qpl")._(717567419,"1383"),{string:{encryptedThreadId:d,msg_count:a[b].toString()}}),c("QuickPerformanceLogger").markerEnd(c("qpl")._(717567419,"1383"),2)}))};for(var d in a)b(d)}g.qplLog=n;g.checkIsThreadMissingMessages=a;g.fetchCountsAndLogDataLoss=e;g.logThreadCompleteDataLoss=p;g.logLocalStatistics=f}),98);
__d("useDataLossStatisticsStorageListener",["LSDatabaseSingleton","MWChatDataLossCheckerUtil","MWChatFetchThreadMessageCounts","Visibility","WebStorage","promiseDone","qex","react"],(function(a,b,c,d,e,f,g){"use strict";var h=d("react").useEffect,i="armadillo_msgr_data_loss_stats";function a(){h(function(){var a;window.setTimeout(function(){a=c("Visibility").addListener(c("Visibility").HIDDEN,function(){c("promiseDone")(c("LSDatabaseSingleton").then(function(a){return d("MWChatFetchThreadMessageCounts").fetchArmadilloThreadMessageCounts(a).then(function(a){c("WebStorage").setItemGuarded(c("WebStorage").getLocalStorage(),i,JSON.stringify(a)),c("qex")._("1259")&&d("MWChatDataLossCheckerUtil").logLocalStatistics(a)})}))})},3e4);return function(){var b;(b=a)==null?void 0:b.remove()}},[])}g.DATA_LOSS_STATISTICS_STORAGE_KEY=i;g.useDataLossStatisticsStorageListener=a}),98);
__d("useOnMawSetupComplete.react",["promiseDone","react","waitForMAWTTRC"],(function(a,b,c,d,e,f,g){"use strict";var h=d("react").useEffect;function a(a,b){h(function(){var b=!1;c("promiseDone")(d("waitForMAWTTRC").promise.then(function(){if(b)return;a()}));return function(){b=!0}},b)}g.useOnMawSetupComplete=a}),98);
__d("useDataLossChecker",["LSDatabaseSingleton","MWChatDataLossCheckerUtil","asyncToGeneratorRuntime","cr:3504","promiseDone","useDataLossStatisticsStorageListener","useOnMawSetupComplete.react"],(function(a,b,c,d,e,f,g){"use strict";function a(){d("useDataLossStatisticsStorageListener").useDataLossStatisticsStorageListener(),d("useOnMawSetupComplete.react").useOnMawSetupComplete(function(){c("promiseDone")(b("asyncToGeneratorRuntime").asyncToGenerator(function*(){b("cr:3504")==null?void 0:b("cr:3504").logMAWDBUsageMetrics();var a=(yield c("LSDatabaseSingleton"));return a.runInTransaction(function(a){return d("MWChatDataLossCheckerUtil").fetchCountsAndLogDataLoss(a)},"readwrite")})())},[])}g["default"]=a}),98);
__d("useLegacyUserWatchdog",["MAWIssueNewUserVisibleErrors","clearTimeout","react","setTimeout"],(function(a,b,c,d,e,f,g){"use strict";var h=d("react").useEffect;b=24*60*60*1e3;var i=5*b;function a(){h(function(){var a=c("setTimeout")(function(){d("MAWIssueNewUserVisibleErrors").issueError(d("MAWIssueNewUserVisibleErrors").MAWLegacyUserErrorMsgBody,d("MAWIssueNewUserVisibleErrors").MAWLegacyUserErrorMsgTitle,d("MAWIssueNewUserVisibleErrors").MAWUserVisibleErrorPresentationType.BANNER)},i);return function(){return c("clearTimeout")(a)}})}g["default"]=a}),98);
__d("useMAWContactSync",["I64","JSScheduler","LSAuthorityLevel","LSContactBitOffset","LSContactBlockedByViewerStatus","LSDatabaseSingleton","LSInitSyncCompleteSubscription","LSIntEnum","MAWBridgeFireAndForget","MAWContactRelationshipType","Promise","ReQL","asyncToGeneratorRuntime","debounceCore","promiseDone","react"],(function(a,b,c,d,e,f,g){"use strict";var h,i=d("react").useEffect;function a(){i(function(){var a=new(h||(h=b("Promise")))(function(a){c("JSScheduler").scheduleSpeculativeCallback(function(){c("promiseDone")(c("LSDatabaseSingleton").then(function(b){return j(b).then(function(a){return m(a)}).then(function(){return k(b)}).then(function(b){return a(b)})}))})});return function(){c("promiseDone")(a.then(function(a){return a()}))}},[])}function j(a){return d("ReQL").toArrayAsync(d("ReQL").fromTableAscending(a.table("contacts")).filter(function(a){return d("I64").to_int32(a.authorityLevel)===c("LSAuthorityLevel").AUTHORITATIVE}))}function k(a){return d("ReQL").fromTableAscending(a.table("contacts")).subscribe(o)}var l=!1;function m(a){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(l===!0)return;l=!0;yield d("LSInitSyncCompleteSubscription").use;yield d("MAWBridgeFireAndForget").fireAndForget("backend","updateContacts",{contacts:a.map(p)})});return n.apply(this,arguments)}function o(a,b){if(b.operation==="delete")return;b=b.value;q.set(a,b);r()}function p(a){var b;b=(b=d("LSContactBitOffset").has(d("LSIntEnum").ofNumber(66),a))!=null?b:!1;return{fbid:d("I64").to_string(a.id),isBlocked:!d("I64").equal(a.blockedByViewerStatus,d("LSIntEnum").ofNumber(c("LSContactBlockedByViewerStatus").UNBLOCKED)),isRestricted:b,name:a.name,relationship:d("MAWContactRelationshipType").getContactRelationshipType(a)}}var q=new Map(),r=c("debounceCore")(function(){d("MAWBridgeFireAndForget").fireAndForget("backend","updateContacts",{contacts:Array.from(q.values()).map(p)}),q.clear()},1e3);g.useMAWContactSync=a}),98);
__d("useMAWReregisterDeviceOnError",["LSPersistedDbGating","MAWBridgeSendAndReceive","MAWIssueNewUserVisibleErrors","MAWLoggerUtils","MAWReinitWorker","MAWSetupWorker","MAWStateContext.react","ODS","WATagsLogger","asyncToGeneratorRuntime","react","shouldUseMAWSharedWorker","useReStore"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Unable to reinit worker ",""]);h=function(){return a};return a}e=d("react");var i=e.useCallback,j=e.useContext,k=!1,l=typeof window!=="undefined"?window:self;function m(){k=!0,d("MAWSetupWorker").terminateWorkerPermanently(),d("ODS").bumpEntityKey(3185,"armadillo_forced_reregister_fail",l.location.hostname),d("MAWIssueNewUserVisibleErrors").issueError(d("MAWIssueNewUserVisibleErrors").MAWLegacyUserErrorMsgBody,d("MAWIssueNewUserVisibleErrors").MAWLegacyUserErrorMsgTitle,d("MAWIssueNewUserVisibleErrors").MAWUserVisibleErrorPresentationType.BANNER)}function a(a,e){var f=e.getOrSetupWorker,g=e.setupBridge,n=e.terminateWorker,o=c("useReStore")(),p=d("MAWStateContext.react").useDispatchClearEphemeralSettings();e=j(d("MAWStateContext.react").MAWStateContext);var q=e.dispatch;return i(b("asyncToGeneratorRuntime").asyncToGenerator(function*(){if(k)return;d("ODS").bumpEntityKey(3185,"armadillo_forced_deregister",l.location.hostname);yield d("MAWBridgeSendAndReceive").sendAndReceive("backend","removeCurrentDevice");var b=d("shouldUseMAWSharedWorker").shouldUseMAWSharedWorker();d("shouldUseMAWSharedWorker").logExposureForMAWSharedWorker();b&&(yield d("MAWSetupWorker").killSharedWorker());n("useMAWReregisterDeviceOnError");try{yield c("MAWReinitWorker")({allTablesPersisted:d("LSPersistedDbGating").allTablesPersisted,db:o,dispatch:q,dispatchClearEphemeralSettings:p,environment:a,getOrSetupWorker:f,logout:m,reregisterDevice:m,setupBridge:g})}catch(a){b=a.description||a.message||a;d("WATagsLogger").TAGS([d("MAWLoggerUtils").Tag.DeviceRegistration,d("MAWLoggerUtils").Tag.LogoutHandler,d("MAWLoggerUtils").Tag.WorkerSetup,d("MAWLoggerUtils").Tag.MAWWorker,d("MAWLoggerUtils").Tag.MAWInit]).ERROR(h(),b);d("MAWIssueNewUserVisibleErrors").issueError(d("MAWIssueNewUserVisibleErrors").MAWLegacyUserErrorMsgBody,d("MAWIssueNewUserVisibleErrors").MAWLegacyUserErrorMsgTitle,d("MAWIssueNewUserVisibleErrors").MAWUserVisibleErrorPresentationType.BANNER)}}),[n,o,q,p,a,f,g])}g["default"]=a}),98);
__d("MAWSetupImpl.react",["BaseHeadingContext","CometRelay","MAWCommonSetup","MAWSetupMutex.react","MAWSetupWorker","MAWStateContext.react","MAWWebWorkerInstance","cr:6159","cr:6160","promiseDone","react","shouldUseMAWSharedWorker","useDataLossChecker","useLegacyUserWatchdog","useMAWContactSync","useMAWReregisterDeviceOnError"],(function(a,b,c,d,e,f,g){"use strict";var h=d("react");e=d("react");var i=e.useContext,j=e.useEffect,k=e.useMemo;window.XPlatTesting=b("cr:6159");window.XPlatTestingGroups=b("cr:6160");function a(a){var b=a.children,e=a.fbid,f=a.logout,g=a.setupBridge;a=i(d("MAWStateContext.react").MAWStateContext);a=a.dispatch;var l=d("CometRelay").useRelayEnvironment(),m=c("useMAWReregisterDeviceOnError")(l,{doesWorkerExist:d("MAWWebWorkerInstance").doesWorkerExist,getOrSetupWorker:d("MAWSetupWorker").getOrSetupWorker,isSharedWorkerActive:d("MAWSetupWorker").isSharedWorkerActive,setupBridge:g,terminateWorker:d("MAWSetupWorker").terminateWorker,terminateWorkerPermanently:d("MAWSetupWorker").terminateWorkerPermanently}),n=k(function(){return{doesWorkerExist:d("MAWWebWorkerInstance").doesWorkerExist,getOrSetupWorker:d("MAWSetupWorker").getOrSetupWorker,isSharedWorkerActive:d("MAWSetupWorker").isSharedWorkerActive,logout:f!=null?f:function(){return c("promiseDone")(m())},reregisterDevice:function(){return c("promiseDone")(m())},setupBridge:g,terminateWorker:d("MAWSetupWorker").terminateWorker,terminateWorkerPermanently:d("MAWSetupWorker").terminateWorkerPermanently}},[f,m,g]);d("MAWCommonSetup").useArmadillo(n);d("useMAWContactSync").useMAWContactSync();c("useLegacyUserWatchdog")();c("useDataLossChecker")();j(function(){d("shouldUseMAWSharedWorker").logExposureForMAWSharedWorker()});var o=i(c("BaseHeadingContext")),p=!d("shouldUseMAWSharedWorker").shouldUseMAWSharedWorker();return h.jsxs(c("BaseHeadingContext").Provider,{value:o+1,children:[b,p?h.jsx(c("MAWSetupMutex.react"),{dispatch:a,environment:l,fbId:e,platformSetupUtils:n}):null]})}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),98);
__d("MAWSetup.react",["CometPlaceholder.react","CurrentUser","MAWOembedIframeContainer.react","MAWSetupBridge","MAWSetupImpl.react","cr:3487","cr:6809","deferredLoadComponent","promiseDone","qex","react","requireDeferredForDisplay","useSecretConversationsLogOut"],(function(a,b,c,d,e,f,g){"use strict";var h=d("react");e=d("react");var i=e.useCallback,j=e.useEffect,k=b("cr:6809")!=null?b("cr:6809").CometLogoutProvider:function(a){a=a.children;return h.jsx(h.Fragment,{children:a})},l=c("deferredLoadComponent")(c("requireDeferredForDisplay")("MAWLoadingStateSpinner.react").__setRef("MAWSetup.react"));function a(a){a=a.children;var e=c("qex")._("1386")===!0,f=c("useSecretConversationsLogOut")(!1),g=i(function(){c("promiseDone")(f())},[f]);j(function(){var a=d("MAWOembedIframeContainer.react").createMAWOembedIframeContainer();return function(){a==null?void 0:a.stopListening()}},[]);return h.jsxs(k,{children:[h.jsx(c("MAWSetupImpl.react"),{fbid:c("CurrentUser").getID(),logout:e?g:void 0,setupBridge:d("MAWSetupBridge").setupBridge,children:a}),h.jsx(c("CometPlaceholder.react"),{fallback:null,children:h.jsx(l,{})}),b("cr:3487")&&h.jsx(b("cr:3487"),{})]})}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),98);
__d("MWFallbackWithTimeout.react",["FBLogger","react","useTimeout"],(function(a,b,c,d,e,f,g){"use strict";d("react");var h=d("react").useEffect;function a(a){var b=a.children,d=a.message;a=c("useTimeout")(1e4);var e=a.pending;h(function(){e||c("FBLogger")("messenger_web_product","fallback_timeout").warn(d)},[d,e]);return b}g["default"]=a}),98);
__d("MWChatStateV2IsComposeTab.bs",["MWChatStateV2Types"],(function(a,b,c,d,e,f,g){"use strict";function a(a){a=a.tabType;if(a.type===d("MWChatStateV2Types").MWChatStateTabType.ComposeTab)return!0;else return!1}g.isComposeTab=a}),98);
__d("MWChatStateV2HeadGroups.bs",["MWChatStateV2CompareTabs.bs","MWChatStateV2IsComposeTab.bs","MWChatStateV2IsMinimized.bs"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,c,e){c=Array.from(c.values()).filter(function(b){return d("MWChatStateV2IsMinimized.bs").isMinimized(a,b)}).sort(function(a,b){var c=d("MWChatStateV2CompareTabs.bs").byMostRecentMinimized(a,b);return c===0?d("MWChatStateV2CompareTabs.bs").byMostRecentOpened(a,b):c});b=b.filter(function(a){return!d("MWChatStateV2IsComposeTab.bs").isComposeTab(a)}).concat(c);return[b.slice(0,e),b.slice(e,b.length)]}g.getHeadGroups=a}),98);
__d("MWV2ChatHeadCond.react",["cr:2895"],(function(a,b,c,d,e,f,g){"use strict";g["default"]=b("cr:2895")}),98);
__d("MWV2ChatHeadsLayout.react",["react"],(function(a,b,c,d,e,f,g){"use strict";var h=d("react");function a(a){a=a.children;return h.jsx("div",{className:"x191j7n5 x92rtbv x10l6tqk x1useyqa",children:a})}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),98);
__d("MWV2ChatOptionsHead.react",["fbt","ix","CometPressable.react","MWXDeferredPopoverTrigger.react","MWXIcon.react","MWXTooltip.react","fbicon","gkx","react","requireDeferred","stylex"],(function(a,b,c,d,e,f,g,h,i){"use strict";var j=d("react"),k=d("react").useState,l=c("requireDeferred")("MWV2ChatOptionsHeadPopover.react").__setRef("MWV2ChatOptionsHead.react"),m={head:{alignItems:"x6s0dn4",backgroundColor:"x1l31dnx",borderTopStartRadius:"x14yjl9h",borderTopEndRadius:"xudhj91",borderBottomEndRadius:"x18nykt9",borderBottomStartRadius:"xww2gxu",boxShadow:"x1qeybcx",display:"x78zum5",height:"xc9qbxq",justifyContent:"xl56j7k",opacity:"xg01cxk",transform:"x1f85oc2",transitionDuration:"x19bguh7",transitionProperty:"x6o7n8i",width:"x14qfxbe",":hover_boxShadow":"x19xcq9t",$$css:!0},headArea:{borderTopStartRadius:"x14yjl9h",borderTopEndRadius:"xudhj91",borderBottomEndRadius:"x18nykt9",borderBottomStartRadius:"xww2gxu",height:"xnnlda6",position:"x1n2onr6",start:"xi8xln7",width:"x14qfxbe",$$css:!0},headAreaOld:{borderTopStartRadius:"x14yjl9h",borderTopEndRadius:"xudhj91",borderBottomEndRadius:"x18nykt9",borderBottomStartRadius:"xww2gxu",height:"xc9qbxq",position:"x10l6tqk",start:"xi8xln7",width:"x14qfxbe",$$css:!0},headVisible:{opacity:"x1hc1fzr",transform:"x3oybdh",$$css:!0},hoverTarget:{alignItems:"x6s0dn4",backgroundColor:"xjbqb8w",display:"x78zum5",height:"xnnlda6",justifyContent:"xl56j7k",marginStart:"x1tl9596",marginTop:"xhsvlbd",width:"x1dmp6jm",$$css:!0}},n=h._("__JHASH__GqqnGnZcXBj__JHASH__");function a(a){var b=a.isVisible,e=a.openTabCount,f=a.style;a=k(!1);var g=a[0],h=a[1];a=k(!1);var o=a[0],p=a[1];a=k(!1);var q=a[0];a=a[1];return j.jsx(c("MWXDeferredPopoverTrigger.react"),{align:"end",onVisibilityChange:a,popoverProps:{hasOpenTabs:e>0},popoverResource:l,position:"above",children:function(a,e){return j.jsx("div",{className:c("stylex")(c("gkx")("3599")?m.headArea:m.headAreaOld),style:c("gkx")("3599")?void 0:f,children:j.jsx("div",{className:"x6s0dn4 xjbqb8w x78zum5 xnnlda6 xl56j7k x1tl9596 xhsvlbd x1dmp6jm","data-testid":void 0,onMouseEnter:function(){return h(!0)},onMouseLeave:function(){return h(!1)},children:j.jsx(c("CometPressable.react"),{label:n,onFocusChange:function(a){return p(a)},onPress:e,ref:a,testid:void 0,xstyle:function(){return[m.head,b||g||o||q?m.headVisible:!1]},children:j.jsx(c("MWXTooltip.react"),{align:"middle",position:"start",tooltip:n,children:j.jsx(c("MWXIcon.react"),{icon:d("fbicon")._(i("484387"),20)})})})})})}})}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),98);
__d("MWV2PreloadComposeTab.bs",["JSResourceForInteraction","JSScheduler","react","useCometPreloader"],(function(a,b,c,d,e,f,g){"use strict";var h=d("react").useCallback,i=c("JSResourceForInteraction")("MWV2ComposeTab.react").__setRef("MWV2PreloadComposeTab.bs");function a(){var a=h(function(){d("JSScheduler").scheduleSpeculativeCallback(function(){i.preload()})},[]);a=c("useCometPreloader")("button",a,a);var b=a[0];a=a[1];return[b,a]}g["default"]=a}),98);
__d("MWV2ComposeHead.react",["fbt","ix","CometPressable.react","CometTintedIcon.react","LSThreadAttributionStore","MWChatInteraction.bs","MWChatStateV2.bs","MWChatStateV2Types","MWV2PreloadComposeTab.bs","MWXTooltip.react","MessengerWebUXLogger","fbicon","react","useMWNewChatOpenTabTraceProvider"],(function(a,b,c,d,e,f,g,h,i){"use strict";var j=d("react"),k={button:{alignItems:"x6s0dn4",appearance:"xjyslct",backgroundColor:"x1l31dnx",borderTopStartRadius:"x14yjl9h",borderTopEndRadius:"xudhj91",borderBottomEndRadius:"x18nykt9",borderBottomStartRadius:"xww2gxu",boxShadow:"x1qeybcx",display:"x3nfvp2",height:"xsdox4t",justifyContent:"xl56j7k",position:"x1n2onr6",width:"x1useyqa",":hover_boxShadow":"x19xcq9t",$$css:!0}};function a(a){var b=a.onFocusChange;a=a.onHoverChange;var e=d("MWChatStateV2.bs").useDispatch(),f=c("MessengerWebUXLogger")==null?void 0:c("MessengerWebUXLogger").useInteractionLogger(),g=c("useMWNewChatOpenTabTraceProvider")(),l=function(){g(function(a){d("MWChatInteraction.bs").set("open_new",a);f==null?void 0:f({eventName:"create_thread"});d("LSThreadAttributionStore").setSourceForNewThread("chatheadsNewMessage");var b=Date.now();a=function(a){return{clientForcedMinimizeWatermark:a.clientForcedMinimizeWatermark,closeWatermark:a.closeWatermark,minimizeWatermark:a.minimizeWatermark,openFlyoutWatermark:a.openFlyoutWatermark,openWatermark:b,tabId:a.tabId,tabType:a.tabType}};var c=function(a){var c=a.openWatermark<a.closeWatermark;if(c)return{clientForcedMinimizeWatermark:a.clientForcedMinimizeWatermark,closeWatermark:a.closeWatermark,minimizeWatermark:a.minimizeWatermark,openFlyoutWatermark:a.openFlyoutWatermark,openWatermark:b,tabId:a.tabId,tabType:a.tabType};else return{clientForcedMinimizeWatermark:a.clientForcedMinimizeWatermark,closeWatermark:b,minimizeWatermark:a.minimizeWatermark,openFlyoutWatermark:a.openFlyoutWatermark,openWatermark:a.openWatermark,tabId:a.tabId,tabType:a.tabType}};return e([{inserter:a,tabConfig:{shouldFocus:!0},tabType:{initialTokens:[],secureThreadToggleEnabled:!1,type:d("MWChatStateV2Types").MWChatStateTabType.ComposeTab},type:d("MWChatStateV2Types").MWChatStateActionsType.UpsertTab,updater:c}])},"chatheadsNewMessage")},m=c("MWV2PreloadComposeTab.bs")(),n=m[0];m=m[1];var o=h._("__JHASH__lMGuJRoIOm8__JHASH__");return j.jsx(c("MWXTooltip.react"),{align:"middle",position:"start",tooltip:o.toString(),children:j.jsx(c("CometPressable.react"),{"aria-label":o,onFocusChange:b,onHoverChange:a,onHoverIn:n,onHoverOut:m,onPress:l,testid:void 0,xstyle:function(){return[k.button]},children:j.jsx(c("CometTintedIcon.react"),{color:"primary",icon:d("fbicon")._(i("507172"),20)})})})}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),98);
__d("MWV2ChatHeads.react",["CometErrorBoundary.react","CometHeroInteractionWithDiv.react","CometPlaceholder.react","I64","JSResourceForInteraction","MWChatInteraction.bs","MWChatStateContext","MWChatStateV2HeadGroups.bs","MWChatStateV2TabGroups.bs","MWChatStateV2Types","MWV2ChatHeadCond.react","MWV2ChatHeadsLayout.react","MWV2ChatOptionsHead.react","MWV2ComposeHead.react","MWXGlimmer.react","WebUXLoggingEntryPointContextProvider","gkx","lazyLoadComponent","react","useMWChatStateV2MaxTabCount"],(function(a,b,c,d,e,f,g){"use strict";var h=d("react"),i=d("react").useState,j={glimmer:{borderTopStartRadius:"x14yjl9h",borderTopEndRadius:"xudhj91",borderBottomEndRadius:"x18nykt9",borderBottomStartRadius:"xww2gxu",height:"xsdox4t",width:"x1useyqa",$$css:!0},glimmerContainer:{alignItems:"x6s0dn4",display:"x78zum5",height:"xsdox4t",justifyContent:"xl56j7k",marginBottom:"xyorhqc",width:"x1useyqa",$$css:!0}};function k(a){a=a.index;return!c("gkx")("3599")?null:h.jsx("div",{className:"x6s0dn4 x78zum5 xsdox4t xl56j7k xyorhqc x1useyqa",children:h.jsx(c("MWXGlimmer.react"),{index:a,xstyle:j.glimmer})})}k.displayName=k.name+" [from "+f.id+"]";var l=c("lazyLoadComponent")(c("JSResourceForInteraction")("MWV2ChatHead.react").__setRef("MWV2ChatHeads.react")),m=c("lazyLoadComponent")(c("JSResourceForInteraction")("MWV2ChatOverflowHead.react").__setRef("MWV2ChatHeads.react"));function n(a){return{transform:"translateY(-"+Math.imul(a,58)+"px)"}}function o(a){return{transform:"translateY(-"+(Math.imul(a,58)-12)+"px"}}function a(a){a=a.isMediaViewer;var b=d("MWChatStateContext").useChatState(function(a){return[a.tabs,a.focusedTabId,a.mediaViewerOpenWatermark]}),e=b[0],f=b[1];b=b[2];var g=c("useMWChatStateV2MaxTabCount")(a);f=d("MWChatStateV2TabGroups.bs").getTabGroups(b,e,f,g);g=f[0];f=f[1];a=d("MWChatStateV2HeadGroups.bs").getHeadGroups(a?b:void 0,f,e,5);b=a[0];f=a[1];e=g.length;a=b.length;var j=f.length>0?1:0;g=i(!1);var p=g[0],q=g[1],r;g=f[0];var s=c("MWV2ChatHeadCond.react")?c("MWV2ChatHeadCond.react"):l;if(f.length===1&&g.tabType.type!==d("MWChatStateV2Types").MWChatStateTabType.ComposeTab){g=g.tabType.threadKeyDescriptor;r=h.jsx(c("CometErrorBoundary.react"),{fallback:function(){return null},children:h.jsx(c("CometPlaceholder.react"),{fallback:h.jsx(k,{index:a+1}),children:h.jsx(s,{onFocusChange:q,onHoverChange:q,style:n(1),tab:f[0],threadKeyDescriptor:g})})},d("I64").to_string(g.threadKey))}else f.length>1&&(r=h.jsx(c("CometPlaceholder.react"),{fallback:h.jsx(k,{index:a+1}),children:h.jsx(m,{excessHeads:f,onHoverChange:q,style:n(1)})}));return h.jsx(d("WebUXLoggingEntryPointContextProvider").WebUXLoggingEntryPointContextProvider,{value:"chat_heads",children:h.jsx(c("CometHeroInteractionWithDiv.react"),{interactionDesc:"Comet initial load to chatheads VC",interactionUUID:d("MWChatInteraction.bs").get(d("MWChatInteraction.bs").MW_CHATHEADS_LOAD),children:h.jsxs(c("MWV2ChatHeadsLayout.react"),{children:[c("MWV2ChatOptionsHead.react")!=null&&(e>0||a>0)?h.jsx(c("MWV2ChatOptionsHead.react"),{isVisible:p,openTabCount:e,style:o(a+j+1)}):null,b.reverse().map(function(a,b){var e=a.tabType;if(e.type===d("MWChatStateV2Types").MWChatStateTabType.ComposeTab)return null;var f=b+j+1;return h.jsx(c("CometErrorBoundary.react"),{fallback:function(){return null},children:h.jsx(c("CometPlaceholder.react"),{fallback:h.jsx(k,{index:b}),children:h.jsx(s,{onFocusChange:q,onHoverChange:q,style:n(f),tab:a,threadKeyDescriptor:e.threadKeyDescriptor})})},d("I64").to_string(e.threadKeyDescriptor.threadKey))}),r,h.jsx(c("MWV2ComposeHead.react"),{onFocusChange:q,onHoverChange:q})]})})})}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),98);
__d("MWV2ChatTabsLayout.react",["react"],(function(a,b,c,d,e,f,g){"use strict";var h=d("react");function a(a){a=a.children;return h.jsx("div",{className:"x1ey2m1c x78zum5 x164qtfw xixxii4 x1vjfegm","data-testid":void 0,children:a})}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),98);
__d("useMWEnsureCutoverOpenThreadExists",["Int64Hooks","LSFactory","LSIntEnum","LSVerifyThreadRowExists","MAWThreadCutover","promiseDone","useReStore"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=c("useReStore")(),e=d("MAWThreadCutover").useGetCutoverOpenThreadKey(a),f=d("MAWThreadCutover").useCutoverOpenThread(a);d("Int64Hooks").useEffectInt64(function(){e!=null&&f==null&&c("promiseDone")(b.runInTransaction(function(a){return c("LSVerifyThreadRowExists")(e,void 0,d("LSIntEnum").ofNumber(1),c("LSFactory")(a))},"readwrite"))},[f,e,b,a])}g["default"]=a}),98);
__d("MWV2ChatTabs.react",["CometErrorBoundary.react","CometPlaceholder.react","HeroInteractionIgnoreWithDiv.react","I64","JSResourceForInteraction","MAWEditMessageContext.react","MWChatInteraction.bs","MWChatStateContext","MWChatStateV2TabGroups.bs","MWChatStateV2Types","MWPReplyContext.react","MWV2ChatTabLoadingWithGlimmers.react","MWV2ChatTabsLayout.react","MWV2IsTabFocusedContext.react","cr:2539","cr:7101","gkx","hero-tracing","lazyLoadComponent","react","useCometDisplayTimingTrackerForInteraction","useMWChatStateV2MaxTabCount","useMWEnsureCutoverOpenThreadExists","useMWV2EnsureThatChatTabExists"],(function(a,b,c,d,e,f,g){"use strict";var h=d("react");e=d("react");var i=e.useCallback,j=e.useContext;e=b("cr:7101")||{};var k=e.MWComposerKeyCommandFocusManager,l=e.MWComposerKeyCommandFocusManagerTabIndex,m=c("lazyLoadComponent")(c("JSResourceForInteraction")("MWV2ComposeTab.react").__setRef("MWV2ChatTabs.react")),n=c("lazyLoadComponent")(c("JSResourceForInteraction")("MWV2ChatTab.react").__setRef("MWV2ChatTabs.react")),o=c("gkx")("78")?function(a){var b=a.tab;a=a.threadKeyDescriptor;c("useMWV2EnsureThatChatTabExists")(a.threadKey,a.threadType);c("useMWEnsureCutoverOpenThreadExists")(a.threadKey);return h.jsx(n,{tab:b,threadKeyDescriptor:a})}:n;function a(a){a=a.isMediaViewer;var e=j(d("MWChatStateContext").stateContext),f=d("MWChatStateContext").useChatState(function(a){return[a.focusedTabId,a.mediaViewerOpenWatermark]}),g=f[0];f=f[1];var n=c("useMWChatStateV2MaxTabCount")(a);a=d("MWChatStateV2TabGroups.bs").getTabGroups(a?f:void 0,e.tabs,g,n);f=a[0];var p=i(function(a){if(a.type===d("MWChatStateV2Types").MWChatStateTabType.ComposeTab)return null;else return d("MWChatInteraction.bs").get(d("I64").to_string(a.threadKeyDescriptor.threadKey))},[]),q=c("useCometDisplayTimingTrackerForInteraction")("ChatMain",!0);e=f.map(function(a,e){var f=g===a.tabId,i=a.tabType,j=null;i.type===d("MWChatStateV2Types").MWChatStateTabType.ComposeTab?j=h.jsx(m,{initialTokens:i.initialTokens,tab:a}):b("cr:2539")!=null?j=h.jsx(b("cr:2539"),{tab:a,threadKeyDescriptor:i.threadKeyDescriptor}):j=h.jsx(o,{tab:a,threadKeyDescriptor:i.threadKeyDescriptor});i=h.jsx(d("MWV2IsTabFocusedContext.react").MWV2IsTabFocusedContextProvider,{isFocused:f,children:h.jsx(d("MWPReplyContext.react").MWPReplyContextProvider,{children:h.jsx(d("MAWEditMessageContext.react").MAWEditMessageContext,{children:h.jsx(c("HeroInteractionIgnoreWithDiv.react"),{children:h.jsx(d("hero-tracing").HeroInteraction,{interactionDesc:"MWV2_CHAT_TAB",interactionUUID:p(a.tabType),pageletName:"ChatTab",ref:q,children:h.jsx(c("CometPlaceholder.react"),{fallback:h.jsx(c("MWV2ChatTabLoadingWithGlimmers.react"),{tab:a}),children:j})})})})})});return h.jsx(c("CometErrorBoundary.react"),{fallback:function(){return null},children:l==null?i:h.jsx(l,{value:e,children:i})},String(a.tabId))});return h.jsx(c("MWV2ChatTabsLayout.react"),{children:k==null?e:h.jsx(k,{children:e})})}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),98);
__d("useMWChatInit",["MWLSCommunityChatPopper","MWPGetThreadTitle","ReQL","ReQLSuspense","promiseDone","react","useMWLSChatPopperUpper","useReStore","useSubscribeToErrorTableAndShowToast"],(function(a,b,c,d,e,f,g){"use strict";var h=d("react").useEffect;function a(){var a=c("useReStore")();h(function(){c("promiseDone")(d("ReQL").toArrayAsync(d("ReQL").fromTableAscending(a.table("threads")).map(function(b){return[b,d("ReQLSuspense").toArray(d("ReQL").leftJoin(d("ReQL").fromTableAscending(a.table("participants"),[]).getKeyRange(b.threadKey),d("ReQL").fromTableAscending(a.table("contacts"))).take(d("MWPGetThreadTitle").amountToFetchForTitle),f.id+":34")]}).take(30))),c("promiseDone")(d("ReQL").toArrayAsync(d("ReQL").fromTableAscending(a.table("pinned_threads").index("pinnedTimestamp")))),c("promiseDone")(d("ReQL").toArrayAsync(d("ReQL").fromTableAscending(a.table("community_folders"))))},[a]);c("useSubscribeToErrorTableAndShowToast")();var b=!0;c("useMWLSChatPopperUpper")(a,b);d("MWLSCommunityChatPopper").useOpenCommunityChatTabs(a,b)}g["default"]=a}),98);
__d("useMWV2ChatUpdateMediaViewerOpenWatermark",["MWChatStateActions","MWChatStateV2.bs","react"],(function(a,b,c,d,e,f,g){"use strict";var h=d("react").useCallback;function a(){var a=d("MWChatStateV2.bs").useDispatch();return h(function(){var b=Date.now();a(d("MWChatStateActions").updateMediaViewerOpenWatermark(b))},[a])}g["default"]=a}),98);
__d("MWV2CookieWriter.bs",["DeferredCookie","I64","MWCMThreadTypes.react","MWChatStateV2Types","Promise","ReQL","promiseDone","qex","recoverableViolation"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(a){switch(Number(d("I64").to_string(a))){case 2:return"g.";case 15:return"sc.";case 16:return"sg.";case 18:return"cg.";case 19:return"cgu.";case 23:return"cbj.";case 24:return"cbu.";case 21:return"cphj.";case 22:return"cphu.";case 150:return"dp.";case 151:return"dpu.";case 152:return"dpb.";case 153:return"dpbu.";case 154:return"dp2.";case 155:return"dp2u.";default:return"u."}}function a(a,e,f){var g=function(a){if(e==null)return!1;var b=e.tabType;if(b.type===d("MWChatStateV2Types").MWChatStateTabType.ComposeTab)return!1;else return d("I64").equal(b.threadKeyDescriptor.threadKey,a)},j=function(a){return d("ReQL").firstAsync(d("ReQL").fromTableAscending(f.table("threads")).getKeyRange(a))},k={contents:void 0};a=a.map(function(a){var c=a.threadType,e=a.threadKey,f={o:a.isOpen?1:0};return j(e).then(function(a){if(a!=null)if(g(e)){d("MWCMThreadTypes.react").isJoinedCMThread(c)&&(k.contents=d("I64").to_string(a.parentThreadKey));return(h||(h=b("Promise"))).resolve()}else{f.i=i(c)+d("I64").to_string(e);d("MWCMThreadTypes.react").isJoinedCMThread(c)&&(f.p=d("I64").to_string(a.parentThreadKey));return(h||(h=b("Promise"))).resolve(f)}else{f.i=i(c)+d("I64").to_string(e);return(h||(h=b("Promise"))).resolve(f)}})});a=(h||(h=b("Promise"))).all(a).then(function(a){var f;if(e!=null){var g=e.tabType;if(g.type===d("MWChatStateV2Types").MWChatStateTabType.ComposeTab)f=void 0;else{g=g.threadKeyDescriptor;f=i(g.threadType)+d("I64").to_string(g.threadKey)}}else f=void 0;g=a.filter(function(a){return a!=null});a=k.contents;a=a!=null?JSON.stringify({lm3:f,lm3p:a,t3:g,utc3:Date.now(),v:1}):JSON.stringify({lm3:f,t3:g,utc3:Date.now(),v:1});if(a!=null){c("DeferredCookie").addToQueue("presence","C"+a,(f=c("qex")._("513"))!=null?f:0,"/",!1,!1,!0)}else c("recoverableViolation")("Failed to serialize cookie","messenger_comet");return(h||(h=b("Promise"))).resolve()});c("promiseDone")(a)}g.write=a}),98);
__d("useMWV2CookieWriter",["MWChatStateContext","MWChatStateV2CompareTabs.bs","MWChatStateV2IsOpen.bs","MWChatStateV2Types","MWV2CookieWriter.bs","gkx","qex","react","useReStore"],(function(a,b,c,d,e,f,g){"use strict";var h=d("react").useEffect;function a(){var a=d("MWChatStateContext").useChatState(function(a){return a.tabs}),b=c("useReStore")();h(function(){var e=Array.from(a.values()).filter(function(a){return d("MWChatStateV2IsOpen.bs").isOpen(void 0,a)}).sort(d("MWChatStateV2CompareTabs.bs").byMostRecentOpened)[0],f=[];Array.from(a.values()).filter(function(a){if(a.openWatermark>a.closeWatermark)return!0;else return a.minimizeWatermark>a.closeWatermark}).sort(function(a,b){var c=d("MWChatStateV2CompareTabs.bs").byMostRecentMinimized(a,b);if(c===0)return d("MWChatStateV2CompareTabs.bs").byMostRecentOpened(a,b);else return c}).forEach(function(a){var b=a.tabType;if(b.type===d("MWChatStateV2Types").MWChatStateTabType.ComposeTab)return;f.push(babelHelpers["extends"]({},b.threadKeyDescriptor,{isOpen:c("qex")._("537")?d("MWChatStateV2IsOpen.bs").isOpen(void 0,a):!1}))});d("MWV2CookieWriter.bs").write(f,e,b)},[b,a])}b=c("gkx")("1812641")?a:function(){};e=b;g["default"]=e}),98);
__d("MWV2ChatTabsRoot.react",["CometContextualLayerAnchorRoot.react","CometPlaceholder.react","FocusRegion.react","MWChatStateV2.bs","MWChatVisibilityOverrideContext","MWFallbackWithTimeout.react","MWLSThreadDisplayContext","MWSetupPresenceReportingDeferred.react","MWV2ChatHeads.react","MWV2ChatTabs.react","WebUXLoggingEntryPointContextProvider","cr:905","focusScopeQueries","gkx","react","stylex","useMWChatInit","useMWIsOnPushView","useMWIsTopLevelRouteMediaViewerExperiment","useMWV2ChatUpdateMediaViewerOpenWatermark","useMWV2CookieWriter","useShouldShowMessagingEntrypointInCometRoot"],(function(a,b,c,d,e,f,g){"use strict";var h=d("react");e=d("react");var i=e.useEffect,j=e.useMemo,k=(e=b("cr:905"))!=null?e:function(){},l={chatAbovePushView:{zIndex:"x1vjfegm",$$css:!0},container:{alignItems:"xuk3077",display:"x78zum5",isolation:"xc8icb0",$$css:!0},root:{bottom:"x1ey2m1c",end:"xds687c",position:"xixxii4",$$css:!0}};function m(a){var b=a.isMediaViewer;a=a.showChatAbovePushView;var e=d("MWChatStateV2.bs").useChatState(function(a){return a.tabs}),f=j(function(){return Array.from(e.values()).some(function(a){return a.openWatermark>a.closeWatermark})},[e]);return h.jsx(d("WebUXLoggingEntryPointContextProvider").WebUXLoggingEntryPointContextProvider,{value:"popup_chat_box",children:h.jsx(d("MWLSThreadDisplayContext").MWLSThreadDisplayContextProvider,{value:"ChatTab",children:h.jsx("div",{className:c("stylex")(l.root,a||c("gkx")("6264")?l.chatAbovePushView:!1),children:h.jsx(c("CometContextualLayerAnchorRoot.react"),{children:h.jsx("div",{className:"xuk3077 x78zum5 xc8icb0",children:h.jsx(d("FocusRegion.react").FocusRegion,{containFocusQuery:f?d("focusScopeQueries").tabbableScopeQuery:void 0,id:"MWV2ChatTabsRootChatTabsFocusRegion",children:h.jsxs(h.Fragment,{children:[h.jsx(c("MWV2ChatTabs.react"),{isMediaViewer:b}),h.jsx(c("MWV2ChatHeads.react"),{isMediaViewer:b})]})})})})})})})}m.displayName=m.name+" [from "+f.id+"]";function n(a){a=a.children;c("useMWV2CookieWriter")();c("useMWChatInit")();return a}n.displayName=n.name+" [from "+f.id+"]";function a(){var a=c("useMWIsOnPushView")(),b=c("useMWIsTopLevelRouteMediaViewerExperiment")(),e=d("MWChatVisibilityOverrideContext").useMWChatVisibilityOverride(b),f=c("useMWV2ChatUpdateMediaViewerOpenWatermark")(),g=c("useShouldShowMessagingEntrypointInCometRoot")("CHAT")&&e;i(function(){b&&f()},[b,f]);k();return j(function(){return h.jsxs(c("CometPlaceholder.react"),{fallback:h.jsx(c("MWFallbackWithTimeout.react"),{message:"MWV2ChatTabsRoot suspense timeout"}),children:[h.jsx(c("MWSetupPresenceReportingDeferred.react"),{}),h.jsx(n,{children:g?h.jsx(m,{isMediaViewer:b,showChatAbovePushView:a}):null})]})},[g,a,b])}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),98);
__d("MWV2ChatContainer.react",["MWV2ChatTabsRoot.react","deferredLoadComponent","react","requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h=d("react"),i=c("deferredLoadComponent")(c("requireDeferred")("MWChatEncryptedBackupsHandleRestoreWrapper.react").__setRef("MWV2ChatContainer.react"));function a(a){return h.jsxs(h.Fragment,{children:[h.jsx(c("MWV2ChatTabsRoot.react"),{}),h.jsx(i,{})]})}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),98);
__d("MWChatBadgeCountUpdater.react",["CometRelay","LSIntEnum","MWChatBadgeCountUpdates.react","MWXacGating.bs","react","recoverableViolation"],(function(a,b,c,d,e,f,g){"use strict";var h=d("react").useEffect;function a(){var a=d("CometRelay").useRelayEnvironment(),b=d("MWChatBadgeCountUpdates.react").useUnseenThreadCount(d("LSIntEnum").ofNumber(0));h(function(){var e={suppress_xac_groups:!d("MWXacGating.bs").isGroupsEnabled()};a.commitUpdate(function(a){a=a.getRoot();if(a==null){c("recoverableViolation")("A store root must be present to move forward.","messenger_comet");return}a=a.getOrCreateLinkedRecord("viewer","Viewer");a=a.getOrCreateLinkedRecord("message_threads","ViewerMessageThreadsConnection");if(b!=null){var d=a.getValue("unseen_count",e);(d===null||d!==b)&&a.setValue(b,"unseen_count",e)}})},[a,b]);return null}g["default"]=a}),98);